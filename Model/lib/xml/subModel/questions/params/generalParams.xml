<wdkModel>
    
    <paramSet name="generalParams">
        
  <!------------------------------------------------------------------>
  <!-- Organism -->  
  <!------------------------------------------------------------------>

      <flatVocabParam name="organism"
                     queryRef="GeneralVocabQueries.OrganismWithGenes"
                     prompt="Organism"
                     multiPick="true">
        <help>
           <text>
             Select one or more organisms.
           </text>
        </help>
      </flatVocabParam>

      <flatVocabParam name="organism_with_sequences"
                     queryRef="GeneralVocabQueries.OrganismWithSequences"
                     prompt="Organism"
                     multiPick="true">
        <help>
           <text>
             Select one or more organisms.
           </text>
        </help>
      </flatVocabParam>

      <flatVocabParam name="organism_with_ests"
                     queryRef="GeneralVocabQueries.OrganismWithEsts"
                     prompt="Organism"
                     multiPick="true">
        <help>
           <text>
             Select one or more organisms.
           </text>
        </help>
      </flatVocabParam>

      <flatVocabParam name="species_name"
                     queryRef="GeneralVocabQueries.SpeciesName"
                     prompt="Plasmodium species"
                     multiPick="true">
        <help>
           <text>
             Select one or more organisms.
           </text>
        </help>
      </flatVocabParam>

  <!------------------------------------------------------------------>
  <!-- BLAST -->  
  <!------------------------------------------------------------------>

        <flatVocabParam name="BlastQueryType"
            prompt="Query sequence type"
            help="The type of the query sequence (eg. DNA, protein)"
            multiPick="false"
            queryRef="GeneralVocabQueries.BlastQueryType"/>
        
        <stringParam name="BlastQuerySequence"
            id="BlastQuerySequence"
            prompt="BLAST input sequence"
            help="Blast Input Sequence"
            length="4000"
            sample="GGATTACCTTTTGATGCATCAGAAGAAGAAATAAAAAATTTCTTTAGAGATTTCCAATTAACAAAAC"/>
        
        <stringParam name="-e" 
            prompt="Expectation value" 
            help="Expected number of hits by chance" 
            default="0.05"
            sample="1e-10"/>
        
 
        <stringParam name="-b" 
            prompt="Maximum alignments (B)" 
            help="Number of alignments to show" 
            default="50"/>   
        
        <stringParam name="-v" 
            prompt="Maximum descriptions (V)" 
            help="Number of one-line descriptions to show" 
            default="50"/>
        
        <flatVocabParam name="-filter"
            id="-filter"
            prompt="Low complexity filter"
            queryRef="GeneralVocabQueries.Filter"
            help="Set the low complexity filter. WUBLAST's default behavior is not to use this filter. NCBIBLAST's is to use it. When filter is set to 'yes' WUBLAST uses seg; NCBIBLAST uses dust for blastn, seg otherwise."
            default="yes"/>
    
    <!------------------------------------------------------------------>
    <!-- History -->  
    <!------------------------------------------------------------------>

        <historyParam name="historyId"
                     prompt="History ID"
                     help="The number in the left column of My Query History"/>

        
    </paramSet>

  <!--===========================================================================-->
  <!-- General Vocab queries  -->
  <!--===========================================================================-->

  <querySet name="GeneralVocabQueries">

    <!------------------------------------------------------------------>
    <!-- Organism -->  
    <!------------------------------------------------------------------>

        <sqlQuery name="OrganismWithGenes">
            <column name="internal"/>
            <column name="term"/>
             <sql>
                  SELECT orgs.term, (select apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id))) AS apidb.varchartab), ', ') as internal
                    FROM sres.taxon
                    CONNECT BY prior taxon_id = parent_id
                    START WITH taxon_id = orgs.internal_tax) as internal
                FROM (SELECT tn.name AS term, t.taxon_id AS internal_tax
                      FROM sres.TaxonName tn, sres.taxon t
                      WHERE tn.name_class='scientific name'
                      AND t.taxon_id = tn.taxon_id
                        AND t.rank = 'species' 
                        AND t.taxon_id in
                            (SELECT taxon_id
                             FROM sres.taxon
                             CONNECT BY taxon_id = prior parent_id
                             START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.ExternalNaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) orgs,
                     (SELECT 'Plasmodium falciparum' AS term, 1 as rank from dual
                      UNION
                      SELECT 'Plasmodium vivax' AS term, 2 as rank from dual
                      UNION
                      SELECT 'Plasmodium yoelii' AS term, 3 as rank from dual) partial_order
                  WHERE orgs.term = partial_order.term(+)
                  ORDER BY partial_order.rank
            </sql>
        </sqlQuery>

        <sqlQuery name="OrganismWithSequences">
            <column name="internal"/>
            <column name="term"/>
             <sql>
                SELECT orgs.term, orgs.internal
                FROM (SELECT tn.name AS term, t.taxon_id AS internal
                      FROM sres.TaxonName tn, sres.taxon t
                      WHERE tn.name_class='scientific name'
                        AND t.taxon_id = tn.taxon_id
                        AND t.rank = 'species'
                        AND t.taxon_id in
                            (SELECT taxon_id
                             FROM sres.taxon
                             CONNECT BY taxon_id = prior parent_id
                             START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.ExternalNaSequence ens))) orgs,
                     (SELECT 'Plasmodium falciparum' AS term, 1 as rank from dual
                      UNION
                      SELECT 'Plasmodium vivax' AS term, 2 as rank from dual
                      UNION
                      SELECT 'Plasmodium yoelii' AS term, 3 as rank from dual) partial_order
                  WHERE orgs.term = partial_order.term(+)
                  ORDER BY partial_order.rank
            </sql>
        </sqlQuery>

        <sqlQuery name="OrganismWithEsts">
            <column name="internal"/>
            <column name="term"/>
             <sql>
                SELECT orgs.term, orgs.internal
                FROM (SELECT tn.name AS term, t.taxon_id AS internal
                      FROM sres.TaxonName tn, sres.taxon t
                      WHERE tn.name_class='scientific name'
                        AND t.taxon_id = tn.taxon_id
                        AND t.rank = 'species'
                        AND t.taxon_id in
                            (SELECT taxon_id
                             FROM sres.taxon
                             CONNECT BY taxon_id = prior parent_id
                             START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.ExternalNaSequence ens, dots.Est e
                              WHERE e.na_sequence_id = ens.na_sequence_id))) orgs,
                     (SELECT 'Plasmodium falciparum' AS term, 1 as rank from dual
                      UNION
                      SELECT 'Plasmodium vivax' AS term, 2 as rank from dual
                      UNION
                      SELECT 'Plasmodium yoelii' AS term, 3 as rank from dual) partial_order
                  WHERE orgs.term = partial_order.term(+)
                  ORDER BY partial_order.rank
            </sql>
        </sqlQuery>

        <sqlQuery name="SpeciesName">
            <column name="internal"/>
            <column name="term"/>
             <sql>
                SELECT orgs.term, orgs.internal
                FROM (SELECT tn.name AS term, tn.name AS internal
                      FROM sres.TaxonName tn, sres.taxon t
                      WHERE tn.name_class='scientific name'
                        AND t.taxon_id = tn.taxon_id
                        AND t.rank = 'species'
                        AND t.taxon_id in
                            (SELECT taxon_id
                             FROM sres.taxon
                             CONNECT BY taxon_id = prior parent_id
                             START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.ExternalNaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) orgs,
                     (SELECT 'Plasmodium falciparum' AS term, 1 as rank from dual
                      UNION
                      SELECT 'Plasmodium vivax' AS term, 2 as rank from dual
                      UNION
                      SELECT 'Plasmodium yoelii' AS term, 3 as rank from dual) partial_order
                  WHERE orgs.term = partial_order.term(+)
                  ORDER BY partial_order.rank
            </sql>
        </sqlQuery>

  </querySet>

    
</wdkModel>
