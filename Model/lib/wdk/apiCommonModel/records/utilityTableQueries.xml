<wdkModel>

<!-- notes

-Utility RecordClass Queries

--> 
 
<!-- ////////// UTILITY //////////// -->
    <querySet name="UtilityQueries" queryType="utility">

        <!-- UtilityQueries.PingCrypto (cryptolink hard coded in jsp) 
        <sqlQuery name="PingCrypto" isCacheable='false'>
            <paramRef ref="recordParams.source_id"/> 
            <column name="cryptolink" />
            <sql> 
            <![CDATA[           
            select 
                global_name as cryptolink
            from global_name@crypto
             ]]>
           </sql>
        </sqlQuery>
        -->
        <!-- UtilityQueries.PingToxo (toxolink hard coded in jsp) 
        <sqlQuery name="PingToxo" isCacheable='false'>
            <paramRef ref="recordParams.source_id"/> 
            <column name="toxolink" />
            <sql> 
            <![CDATA[           
            select 
                global_name as toxolink
            from global_name@toxo
             ]]>
           </sql>
        </sqlQuery>
        -->
        <!-- UtilityQueries.PingPlasmo (plasmolink hard coded in jsp) 
        <sqlQuery name="PingPlasmo" isCacheable='false'>
            <paramRef ref="recordParams.source_id"/> 
            <column name="plasmolink" />
            <sql> 
            <![CDATA[           
            select 
                global_name as plasmolink
            from global_name@plasmo
             ]]>
           </sql>
        </sqlQuery>
        -->

        <!-- UtilityQueries.CurrentInstance -->
        <!-- this is an attribute query -->
        <sqlQuery name="CurrentInstance" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="global_name" />
            <column name="version" />
            <column name="server_name" />
            <column name="server_ip" />
            <column name="system_date" />
            <column name="login" />
            <column name="service_name" />
            <column name="db_name" />
            <column name="db_unique_name" />
            <column name="instance_name" />
            <column name="db_domain" />
            <column name="client_host" />
            <column name="os_user" />
           <sql> 
            <![CDATA[           
            select $$source_id$$ AS source_id, '@PROJECT_ID@' AS project_id,
                global_name, 
                ver.banner version,
                UTL_INADDR.get_host_name as server_name,
                UTL_INADDR.get_host_address as server_ip,
                to_char(sysdate, 'Dy DD-Mon-YYYY HH24:MI:SS') system_date,
                sys_context('USERENV', 'SESSION_USER'       ) login,
                sys_context('userenv', 'SERVICE_NAME'       ) service_name, 
                sys_context('userenv', 'DB_NAME'            ) db_name, 
                sys_context('USERENV', 'DB_UNIQUE_NAME'     ) db_unique_name,
                sys_context('USERENV', 'INSTANCE_NAME'      ) instance_name,
                sys_context('USERENV', 'DB_DOMAIN'          ) db_domain,
                sys_context('USERENV', 'HOST'               ) client_host,
                sys_context('USERENV', 'OS_USER'            ) os_user,
                sys_context('USERENV', 'CURRENT_USERID'     ) current_userid,
                sys_context('USERENV', 'SESSION_USER'       ) session_user,
                sys_context('USERENV', 'SESSION_USERID'     ) session_userid
            from global_name, v$version ver
            where lower(ver.banner) like '%oracle%'
             ]]>
           </sql>
        </sqlQuery>

        <!-- UtilityQueries.CacheState -->
        <sqlQuery name="CacheState" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="cache_count" />
            <column name="first_time" />
            <column name="last_time" />
           <sql> 
            <![CDATA[           
            SELECT $$source_id$$ AS source_id, '@PROJECT_ID@' AS project_id,
            count(*) as cache_count
            FROM queryinstance
             ]]>
           </sql>
        </sqlQuery>

        <!-- UtilityQueries.ApiCommDbLink -->
        <sqlQuery name="ApiCommDbLink" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="apicomm_global_name" />
           <sql> 
            <![CDATA[           
             select $$source_id$$ AS source_id, '@PROJECT_ID@' AS project_id,
                    global_name as apicomm_global_name
            from global_name@USER_DBLINK@
             ]]>
           </sql>
        </sqlQuery>

        <!-- UtilityQueries.AllDbLinks -->
        <sqlQuery name="AllDbLinks" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="owner" />
            <column name="db_link" />
            <column name="username" />
            <column name="host" />
            <column name="created" />
           <sql> 
            <![CDATA[           
            select $$source_id$$ AS source_id, '@PROJECT_ID@' AS project_id,
            lower(owner) owner, lower(db_link) db_link, 
            lower(username) username, lower(host) host, created
            from  all_db_links
            ]]>
           </sql>
        </sqlQuery>

        <!-- UtilityQueries.TuningTables -->
        <sqlQuery name="TuningTables" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="name" />
            <column name="timestamp" />
           <sql> 
            <![CDATA[           
            select $$source_id$$ AS source_id, 
                   '@PROJECT_ID@' AS project_id,
                    name, 
                    timestamp 
            from apidb.tuningtable 
            order by timestamp desc
            ]]>
           </sql>
        </sqlQuery>

        <!-- UtilityQueries.TuningManager -->
        <sqlQuery name="TuningManager" isCacheable='false'>
            <column name="source_id" />
            <column name="project_id" />
            <column name="family_name" /> 
            <column name="last_update" /> 
            <column name="last_updater" /> 
            <column name="last_check" /> 
            <column name="last_checker" /> 
            <column name="instance_nickname" />
            <column name="subversion_url" /> 
            <column name="notify_emails" />
            <column name="elapsedCheckDays" />
            <column name="elapsedCheckHours" />
            <column name="elapsedCheckMinutes" />
           <sql> 
            <![CDATA[           
            select $$source_id$$ AS source_id, 
                   '@PROJECT_ID@' AS project_id,
                   ti.family_name family_name,
                   last_update, 
                   last_updater, 
                   last_check, 
                   last_checker, 
                   instance_nickname,
                   subversion_url, 
                   notify_emails,
                   trunc(sysdate - last_check) elapsedCheckDays,
                   to_char(   trunc(sysdate) + (sysdate - last_check),  'HH24') elapsedCheckHours,
                   to_char(   trunc(sysdate) + (sysdate - last_check),  'MI') elapsedCheckMinutes
            from apidb.TuningInstance@apidb.login_comment ti,
                   apidb.tuningfamily@apidb.login_comment tf
            where ti.service_name = 
              (select sys_context ('userenv', 'service_name') from dual)
            and ti.family_name = tf.family_name
            ]]>
           </sql>
        </sqlQuery>

     </querySet>
<!-- ////////// END UTILITY //////////// -->

</wdkModel>
