<wdkModel>
    <querySet name="SageTagAttributes" queryType="attribute" includeProjects="ApiDB,PlasmoDB,ToxoDB,GiardiaDB">

             <defaultTestParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">MAL11-1259434-1259448.1</paramValue>
               <paramValue name="project_id">PlasmoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrII-1015856-1015870.1</paramValue>
               <paramValue name="project_id">ToxoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="GiardiaDB">
               <paramValue name="source_id">CH991779-75398-75413.0</paramValue>
               <paramValue name="project_id">GiardiaDB</paramValue>
            </defaultTestParamValues>


            <testRowCountSql>
                select count(na_feature_id) from dots.SageTagFeature
            </testRowCountSql>

        <sqlQuery name="Attrs">
            <column name="project_id"/>
            <column name="source_id"/>
            <column name="tag_sequence"/> 
            <column name="sequence_id"/>
            <column name="start_min"  />
            <column name="end_max"  />
            <column name="is_reversed"/>
            <column name="strand"   sortingColumn="is_reversed"/>
            <column name="context_start"/>
            <column name="context_end"/>
            <column name="organism"  />
            <column name="rad_source_id"  />
            <column name="gene_source_id" />
            <column name="gene_product" />
            <column name="feature_source_id" />
            <sql>
            <![CDATA[
            select sta.project_id,
                   sta.source_id, 
                   'CATG' || sta.sequence as tag_sequence,
                   sta.sequence_source_id as sequence_id,
                   sta.start_min,
                   sta.end_max,
                   case when sta.is_reversed = 1 then '-' when sta.is_reversed = 0 then '+' else '.' end as strand,
                   sta.start_min - 5000 as context_start,
                   sta.end_max + 5000 as context_end,
                   sta.organism,
                   case when sta.rad_source_id is null then 'N/A' else sta.rad_source_id end as rad_source_id,
                   gene_source_id,
                   gene_product,
                   feature_source_id
            from apidb.SageTagAttributes sta
            ]]>
           </sql>
      </sqlQuery>


      <sqlQuery name="AlignmentCount">
            <column name="project_id"/>
            <column name="source_id"/>
            <column name="total_alignments"/>
            <sql>
            <![CDATA[
             select source_id, '@PROJECT_ID@' AS project_id, 
                    count(composite_element_id) as total_alignments
             from apidb.SAGETAGATTRIBUTES
             group by source_id
            ]]>
           </sql>
      </sqlQuery>

      <sqlQuery name="GeneAlignmentCount">
            <column name="project_id"/>
            <column name="source_id"/>
            <column name="total_gene_alignments"/>
            <sql>
            <![CDATA[
             select source_id, '@PROJECT_ID@' AS project_id, 
                    sum(gene_count) as total_gene_alignments
             from apidb.SAGETAGATTRIBUTES 
             group by source_id
            ]]>
           </sql>
      </sqlQuery>

 </querySet>

</wdkModel>
