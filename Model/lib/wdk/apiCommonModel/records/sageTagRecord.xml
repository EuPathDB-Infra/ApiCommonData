<wdkModel>
    <recordClassSet name="SageTagRecordClasses">

      <recordClass idPrefix="" name="SageTagRecordClass" type="SAGE Tag Alignment">

        <projectParamRef ref="recordParams.Project"/>

      <!-- =============================================================== -->
      <!--   Reporters -->
      <!-- =============================================================== -->

      <reporter name="tabular" displayName="Summary - TAB Delimited"
                implementation="org.gusdb.wdk.model.report.TabularReporter" />

      <reporter name="fullRecord" displayName="Detailed" excludeProjects="ApiDB" 
                  implementation="org.gusdb.wdk.model.report.FullRecordReporter" />

      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag attributes -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

      <attributeQueryRef ref="SageTagAttributes.Attrs">
         <columnAttribute name="tag_sequence" displayName="Tag Sequence" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="sequence_id" displayName="Sequence Id" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="start_min" displayName="Tag Start" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="end_max" displayName="Tag End" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="strand" displayName="Strand" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="context_start" displayName="Genomic Context Start" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="context_end" displayName="Genomic Context End" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="organism" displayName="Organism" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="rad_source_id" displayName="External Identifier" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="project_id" displayName="Project Id" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="gene_count" displayName="Total Number of Gene Alignments" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="gene_source_id" displayName="Gene" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="gene_product" displayName="Gene Product" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="feature_source_id" displayName="Feature source id" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>

         <textAttribute name="location_text" displayName="Genomic Location">
           <text>
               <![CDATA[
               $$sequence_id$$: $$start_min$$ - $$end_max$$ ($$strand$$)
               ]]>
           </text>
         </textAttribute>
      </attributeQueryRef>

      <attributeQueryRef ref="SageTagAttributes.AlignmentCount">
         <columnAttribute name="total_alignments" displayName="Number of Genomic Alignments" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
      </attributeQueryRef>


      <textAttribute name="overview" displayName="Overview" inReportMaker="false" internal="true">
        <text>
             <![CDATA[
             Tag Sequence: $$tag_sequence$$<br>
             External Identifier: $$rad_source_id$$<br>
             Sequence Id: $$sequence_id$$<br>
             Tag Start: $$start_min$$<br>
             Tag End: $$end_max$$<br>
             Total Number of Genomic Alignments:  $$total_alignments$$
             Total Number of Gene Alignments:  $$gene_count$$
             ]]>
        </text>
      </textAttribute>


      <!-- Need to add a text attribute for the genomic context -->


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag Tables -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    
      <table name="Locations" includeProjects="GiardiaDB"
                 displayName="Sage Tag Location"
                 queryRef="SageTagTables.Locations">
            <columnAttribute displayName= "Sequence Level" name="is_top_level" internal="false"/>
            <columnAttribute displayName= "Genomic Sequence" name="sequence_source_id" internal="false"/>
            <textAttribute inReportMaker="true" name="location" displayName="Location">
                  <text>
                    <![CDATA[
                      $$start_min$$ - $$end_max$$ ($$is_reversed$$)
                    ]]>
                  </text>
            </textAttribute>
 
            <linkAttribute displayName="Genome Browser" name="view_link" visible="View" inReportMaker="false" internal="false" >
                   <url includeProjects="GiardiaDB">
                    <![CDATA[
                      /cgi-bin/gbrowse/giardiadb/?name=$$sequence_source_id$$%3A$$start_context$$-$$end_context$$;width=550;label=SAGEtags;label=Gene;label=DeprecatedGene;h_feat=$$feature_source_id$$
                        ]]>
                   </url>
            </linkAttribute>
            <columnAttribute displayName= "start" name="start_min" internal="true"/>
            <columnAttribute displayName= "end" name="end_max" internal="true"/>
            <columnAttribute displayName= "is_reversed" name="is_reversed" internal="true"/>
            <columnAttribute displayName= "start_context" name="start_context" internal="true"/>
            <columnAttribute displayName= "end_context" name="end_context" internal="true"/>
            <columnAttribute displayName= "Feature ID" name="feature_source_id" internal="true"/>
          </table>

      <table name="AllCounts" includeProjects="ToxoDB,PlasmoDB,GiardiaDB"
            displayName="Raw Data"
            queryRef="SageTagTables.Experiments">
         <columnAttribute displayName="Library" name="experiment"/>
         <columnAttribute displayName="Raw Count" name="raw_count"/>
         <columnAttribute displayName="Raw Total" name="total_raw_count"/>
         <columnAttribute displayName="Normalized Count" name="norm_count"/>
         <columnAttribute displayName="Normalized Total" name="total_norm_count"/>
         <columnAttribute displayName="Percent Within Library" name="norm_percent"/>
     </table>

     <table name="Genes" includeProjects="ToxoDB,PlasmoDB,GiardiaDB"
            displayName="All Genes the Tag Aligns to"
            queryRef="SageTagTables.AlignedGenes">
         <columnAttribute  name="source_id" internal="true"/>
         <columnAttribute  name="gene_source_id" internal="true"/>
           <linkAttribute inReportMaker="false" displayName="Sage Tag Alignment"
                          name="linkedSourceId"
                          visible="$$source_id$$">
             <url><![CDATA[
                     showRecord.do?name=SageTagRecordClasses.SageTagRecordClass&project_id=@PROJECT_ID@&primary_key=$$source_id$$
                    ]]>
             </url>
           </linkAttribute>
           <linkAttribute inReportMaker="false" displayName="Gene Source Id"
                          name="linkedGeneSourceId"
                          visible="$$gene_source_id$$">
             <url><![CDATA[
                     showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=@PROJECT_ID@&primary_key=$$gene_source_id$$
                    ]]>
             </url>
           </linkAttribute>
         <columnAttribute  name="gene_product" internal="false"/>
         <columnAttribute  name="gene_location" internal="false"/>
         <columnAttribute displayName="Strand" name="gene_strand"/>
         <columnAttribute displayName="Distance (bp) from gene" name="bp_from_gene"/>

     </table>

    </recordClass>

    </recordClassSet>
</wdkModel>
