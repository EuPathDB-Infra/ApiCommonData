<wdkModel>
    <recordClassSet name="SageTagRecordClasses">

      <recordClass idPrefix="" name="SageTagRecordClass" type="SageTag">

        <projectParamRef ref="recordParams.Project"/>

      <!-- =============================================================== -->
      <!--   Reporters -->
      <!-- =============================================================== -->

      <reporter name="tabular" displayName="Summary - TAB Delimited"
                implementation="org.gusdb.wdk.model.report.TabularReporter" />

      <reporter name="fullRecord" displayName="Detailed" excludeProjects="ApiDB" 
                  implementation="org.gusdb.wdk.model.report.FullRecordReporter" />

      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag attributes -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

      <attributeQueryRef ref="SageTagAttributes.Attrs">
         <columnAttribute name="tag_sequence" displayName="Tag Sequence" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="sequence_id" displayName="Sequence Id" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="start_min" displayName="Tag Start" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="end_max" displayName="Tag End" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="strand" displayName="Strand" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="context_start" displayName="Genomic Context Start" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="context_end" displayName="Genomic Context End" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="organism" displayName="Organism" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="rad_source_id" displayName="External Identifier" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
         <columnAttribute name="project_id" displayName="Project Id" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>

         <textAttribute name="overview" displayName="Overview" inReportMaker="false" internal="true">
           <text>
                <![CDATA[
                Tag Sequence: $$tag_sequence$$<br>
                Sequence Id: $$sequence_id$$<br>
                Tag Start: $$start_min$$<br>
                Tag End: $$end_max$$<br>
                Genomic Context Start: $$context_start$$<br>
                Genomic Context End: $$context_end$$<br>
                External Identifier: $$rad_source_id$$
                ]]>
           </text>
         </textAttribute>

         <textAttribute name="location_text" displayName="Genomic Location">
           <text>
               <![CDATA[
               $$sequence_id$$: $$start_min$$ - $$end_max$$ ($$strand$$)
               ]]>
           </text>
         </textAttribute>
      </attributeQueryRef>

      <attributeQueryRef ref="SageTagAttributes.AlignmentCount">
         <columnAttribute name="total_alignments" displayName="Number of Genomic Alignments" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
      </attributeQueryRef>

      <attributeQueryRef ref="SageTagAttributes.Gene">
         <columnAttribute name="gene_source_id" displayName="Gene" internal="false" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
      </attributeQueryRef>

      
     <attributeQueryRef ref="SageTagAttributes.GeneCount">
         <columnAttribute name="number_of_genes_hit" displayName="Total Number of Gene Alignments" internal="true" includeProjects="ApiDB,ToxoDB,GiardiaDB,PlasmoDB"/>
      </attributeQueryRef>

      <!-- Need to add a text attribute for the genomic context -->


      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
      <!-- Sage Tag Tables -->  
      <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

     <table name="AllCounts" includeProjects="ApiDB,ToxoDB,PlasmoDB,GiardiaDB"
            displayName="Raw Data"
            queryRef="SageTagTables.Experiments">
         <columnAttribute displayName="Library" name="experiment"/>
         <columnAttribute displayName="Raw Count" name="raw_count"/>
         <columnAttribute displayName="Raw Total" name="total_raw_count"/>
         <columnAttribute displayName="Raw Percent" name="raw_percent"/>
         <columnAttribute displayName="Normalized Count" name="norm_count"/>
         <columnAttribute displayName="Normalized Total" name="total_norm_count"/>
         <columnAttribute displayName="Normalized Percent" name="norm_percent"/>
     </table>

     <table name="Genes" includeProjects="ApiDB,ToxoDB,PlasmoDB,GiardiaDB"
            displayName="All Genes the Tag Aligns to"
            queryRef="SageTagTables.AlignedGenes">
         <columnAttribute  name="gene_source_id" internal="true"/>
         <columnAttribute  name="gene_sequence_id" internal="true"/>
           <linkAttribute inReportMaker="false" displayName="Gene Source Id"
                          name="linkedSourceId"
                          visible="$$gene_source_id$$">
             <url><![CDATA[
                     showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=@PROJECT_ID@&primary_key=$$gene_source_id$$
                    ]]>
             </url>
           </linkAttribute>
           <linkAttribute inReportMaker="false" displayName="Gene Sequence Id"
                          name="linkedSequenceId"
                          visible="$$gene_sequence_id$$">
             <url><![CDATA[
                     showRecord.do?name=SequenceRecordClasses.SequenceRecordClass&project_id=GiardiaDB&primary_key=$$gene_sequence_id$$
                    ]]>
             </url>
           </linkAttribute>
         <columnAttribute displayName="Strand" name="gene_strand"/>
         <columnAttribute displayName="Distance (bp) from gene" name="bp_from_gene"/>

     </table>

    </recordClass>

    </recordClassSet>
</wdkModel>
