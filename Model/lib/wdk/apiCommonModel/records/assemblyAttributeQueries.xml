<wdkModel>

    <querySet name="AssemblyAttributes" includeProjects="CryptoDB,ToxoDB,GiardiaDB,ApiDB,PlasmoDB">
        <sqlQuery name="Bfmv" isCacheable="false">
        <paramRef ref="recordParams.primaryKey"/>
        <paramRef ref="recordParams.projectId"/>
        <column name="project_id" sortingTable="apidb.AssemblyAttributes"/>
        <column name="source_id" sortingTable="apidb.AssemblyAttributes"/>
        <column name="organism" sortingTable="apidb.AssemblyAttributes"  lowerCase="true"/>
        <column name="formatted_organism" sortingTable="apidb.AssemblyAttributes" sortingColumn="organism" lowerCase="true"/>
        <column name="est_count"  sortingTable="apidb.AssemblyAttributes"/>
        <column name="length" sortingTable="apidb.AssemblyAttributes"/>
        <column name="a_count" sortingTable="apidb.AssemblyAttributes"/>
        <column name="t_count" sortingTable="apidb.AssemblyAttributes"/>
        <column name="c_count" sortingTable="apidb.AssemblyAttributes"/>
        <column name="g_count" sortingTable="apidb.AssemblyAttributes"/>
        <column name="other_count" sortingTable="apidb.AssemblyAttributes"/>
     <sql includeProjects="ToxoDB">
      <![CDATA[ 
      SELECT aa.source_id, aa.project_id,
      REPLACE(SUBSTR(aa.organism, 1,   40),'Toxoplasma','T.') AS organism,
 '<i>' || SUBSTR(aa.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(aa.organism, INSTR(aa.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
      aa.est_count, aa.length, aa.a_count, aa.t_count, aa.g_count,aa.c_count,aa.other_count
      FROM  apidb.AssemblyAttributes aa
      WHERE aa.source_id = $$primaryKey$$
     ]]>
    </sql>
     <sql includeProjects="CryptoDB,GiardiaDB,TrichDB,ApiDB,PlasmoDB">
      <![CDATA[ 
      SELECT aa.source_id, aa.project_id,
      REPLACE(
        REPLACE(
          REPLACE(
            REPLACE(aa.organism,'Cryptosporidium','C.' ),
                                'Giardia',        'G.' ),
                                'Plasmodium',        'P.' ),
                                'Trichomonas',    'T.' ) AS organism,
 '<i>' || SUBSTR(aa.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(aa.organism, INSTR(aa.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
      aa.est_count, aa.length, aa.a_count, aa.t_count, aa.g_count,aa.c_count,aa.other_count
      FROM  apidb.AssemblyAttributes aa
      WHERE aa.source_id = $$primaryKey$$
     ]]>
    </sql>
    </sqlQuery>


       <sqlQuery name="Sequence" isCacheable="false">
        <paramRef ref="recordParams.primaryKey"/>
        <paramRef ref="recordParams.projectId"/>
        <column name="sequence"/>
     <sql includeProjects="ToxoDB,CryptoDB,GiardiaDB,TrichDB,PlasmoDB">
      <![CDATA[ 
        select a.source_id, '@PROJECT_ID@' as project_id, a.sequence from dots.assembly a where a.source_id = $$primaryKey$$ and '@PROJECT_ID@' = $$projectId$$
     ]]>
    </sql>
 <sql includeProjects="ApiDB">
                <![CDATA[
                SELECT ens.source_id, ens.sequence,
                       $$projectId$$ as project_id
                FROM dots.ExternalNaSequence ens, sres.SequenceOntology so
                WHERE ens.source_id = $$primaryKey$$
                  AND so.term_name = 'assembly'
                  AND so.sequence_ontology_id = ens.sequence_ontology_id
                ]]>
           </sql>
    </sqlQuery>


    </querySet>

</wdkModel>
