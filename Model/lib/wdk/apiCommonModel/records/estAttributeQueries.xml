<wdkModel>

    <querySet name="EstAttributes">

        <sqlQuery name="Bfmv" isCacheable='true'>
            <paramRef ref="recordParams.primaryKey"/>
            <paramRef ref="recordParams.projectId"/> 
            <column name="source_id" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="a_count" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="c_count" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="g_count" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="t_count" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="other_count" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="length" sortingTable="apidb.EstAttributes"
                    lowerCase="false"/>
            <column name="primer" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="dbest_name" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="assembly_source_id" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="vector" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="stage" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="organism" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="formatted_organism" sortingTable="apidb.EstAttributes"
                    sortingColumn="organism" lowerCase="true"/>
            <column name="ncbi_tax_id" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="external_db_name" sortingTable="apidb.EstAttributes"
                    lowerCase="true"/>
            <column name="assembly_est_count" sortingTable="apidb.EstAttributes" includeProjects="CryptoDB,ToxoDB"
                    lowerCase="true"/>
            <sql includeProjects="PlasmoDB,ApiDB">
            <![CDATA[
           SELECT bfmv.source_id, bfmv.project_id, bfmv.primer, bfmv.a_count,  bfmv.c_count, 
                  bfmv.g_count, bfmv.t_count, bfmv.other_count, bfmv.length, 
                  bfmv.assembly_source_id as assembly_source_id,
                  bfmv.dbest_name, bfmv.vector, bfmv.stage, bfmv.organism, 
                  bfmv.ncbi_tax_id,
                  '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
                  bfmv.external_db_name
            FROM  apidb.EstAttributes bfmv
            WHERE bfmv.source_id = $$primaryKey$$
            ]]>
           </sql>

            <sql includeProjects="CryptoDB,ToxoDB,GiardiaDB,TrichDB">
            <![CDATA[
           SELECT bfmv.source_id, bfmv.project_id, bfmv.primer, bfmv.a_count,  bfmv.c_count, 
                  bfmv.g_count, bfmv.t_count, bfmv.other_count, bfmv.length, 
                  bfmv.assembly_source_id as assembly_source_id, 
                  bfmv.dbest_name, bfmv.vector, bfmv.stage, bfmv.organism, 
                  bfmv.ncbi_tax_id,
                  '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
                  bfmv.external_db_name, bfmv.assembly_est_count
            FROM  apidb.EstAttributes bfmv
            WHERE bfmv.source_id = $$primaryKey$$
            ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="Sequence" isCacheable='true'>
            <paramRef ref="recordParams.primaryKey"/>
            <paramRef ref="recordParams.projectId"/> 
            <column name="source_id" />
            <column name="sequence" />
            <sql>
                <![CDATA[
                SELECT ens.source_id, ens.sequence,
                       $$projectId$$ as project_id
                FROM dots.ExternalNaSequence ens, sres.SequenceOntology so
                WHERE ens.source_id = $$primaryKey$$
                  AND so.term_name = 'EST'
                  AND so.sequence_ontology_id = ens.sequence_ontology_id
                ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="LinkOut" isCacheable='true'>
            <paramRef ref="recordParams.primaryKey"/>
            <paramRef ref="recordParams.projectId"/> 
            <column name="source_id" />
            <column name="linkout" />
            <sql>
            <![CDATA[
            SELECT 
                source_id,
                $$projectId$$ as project_id,
                CASE 
                  WHEN bfmv.dbest_name = 'WatanabeCpHNJ-1' then
                     '<a href="http://fullmal.hgc.jp/cgi-bin/fulcrypto_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Cgn0110%7Csp003%7Ccl0110%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Ccl0100%7Csp003%7Cgn0100%7C&SRH=1%21'|| bfmv.source_id || '">Full-Cryptosporidium</a>'
                  WHEN bfmv.dbest_name = 'WatanabeTgRH' then 
                      '<a href="http://fullmal.hgc.jp/cgi-bin/fultoxo_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Cgn0210%7Csp003%7Cgn0310%7Csp003%7Cgn0410%7Csp003%7Cgn0510%7Csp003%7Ccl0210%7Csp003%7Ccl0110%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Ccl0100%7Csp003%7Ccl0200%7Csp003%7Cgn0500%7Csp003%7Cgn0400%7Csp003%7Cgn0200%7Csp003%7Cgn0300%7C&SRH=1%21' || bfmv.source_id || '">Full-Toxoplasma</a>'
                  WHEN bfmv.dbest_name = 'WatanabePf3D7_cultured' then 
                      '<a href="http://fullmal.hgc.jp/cgi-bin/fulmal_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Ccl0211%7Csp003%7Ccy0611%7Csp003%7Cyomch0%7Csp003%7Ccy0601%7Csp003%7Ccl0201%7Csp003%7Ccb0111%7Csp003%7Ccb0611%7Csp003%7Cct080%7Csp003%7Ccb0601%7Csp003%7Ccb0101%7Csp003%7Ccv0111%7Csp003%7Ccv0611%7Csp003%7Cct170%7Csp003%7Ccv0601%7Csp003%7Ccv0101%7Csp003%7Csp007%7Cgn0410%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Cgn0400%7Csp003%7C&SRH=1%21' || bfmv.source_id || '">Full-Malaria</a>'
                  WHEN bfmv.external_db_name = 'C. parvum ESTs' then 
                      '<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?val=' || bfmv.source_id || '">NCBI</a>'
                  WHEN bfmv.external_db_name = 'dbEST' then 
                      '<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?val=' || bfmv.source_id || '">NCBI</a>'
                  ELSE 'none'
                END
                as linkout
            FROM  apidb.EstAttributes bfmv
            WHERE bfmv.source_id = $$primaryKey$$
            ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="Reference" isCacheable='true'>
            <paramRef ref="recordParams.primaryKey"/>
            <paramRef ref="recordParams.projectId"/> 
            <column name="source_id" />
            <column name="author" />
            <column name="affiliation" />
            <column name="address" />
            <sql>
            <![CDATA[
            SELECT e.accession as source_id, $$projectId$$ as project_id,
                   c.name as author,
                   c.address1 as affiliation,
                   c.address2 as address
            FROM dots.est e, sres.contact c
            WHERE e.contact_id = c.contact_id
            AND e.accession = $$primaryKey$$
            ]]>
            </sql>
        </sqlQuery>


    </querySet>


</wdkModel>
