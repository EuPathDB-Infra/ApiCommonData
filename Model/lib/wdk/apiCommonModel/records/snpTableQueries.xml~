<wdkModel>
    <querySet name="EstTables">

        <!-- EstTables.AlignmentInfo -->
        <sqlQuery name="AlignmentInfo"  isCacheable='true' excludeProjects="ApiDB">
            <paramRef ref="recordParams.primaryKey"/>
            <paramRef ref="recordParams.projectId"/>
            <column name="accession" />
            <column name="sequence_id" />
            <column name="target_start" />
            <column name="target_end" />
            <column name="context_start" />
            <column name="context_end" />
            <column name="percent_identity" />
            <column name="is_consistent" />
            <column name="is_best_alignment" />
            <column name="is_reversed" />
            <sql>
            <![CDATA[
            SELECT enas.source_id as sequence_id,
                   e.accession,
                   blat.target_start,
                   blat.target_end,
                   blat.target_start - 10000 as context_start,
                   blat.target_end + 10000 as context_end,
                   decode(blat.is_best_alignment,0,'No',1,'Yes',blat.is_best_alignment) as is_best_alignment, 
                   decode(blat.is_consistent,0,'No',1,'Yes',blat.is_consistent) as is_consistent, 
                   decode(blat.is_reversed,0,'+',1,'-',blat.is_reversed) as is_reversed, 
                   blat.percent_identity
            FROM   dots.blatalignment blat,
                   dots.est e,
                   dots.nasequence enas
            WHERE  blat.query_na_sequence_id = e.na_sequence_id
              AND  blat.target_na_sequence_id = enas.na_sequence_id
              AND  e.accession = $$primaryKey$$
            ORDER BY blat.is_best_alignment desc, blat.is_consistent desc, blat.percent_identity desc
            ]]>
            </sql>
        </sqlQuery>
    </querySet>
</wdkModel>
