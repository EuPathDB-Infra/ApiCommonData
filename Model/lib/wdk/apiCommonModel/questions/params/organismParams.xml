<wdkModel>

  <!--=====================================================================-->
  <!-- Params  -->
  <!--=====================================================================-->
  <paramSet name="organismParams"> 
      <flatVocabParam name="organism"
                     queryRef="organismVQ.withGenes"
                     prompt="Organism"
                     multiPick="true">
      </flatVocabParam>
  </paramSet> 


  <!--=====================================================================-->
  <!-- Vocab queries for organism parameters

       These queries differ by which rows they return.  The columns are the
       same:

         term: scientific name of species
         internal: comma-separated list of all taxon ids for the clade whose
                   root is that species

        Many have the same general structure:
         - the taxon list which forms the internal value us generated by a
           recursive sub-query nested inside the SELECT clause
         - the set of rows is determined by an inline view in the FROM clause
           named "organisms"
         - an optional ordering is imposed by another inline view in the FROM
           clause named "partial_ordering".  This is used to let
           P. falciparum, P. vivax, and P. yoelii (in that order) start a
           list of genes.  It's OK for any (or all) of those to be omitted
           from the list, and it's OK for other genes to be included, but if
           they're there, they go first. Otherwise, the organisms are
           ordered alphabetically.
                                                                           -->
  <!--=====================================================================-->

  <querySet name="organismVQ">
    <!--===================================================================-->
    <!-- all -->
    <!--===================================================================-->

    <sqlQuery name="all" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="all" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>
    <!--===================================================================-->
    <!-- with chromosomes -->  
    <!--===================================================================-->

    <sqlQuery name="withChromosomes" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withChromosomes" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- with genomic seq-->  
    <!--===================================================================-->

    <sqlQuery name="withGenomicSeq" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withGenomicSeq" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>
    <!--===================================================================-->
    <!-- with genes

         Each row returned represents a species.  Species are only included if
         they are represented in a sequence record (in dots.NaSequence), either
         by their own taxon_id or that of a subspecies.  Sequence records are
         only used if there is a gene record (dots.GeneFeature) that points to
         them.
                                                                           -->
    <!--===================================================================-->

    <sqlQuery name="withGenes" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withGenes" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- with EC -->  
    <!--===================================================================-->

    <sqlQuery name="withEC" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withEC" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- cp-tg

         Choices must be a subset of
         {Cryptosporidium parvum, Toxoplasma gondii}.

         This is enforced by a third inline view, named "cp_tg", in the
         FROM clause.
                                                                           -->
    <!--===================================================================-->

    <sqlQuery name="cp-tg" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Cryptosporidium parvum' AS name FROM dual
                 UNION
                SELECT 'Toxoplasma gondii' AS name FROM dual) cp_tg
          WHERE organisms.name = partial_ordering.name(+)
            AND organisms.name = cp_tg.name
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="cp-tg" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- plasmoWithGenes  -->  
    <!--===================================================================-->

    <sqlQuery name="withPlasmoGenes" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withPlasmoGenes" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- tg pf -->  
    <!--===================================================================-->

    <sqlQuery name="tg-pf" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="tg-pf" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- pf -->  
    <!--===================================================================-->

    <sqlQuery name="pf" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="pf" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    <!--===================================================================-->
    <!-- pb -->  
    <!--===================================================================-->

    <sqlQuery name="pb" excludeProjects="ApiDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
        <![CDATA[
          SELECT organisms.name AS term,
                 (SELECT apidb.tab_to_string(CAST(COLLECT(trim(to_char(taxon_id)))
                                             AS apidb.varchartab), ', ')
                         AS internal
                  FROM sres.taxon
                  CONNECT BY prior taxon_id = parent_id
                  START WITH taxon_id = organisms.internal_taxon) AS internal
          FROM (SELECT tn.name, t.taxon_id AS internal_taxon
                FROM sres.TaxonName tn, sres.taxon t
                WHERE tn.name_class='scientific name'
                  AND t.taxon_id = tn.taxon_id
                  AND t.rank = 'species' 
                  AND t.taxon_id IN
                       (SELECT taxon_id
                        FROM sres.taxon
                        CONNECT BY taxon_id = prior parent_id
                        START WITH taxon_id IN
                             (SELECT ens.taxon_id
                              FROM dots.NaSequence ens, dots.GeneFeature gf
                              WHERE gf.na_sequence_id = ens.na_sequence_id))) organisms,
               (SELECT 'Plasmodium falciparum' AS name, 1 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium vivax' AS name, 2 AS rank FROM dual
                 UNION
                SELECT 'Plasmodium yoelii' AS name, 3 AS rank FROM dual) partial_ordering
          WHERE organisms.name = partial_ordering.name(+)
          ORDER BY partial_ordering.rank, organisms.name
        ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="pb" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPluging" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

  </querySet>

</wdkModel>
