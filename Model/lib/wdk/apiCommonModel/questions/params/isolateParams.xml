<wdkModel>

  <!-- notes

     - should ms_assay param be a controlled vocab pulled from the database?

  -->

  <paramSet name="isolateParams" includeProjects="ApiDB,CryptoDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- ID -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++-->
        <stringParam name="isolate_id"
                     prompt="Isolate ID">
        <help>
             Enter an Isolate ID.  Wildcards (*) are allowed.
        </help>
            <suggest includeProjects="CryptoDB,ApiDB"
                     sample="AF527841, DQ1145002, DQ115*"
                     default="AF527841"/>
        </stringParam>

        <stringParam name="author"
                     prompt="Author">
        <help> 
          Enter an Author name.  Wildcards (*) are allowed.  
        </help> 
    
        <suggest includeProjects="CryptoDB,ApiDB" sample="Xiao*" default="Xiao*"/> 
        </stringParam>

        <flatVocabParam name="isolate_organism"
             queryRef="organismIQ.withIsolates"
            prompt="Organism"
            multiPick="true"
            quote="false">
            <useTermOnly value="true" includeProjects="ApiDB"/>
        </flatVocabParam>

        <flatVocabParam name="specific_host"
             queryRef="hostVQ.withIsolates"
             prompt="Host Name"
             multiPick="true"
             quote="false">
             <useTermOnly value="true" includeProjects="CryptoDB,ApiDB"/>
        </flatVocabParam>

        <flatVocabParam name="isolation_source"
             queryRef="isolationSourceVQ.withIsolates"
             prompt="Isolation Source"
             multiPick="true"
             quote="false">
             <useTermOnly value="true" includeProjects="ApiDB"/>
        </flatVocabParam>

        <flatVocabParam name="product"
            queryRef="productVQ.withIsolates"
            prompt="Product Name"
            multiPick="true"
            quote="false">
            <useTermOnly value="true" includeProjects="CryptoDB,ApiDB"/>
        </flatVocabParam>

        <flatVocabParam name="study"
            queryRef="studyVQ.withIsolates"
            prompt="Study Name"
            multiPick="true"
            quote="false">
            <useTermOnly value="true" includeProjects="CryptoDB,ApiDB"/>
        </flatVocabParam>

        <flatVocabParam name="country"
            queryRef="countryVQ.withIsolates"
            prompt="Country Name"
            multiPick="true"
            quote="false">
            <useTermOnly value="true" includeProjects="CryptoDB,ApiDB"/>
       </flatVocabParam>

    </paramSet>

    <querySet name="organismIQ">
      <sqlQuery name="withIsolates" includeProjects="CryptoDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
      <![CDATA[
      SELECT src.organism || '  - (' || count(src.organism) || ' isolates)' AS term,
             src.organism AS internal
      FROM   DoTS.IsolateSource src,
             DoTS.ExternalNASequence etn,
             SRes.ExternalDatabaseRelease edr,
             SRes.ExternalDatabase edb
      WHERE  edr.external_database_id = edb.external_database_id
         AND edr.external_database_release_id = etn.external_database_release_id
         AND edb.name = 'Isolates Data'
         AND edr.version = '2007-12-12'
         AND src.na_sequence_id = etn.na_sequence_id
         AND src.organism is not null
      GROUP BY src.organism
      ORDER BY src.organism
     ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </wsQuery>

  </querySet>

  <querySet name="hostVQ">
    <sqlQuery name="withIsolates" includeProjects="CryptoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
    SELECT distinct src.specific_host AS term,
           src.specific_host      AS internal
    FROM   DoTS.IsolateSource src,
           DoTS.ExternalNASequence etn,
           SRes.ExternalDatabaseRelease edr,
           SRes.ExternalDatabase edb
    WHERE  src.specific_host is not null
       AND edr.external_database_id = edb.external_database_id
       AND edr.external_database_release_id = etn.external_database_release_id
       AND edb.name = 'Isolates Data'
       AND edr.version = '2007-12-12'
       AND src.na_sequence_id = etn.na_sequence_id
    ORDER BY src.specific_host
    ]]>
    </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="32" wsName="internal"/>
      <wsColumn name="term" width="32" wsName="term"/>
    </wsQuery>

    </querySet>

  <querySet name="isolationSourceVQ">
    <sqlQuery name="withIsolates" includeProjects="CryptoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
    SELECT term, internal FROM (
    SELECT upper(substr(src.isolation_source, 0, 1)) || substr(src.isolation_source, 2) || ' (' || count(src.isolation_source) || ' isolates)' AS term,
           src.isolation_source      AS internal
    FROM   DoTS.IsolateSource src,
           DoTS.ExternalNASequence etn,
           SRes.ExternalDatabaseRelease edr,
           SRes.ExternalDatabase edb
    WHERE  src.isolation_source is not null
       AND edr.external_database_id = edb.external_database_id
       AND edr.external_database_release_id = etn.external_database_release_id
       AND edb.name = 'Isolates Data'
       AND edr.version = '2007-12-12'
       AND src.na_sequence_id = etn.na_sequence_id
    GROUP BY src.isolation_source
    )
    ORDER BY term
    ]]>
    </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </wsQuery>

    </querySet>

  <querySet name="productVQ">
    <sqlQuery name="withIsolates" includeProjects="CryptoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
          SELECT distinct gf.product as term,
                 gf.product as internal
          FROM   DoTS.ExternalNASequence etn,
               DoTS.Genefeature gf,
               SRes.ExternalDatabaseRelease edr,
               SRes.ExternalDatabase edb
          WHERE  etn.na_sequence_id = gf.na_sequence_id
               AND edr.external_database_id = edb.external_database_id
               AND edr.external_database_release_id = etn.external_database_release_id
               AND edb.name = 'Isolates Data'
               AND edr.version = '2007-12-12'
               AND gf.product is not null
          ORDER BY gf.product
    ]]>
    </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="100" wsName="internal"/>
      <wsColumn name="term" width="100" wsName="term"/>
    </wsQuery>

     </querySet>

  <querySet name="studyVQ">
    <sqlQuery name="withIsolates" includeProjects="CryptoDB">
    <column name="internal"/>
    <column name="term"/>
    <sql>
    <![CDATA[
    SELECT distinct term, internal from (
    SELECT replace(ref.title, ',', ';') as term,
           replace(ref.title, ',', ';') as internal
    FROM   SRES.Reference ref,
           SRes.ExternalDatabaseRelease edr,
           SRes.ExternalDatabase edb
    WHERE  ref.title IS NOT NULL
       AND edr.external_database_id = edb.external_database_id
       AND edb.name = 'Isolates Data'
       AND edr.version = '2007-12-12'
    )
    ORDER BY term
    ]]>
    </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </wsQuery>

  </querySet>

  <querySet name="countryVQ">
    <sqlQuery name="withIsolates" includeProjects="CryptoDB">
      <column name="internal"/>
      <column name="term"/>
      <sql>
      <![CDATA[
      SELECT distinct term, internal from (
      SELECT replace(src.country, ',', ';') AS term,
             replace(src.country, ',', ';') AS internal
      FROM   DoTS.IsolateSource src,
             DoTS.ExternalNASequence etn,
             SRes.ExternalDatabaseRelease edr,
             SRes.ExternalDatabase edb
      WHERE  edr.external_database_id = edb.external_database_id
         AND edr.external_database_release_id = etn.external_database_release_id
         AND edb.name = 'Isolates Data'
         AND edr.version = '2007-12-12'
         AND src.na_sequence_id = etn.na_sequence_id
         AND src.country is not null
      )
      ORDER BY term
      ]]>
      </sql>
    </sqlQuery>

    <wsQuery name="withIsolates" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="ApiDB">
      <wsColumn name="internal" width="200" wsName="internal"/>
      <wsColumn name="term" width="200" wsName="term"/>
    </wsQuery>

  </querySet>

</wdkModel>
