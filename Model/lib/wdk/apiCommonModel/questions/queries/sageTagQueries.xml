<wdkModel>

  <querySet name="SageTagIds">

    <sqlQuery name="ByLocation" includeProjects="GiardiaDB"
              isCacheable="true">
        <paramRef ref="sharedParams.sequenceId"/>
        <paramRef ref="sharedParams.start_point"/>
        <paramRef ref="sharedParams.end_point"/>
        <column name="source_id"/>
        <column name="project_id"/>
       <sql>
         <![CDATA[
            SELECT distinct sta.source_id, '@PROJECT_ID@' as project_id
            FROM   apidb.SageTagAttributes sta
            WHERE  lower(sta.sequence_source_id) = lower($$sequenceId$$)
              AND  end_max >= $$start_point$$ 
              AND  (start_min <= $$end_point$$ OR $$end_point$$ = 0)
         ]]>
       </sql>
    </sqlQuery>

    <sqlQuery name="BySequence" includeProjects="ToxoDB,PlasmoDB,GiardiaDB"
              isCacheable="true">
        <paramRef ref="sageTagParams.sequence"/>
        <paramRef ref="sageTagParams.is_within_gene"/>
        <column name="source_id"/>
        <column name="project_id"/>
       <sql>
         <![CDATA[
         select distinct a.source_id, a.project_id 
         from apidb.SageTagAttributes a, apidb.SageTagGene sg
         where (lower(a.sequence) = lower($$sequence$$) 
                 OR lower(a.sequence) = lower('catg' || $$sequence$$) )
         and a.na_feature_id = sg.tag_feature_id $$is_within_gene$$ 
         ]]>
       </sql>
    </sqlQuery>
  <wsQuery name="BySequence" includeProjects="ApiDB"
        processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
       <paramRef ref="sageTagParams.sequence"/>
       <paramRef ref="sageTagParams.is_within_gene"/>
       <wsColumn name="source_id" width="32" wsName="source_id"/>
       <wsColumn name="project_id" width="32" wsName="project_id"/>
  </wsQuery> 

    <sqlQuery name="ByGeneSourceId" includeProjects="ToxoDB,PlasmoDB,GiardiaDB"
              isCacheable="true">
        <paramRef ref="sageTagParams.single_gene_id"/>
        <paramRef ref="geneParams.st_max_five_prime_distance"/>
        <paramRef ref="geneParams.st_max_three_prime_distance"/>
        <column name="source_id"/>
        <column name="project_id"/>
       <sql>
         <![CDATA[
         select distinct a.source_id, a.project_id
         from apidb.SageTagAttributes a, apidb.SageTagGene sg
         where a.na_feature_id = sg.tag_feature_id
         and sg.antisense = a.is_reversed
         and sg.gene_source_id in ($$single_gene_id$$)
         and ((sg.direction = '5' and sg.distance <= $$st_max_five_prime_distance$$)
             OR (sg.direction = '3' and sg.distance <= $$st_max_three_prime_distance$$))
         ]]>
       </sql>
</sqlQuery>
 
  <wsQuery name="ByGeneSourceId" includeProjects="ApiDB"
        processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
       <paramRef ref="sageTagParams.single_gene_id"/>
       <paramRef ref="geneParams.st_max_five_prime_distance"/>
       <paramRef ref="geneParams.st_max_three_prime_distance"/>
       <wsColumn name="source_id" width="32" wsName="source_id"/>
       <wsColumn name="project_id" width="32" wsName="project_id"/>
   </wsQuery> 

 <sqlQuery name="ByRadSourceId" includeProjects="GiardiaDB"
              isCacheable="true">
        <paramRef ref="sageTagParams.rad_source_id"/>
        <column name="source_id"/>
        <column name="project_id"/>
       <sql>
         <![CDATA[
         select distinct a.source_id, a.project_id
         from apidb.SageTagAttributes a
         where a.rad_source_id in ($$rad_source_id$$)
         ]]>
       </sql>
</sqlQuery>
 

 <sqlQuery name="ByExpressionLevel" includeProjects="ToxoDB,PlasmoDB,GiardiaDB"
              isCacheable="true">
        <paramRef ref="sageTagParams.st_min_count"/>
        <paramRef ref="sageTagParams.raw_normalized"/>
        <paramRef ref="sageTagParams.sage_experiment"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="tag_count" />
        <column name="tag_percentage" />
        <column name="raw_count" />
        <column name="raw_percentage" />
        <column name="SAGE_library" />
       <sql>
         <![CDATA[
         select distinct a.source_id, a.project_id,to_char(staa.tag_count, '99999') as tag_count, to_char(staa.raw_count , '99999') as raw_count,
         to_char(100*staa.library_tag_percentage,'990D00') || '%' as tag_percentage,
         to_char(100*staa.raw_percent,'990D00') || '%' as raw_percentage,
         staa.library_name as SAGE_library
         from apidb.SageTagAttributes a, apidb.SageTagAnalysisAttributes staa
         where (CASE '$$raw_normalized$$' WHEN 'n' THEN staa.tag_count ELSE staa.raw_count END)>= $$st_min_count$$ 
         and staa.library_name = $$sage_experiment$$
         and a.composite_element_id=staa.composite_element_id
         ]]>
       </sql>
</sqlQuery>
  <wsQuery name="ByExpressionLevel" includeProjects="ApiDB"
        processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
       <paramRef ref="sageTagParams.st_min_count"/>
       <paramRef ref="sageTagParams.raw_normalized"/>
       <paramRef ref="sageTagParams.sage_experiment"/>
       <wsColumn name="source_id" width="32" wsName="source_id"/>
       <wsColumn name="project_id" width="32" wsName="project_id"/>
       <wsColumn name="tag_count" width="32" wsName="tag_count" />
       <wsColumn name="tag_percentage" width="32" wsName="tag_percentage"/>
       <wsColumn name="raw_count" width="32" wsName="raw_count"/>
       <wsColumn name="raw_percentage" width="32" wsName="raw_percentage"/>
       <wsColumn name="SAGE_library" width="32" wsName="SAGE_library"/>
   </wsQuery>


  </querySet>

</wdkModel>
