<wdkModel>

  <!-- notes

  -->

  <querySet name="AssemblyIds">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Library  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="AssembliesByLibrary" includeProjects="CryptoDB,ToxoDB" 
             isCacheable='true'>
        <paramRef ref="sharedParams.libraryId"/>
        <paramRef ref="sharedParams.min_ests_in_assembly"/>
        <paramRef ref="sharedParams.min_lib_ests_in_assembly"/>
        <column name="source_id" />
        <column name="project_id"/>
        <column name="est_library_count"/>
        <sql>
            SELECT aa.source_id, aa.project_id,
                   count(*) as est_library_count
            FROM apidb.EstAttributes ea,
                 apidb.AssemblyAttributes aa
            WHERE aa.source_id = ea.assembly_source_id
              AND ea.library_id in ($$libraryId$$)
              AND ea.assembly_est_count >= $$min_ests_in_assembly$$
              AND aa.project_id = '@PROJECT_ID@'
            GROUP BY aa.source_id, aa.project_id
            HAVING count(*) >= $$min_lib_ests_in_assembly$$
       </sql>
    </sqlQuery>

  </querySet>
</wdkModel>
