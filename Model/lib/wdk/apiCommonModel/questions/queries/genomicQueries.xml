<wdkModel name="SequenceId">

   <!-- notes

      - in SourceId query changed 'sequence' and 'contig' param to 'sharedParams.genomicSequence'

      - in taxon query changed apidb's seqorganism to organism

      - assumes that NAsequence table has source_id

   -->
    
    <!-- ************************************************************ -->
    <!-- SourceId -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="SequenceBySourceId" excludeProjects="ApiDB"
        isCacheable="true">
        <paramRef ref="sharedParams.genomicSequence"/> 
        <column name="source_id"/>
        <sql includeProjects="CryptoDB">
             <![CDATA[
            SELECT enas.source_id, '@@PROJECT_ID@@' as project_id
            FROM dots.externalnasequence enas,
                 sres.sequenceontology so
            WHERE LOWER(enas.source_id) LIKE TRIM(LOWER(REPLACE('$$sequenceId$$', '*', '%')))
            AND enas.sequence_ontology_id = so.sequence_ontology_id
            AND so.term_name in ('contig', 'supercontig')
           ]]>
        </sql>
        <sql includeProjects="PlasmoDB,ToxoDB">
        <![CDATA[
            SELECT distinct source_id, '@@PROJECT_ID@@' as project_id
            FROM dots.NaSequence
            WHERE LOWER(source_id) LIKE LOWER(REPLACE(REPLACE('$$sequenceId$$',' ',''), '*', '%'))
           ]]>
        </sql>
    </sqlQuery>
    
    <wsQuery name="SequenceBySourceId" includeProjects="ApiDB"
        isCacheable='true' processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin"> 
        <paramRef ref="sharedParams.genomicSequence"/>
        <wsColumn name="source_id" width="32" wsName="source_id"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
    </wsQuery>
    
    
    <!-- ************************************************************ -->
    <!-- Species -->  
    <!-- ************************************************************ -->

    <sqlQuery name="SequencesByTaxon" excludeProjects="ApiDB"
        isCacheable="true">
        <paramRef ref="organismParams.organism" queryRef="organismVQ.withGenomicSeq"/>
        <column name="source_id"/>
        <sql excludeProjects="ApiDB">
            <![CDATA[
            SELECT DISTINCT ens.source_id, '@@PROJECT_ID@@' as project_id
            FROM dots.NaSequence ens, sres.SequenceOntology so
            WHERE ens.taxon_id IN (SELECT taxon_id FROM sres.taxon                        
               CONNECT BY parent_id = prior taxon_id
               START WITH taxon_id in ($$organism$$))
               AND ens.sequence_ontology_id = so.sequence_ontology_id
              AND (so.term_name = 'chromosome' 
                   OR so.term_name = 'supercontig'
                   OR so.term_name = 'contig')
            ORDER BY ens.source_id           
           ]]>
        </sql>
    </sqlQuery>
    
    <wsQuery name="SequencesByTaxon" includeProjects="ApiDB"
        isCacheable='true' processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
        <paramRef ref="organismParams.organism" queryRef="organismVQ.withGenomicSeq"/>
        <wsColumn name="source_id" width="32" wsName="source_id"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>            
    </wsQuery>
 
    
    <!-- ************************************************************ -->
    <!-- Similarity -->  
    <!-- ************************************************************ -->
    
    <wsQuery name="SequencesBySimilarity" includeProjects="CryptoDB"
        processName="org.apidb.apicomplexa.wsfplugin.wublast.WuBlastPlugin">
        <paramRef ref="sharedParams.BlastDatabaseType"/>
        <paramRef ref="genomicSimilarityParams.BlastDatabaseOrganism"/>
        <paramRef ref="sharedParams.BlastDatabaseOrganism"/>
        <paramRef ref="sharedparams.BlastQueryType"/>
        <paramRef ref="sharedparams.BlastQuerySequence"/>
        <paramRef ref="sharedparams.-e"/>
        <paramRef ref="sharedparams.-v"/>
        <paramRef ref="sharedparams.-b"/>
        <paramRef ref="sharedparams.-filter"/>
        
        <wsColumn name="source_id" width="32" wsName="Identifier"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
        <wsColumn name="TabularRow" width="3000"/>
        <wsColumn name="Alignment" width="4000"/>
        <wsColumn name="Header" width="3000"/>
        <wsColumn name="Footer" width="4000"/>
    </wsQuery>
    
    
    <wsQuery name="SequencesBySimilarity" includeProjects="PlasmoDB,ToxoDB"
        processName="org.apidb.apicomplexa.wsfplugin.ncbiblast.NcbiBlastPlugin">
        <paramRef ref="sequenceParams.BlastDatabaseType"/>
        <paramRef ref="genomicSimilarityParams.BlastDatabaseOrganism"/>
        <paramRef ref="sharedParams.BlastQueryType"/>
        <paramRef ref="sharedParams.BlastQuerySequence"/>
        <paramRef ref="sharedParams.-e"/>
        <paramRef ref="sharedParams.-v"/>
        <paramRef ref="sharedParams.-b"/>
        <paramRef ref="sharedParams.-filter"/>
        
        <wsColumn name="source_id" width="32" wsName="Identifier"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
        <wsColumn name="TabularRow" width="3000"/>
        <wsColumn name="Alignment" width="4000"/>
        <wsColumn name="Header" width="3000"/>
        <wsColumn name="Footer" width="3000"/>
    </wsQuery>
    
  
    <wsQuery name="SequencesBySimilarity" includeProjects="ApiDB" 
        processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
        <paramRef ref="sequenceParams.BlastDatabaseType"/>
        <paramRef ref="genomicSimilarityParams.BlastDatabaseOrganism"/>
        <paramRef ref="sharedParams.BlastQueryType"/>
        <paramRef ref="sharedParams.BlastQuerySequence"/>
        <paramRef ref="sharedParams.-e"/>
        <paramRef ref="sharedParams.-v"/>
        <paramRef ref="sharedParams.-b"/>
        <paramRef ref="sharedParams.-filter"/>
        
        <wsColumn name="source_id" width="60" wsName="source_id"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
        <wsColumn name="TabularRow" width="3000"/>
        <wsColumn name="Alignment" width="4000"/>
        <wsColumn name="Header" width="3000"/>
        <wsColumn name="Footer" width="3000"/>
    </wsQuery>
    
</wdkModel>
