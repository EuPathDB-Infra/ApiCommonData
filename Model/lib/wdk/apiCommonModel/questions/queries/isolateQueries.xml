<wdkModel>
  <querySet name="IsolateIds">

   <!-- notes
      
      - changed ms_assay param names
      - all components will have orfs so i changed the includes/excluded to reflect that

    -->
    
    <!-- ************************************************************ -->
    <!-- Isolate ID -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="IsolateByIsolateId" excludeProjects="ApiDB"
              displayName="ID" isCacheable="true">
        <paramRef ref="isolateParams.isolate_id"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql includeProjects="CryptoDB">
            <![CDATA[
                SELECT distinct etn.source_id as source_id, 
								       '@PROJECT_ID@' as project_id
                FROM   DoTS.ExternalNASequence etn,
								       SRes.ExternalDatabaseRelease edr,
											 SRes.ExternalDatabase edb
                WHERE  edr.external_database_id = edb.external_database_id
								   AND edr.external_database_release_id = etn.external_database_release_id
									 AND edb.name = 'Isolates Data Test3'
									 AND edr.version = '2007-10-18'
								   AND etn.source_id LIKE REPLACE($$isolate_id$$,'*','%')
            ]]>
        </sql>
    </sqlQuery>

		<!-- ************************************************************ -->
		<!-- Isolate Author -->
		<!-- ************************************************************ -->

		<sqlQuery name="IsolateByAuthor" excludeProjects="ApiDB"
							displayName="Author" isCacheable="true">
							<paramRef ref="isolateParams.author"/>
			<column name="source_id"/>
			<column name="project_id"/>
			<sql includeProjects="CryptoDB">
			<![CDATA[
					SELECT distinct etn.source_id as source_id,
							   '@PROJECT_ID@' as project_id
					FROM   DoTS.ExternalNASequence etn,
					       DoTS.NASequenceRef nasr,
					  		 SRES.Reference ref,
								 SRes.ExternalDatabaseRelease edr,
								 SRes.ExternalDatabase edb
					WHERE  nasr.reference_id = ref.reference_id
					   AND edr.external_database_id = edb.external_database_id
					   AND edr.external_database_release_id = etn.external_database_release_id
						 AND edb.name = 'Isolates Data Test3'
						 AND edr.version = '2007-10-18'
						 AND etn.na_sequence_id = nasr.na_sequence_id
						 AND ref.author LIKE REPLACE($$author$$,'*','%')
				 ]]>
			</sql>
		</sqlQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Taxon (Species) -->
	  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

		<sqlQuery name="IsolateByTaxon" excludeProjects="ApiDB">
			  <paramRef ref="isolateParams.isolate_organism" queryRef="organismIQ.withIsolates"/>
				<column name="source_id"/>
				<column name="project_id"/>
				<sql excludeProjects="ApiDB">
					<![CDATA[
						SELECT DISTINCT etn.source_id, '@PROJECT_ID@' as project_id
						FROM   DoTS.source src, 
						       DoTS.ExternalNASequence etn,
									 SRes.ExternalDatabaseRelease edr,
									 SRes.ExternalDatabase edb
						WHERE  etn.na_sequence_id IN
						       (SELECT sc.na_sequence_id
						        FROM dots.source sc
						        WHERE sc.organism in ('$$isolate_organism$$')
							     )
						   AND etn.source_id IS NOT NULL
						   AND etn.na_sequence_id = src.na_sequence_id
							 AND edr.external_database_id = edb.external_database_id
							 AND edr.external_database_release_id = etn.external_database_release_id
							 AND edb.name = 'Isolates Data Test3'
							 AND edr.version = '2007-10-18'
						ORDER BY etn.source_id
						]]>
				 </sql>
		</sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Host name (Specific_host) -->
	  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

		<sqlQuery name="IsolateByHost" excludeProjects="ApiDB">
			  <paramRef ref="isolateParams.specific_host" queryRef="hostVQ.withIsolates"/>
				<column name="source_id"/>
				<column name="project_id"/>
				<sql excludeProjects="ApiDB">
					<![CDATA[
						SELECT DISTINCT etn.source_id, '@PROJECT_ID@' as project_id
						FROM   DoTS.source src, 
						       DoTS.ExternalNASequence etn,
									 SRes.ExternalDatabaseRelease edr,
									 SRes.ExternalDatabase edb
						WHERE etn.na_sequence_id IN
						      (SELECT sc.na_sequence_id
						       FROM dots.source sc
						       WHERE sc.specific_host in ('$$specific_host$$')
							     )
						    AND etn.source_id IS NOT NULL
						    AND etn.na_sequence_id = src.na_sequence_id
								AND edr.external_database_id = edb.external_database_id
								AND edr.external_database_release_id = etn.external_database_release_id
								AND edb.name = 'Isolates Data Test3'
								AND edr.version = '2007-10-18'
						ORDER BY etn.source_id
						]]>
				 </sql>
		</sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Product -->
	  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

		<sqlQuery name="IsolateByProduct" excludeProjects="ApiDB">
			  <paramRef ref="isolateParams.product" queryRef="productVQ.withIsolates"/>
				<column name="source_id"/>
				<column name="project_id"/>
				<sql excludeProjects="ApiDB">
					<![CDATA[
						SELECT DISTINCT etn.source_id, '@PROJECT_ID@' as project_id
						FROM DoTS.ExternalNASequence etn, 
						     DoTS.GeneFeature gf,
						     DoTS.Transcript trp,
								 SRes.ExternalDatabaseRelease edr,
								 SRes.ExternalDatabase edb
						WHERE gf.na_feature_id = trp.parent_id 
						  AND gf.na_sequence_id = etn.na_sequence_id
						  AND trp.product IN ('$$product$$')
						  AND etn.source_id IS NOT NULL
							AND edr.external_database_id = edb.external_database_id
							AND edr.external_database_release_id = etn.external_database_release_id
							AND edb.name = 'Isolates Data Test3'
							AND edr.version = '2007-10-18'
						ORDER BY etn.source_id
						]]>
				 </sql>
		</sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Study -->
	  <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

		<sqlQuery name="IsolateByStudy" excludeProjects="ApiDB">
			  <paramRef ref="isolateParams.study" queryRef="studyVQ.withIsolates"/>
				<column name="source_id"/>
				<column name="project_id"/>
				<sql excludeProjects="ApiDB">
					<![CDATA[
						SELECT DISTINCT etn.source_id, '@PROJECT_ID@' as project_id
						FROM DoTS.ExternalNASequence etn, 
						     DoTS.NASequenceRef nasr,
								 SRES.Reference ref,
								 SRes.ExternalDatabaseRelease edr,
								 SRes.ExternalDatabase edb
						WHERE nasr.reference_id = ref.reference_id
						AND nasr.na_sequence_id = etn.na_sequence_id
						AND ref.title IN ('$$study$$')
						AND ref.title IS NOT NULL
						AND edr.external_database_id = edb.external_database_id
						AND edr.external_database_release_id = etn.external_database_release_id
						AND edb.name = 'Isolates Data Test3'
						AND edr.version = '2007-10-18'
						ORDER BY etn.source_id
						]]>
				 </sql>
		</sqlQuery>

  </querySet>
</wdkModel>
