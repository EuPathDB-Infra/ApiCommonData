#!/usr/bin/perl

# replace the <reference> tag in the file with a simple one that can be parsed
# by iedbMakeTabFileFromXml (seems like that script should be fixed to
# handle the original <reference> tag).  

use strict;

my $dir = $ARGV[0];
my $outDir = $ARGV[1];

usage() unless ($dir && $outDir);

my $f = `ls $dir | sort`;

my @files = split(/\n/,$f);

my $n = @files;

for(my $i=0; $i<$n; $i++) {
    my $file = $files[$i];
    my $outfn = "$outDir/$file";
    print "-----------\n";
    print "checking file $dir/$file\n";
    open (TABFILE, "$dir/$file") || die "File '$dir/$file' not found\n";
    open (TABF, "> $outfn") or die "could not APPEND to $outfn\n";
    <TABFILE>;
    print TABF 	"$_";
    <TABFILE>;
    print TABF 	"<References>\n";
    while (<TABFILE>){
	print TABF 	"$_";
    }
}

sub usage {

print STDERR "
fix xml files downloaded from IEDB.

replace the <reference> tag in each file with a simple one that can be parsed
by extractOrganismFromIEDBFile (seems like that script should be fixed to
handle the original <reference> tag).

usage: iedbFixXml input_dir output_dir

where input_dir contains a set of iedb xml files

";
exit(1);

}

