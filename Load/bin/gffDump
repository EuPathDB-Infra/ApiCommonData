#!/usr/bin/perl

my ($wdkModel, $annotQuestion, $seqQuestion, $organism, $outputFile, $keepStepFiles) = @ARGV;
die "\ngffDump <wdkModel> <AnnotationFullQuestion> <SequenceFullQuestion> <organism> <OutputFile> [keepStepFiles]\n\n"
  unless $wdkModel && $annotQuestion && $seqQuestion && $outputFile && $organism;

my $annotXmlFile = $outputFile . '.annotation.xml';
my $seqXmlFile = $outputFile . '.sequence.xml';
my $cmd;

$cmd = "wdkSummary -model $wdkModel -question $annotQuestion -toXml $annotXmlFile -params organism $organism";
print "running $cmd ...\n";
system("$cmd"); # or die "could not dump annotation data via wdkSummary";

$cmd = "wdkSummary -model $wdkModel -question $seqQuestion -toXml $seqXmlFile -params organism $organism";
print "running $cmd ...\n";
system("$cmd"); # or die "cound not dump sequence data via wdkSummary";

$cmd = "xmlToGff $annotXmlFile $outputFile";
print "running $cmd ...\n";
system("$cmd"); # or die "could not convert annotation xml into GFF";

$cmd = "xmlToGff $seqXmlFile $outputFile 1";
print "running $cmd ...\n";
system("$cmd"); # or die "could not convert sequence xml into GFF";

if (!$keepStepFiles) {
    $cmd = "/bin/rm $annotXmlFile $seqXmlFile";
    print "running $cmd ...\n";
    system("$cmd");
}
