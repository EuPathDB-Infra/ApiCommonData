#!@perl@
use strict;

use lib "$ENV{GUS_HOME}/lib/perl";
use File::Basename;
use ApiCommonData::Load::Steps;
use ApiCommonData::Load::MakeTaskDirs;
my $propertiesFile = shift(@ARGV);
my $optionalArgs = \@ARGV;


my ($mgr, $projectDir, $release, $allSpecies)
  = &initToxoAnalysis($propertiesFile, $optionalArgs);

##############################################################################
########   The Pipeline                                               ########
##############################################################################


##########Stop Before###################################
&extractKeywordSearchFiles($mgr, "ToxoDB_", "toxocomm", '@apidb.login_comment', "ToxoDB");
###########################################################

################################
##### BLASTX #####
################################

my $blastParams = "-cpus=2 -topcomboN=1 W=4 T=18 V=100 B=1000000 -hspmax=1000000 -gi E=1e-3 -wordmask=seg+xnu -hspsepQmax=4000 -span1";

&documentBlast($mgr, 'BLASTX', "Genomic sequence", "NRDB", $blastParams);

#regex for nr >gi|2829894|gb|AAC00602.1| Unknown protein [Arabidopsis thaliana]
&createSimilarityDir($mgr,"TgondiiGT1Contigs","nr","gi\\|(\\d+)\\|","$blastParams Y=61522197","blastx");

&createSimilarityDir($mgr,"TgondiiME49Contigs","nr","gi\\|(\\d+)\\|","$blastParams Y=61972543","blastx");

&createSimilarityDir($mgr,"TgondiiVEGContigs","nr","gi\\|(\\d+)\\|","$blastParams Y=62729184","blastx");

&createSimilarityDir($mgr,"TgondiiApicoplastChromosome","nr","gi\\|(\\d+)\\|","$blastParams Y=34996","blastx");

&createSimilarityDir($mgr,"NeosporaCaninumChromosomes","nr","gi\\|(\\d+)\\|","$blastParams Y=56804686","blastx");

&copyFilesToComputeCluster($mgr,"TgondiiGT1Contigs-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiME49Contigs-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiVEGContigs-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiApicoplastChromosome-nr","similarity");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumChromosomes-nr","similarity");

&moveDownloadFile($mgr,"NRDB/nr.gz","seqfiles");

&shortenDefLine($mgr,"nr","seqfiles");

##### extract files for BLASTX #####

&extractNaSeq($mgr,"T.gondii GT1 contigs from Genbank","2008-07-23",'TgondiiGT1',"contigs","ExternalNASequence","source_id");

&extractNaSeq($mgr,"T.gondii ME49 contigs from Genbank","2008-07-23",'TgondiiME49',"contigs","ExternalNASequence","source_id");

&extractNaSeq($mgr,"T.gondii VEG contigs from Genbank","2008-07-23",'TgondiiVEG',"contigs","ExternalNASequence","source_id");

&extractNaSeq($mgr,"Roos Lab T. gondii apicoplast","2008-08-04",'TgondiiApicoplast',"chromosome","ExternalNASequence","source_id");

&extractNaSeq($mgr,"Neospora caninum chromosome annotations from Sanger","2008-08-05",'NeosporaCaninum',"chromosomes","ExternalNASequence","source_id");

##### set up and run BLASTX of genomes against nr #####

&copyFilesToComputeCluster($mgr,"TgondiiGT1Contigs.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiME49Contigs.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiVEGContigs.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumChromosomes.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiApicoplastChromosome.fsa","seqfiles");

# perl -e 'while(<>){if ($_ !~ /^>/){ $_ =~ s/J/X/g;}print "$_";}' nr_bak.fsa > nr.fsa replace the 'J' in the seq with 'X'; 
# use xdformat -k to ignore the invalid letter 
&copyFilesToComputeCluster($mgr,"nr.fsa","seqfiles");

&startProteinBlastOnComputeCluster($mgr,"TgondiiGT1Contigs","nr","apidb","4");

&startProteinBlastOnComputeCluster($mgr,"TgondiiME49Contigs","nr","apidb","4");

&startProteinBlastOnComputeCluster($mgr,"TgondiiVEGContigs","nr","apidb","4");

&startProteinBlastOnComputeCluster($mgr,"TgondiiApicoplastChromosome","nr","apidb","4");

&startProteinBlastOnComputeCluster($mgr,"NeosporaCaninumChromosomes","nr","apidb","4");

##### Filter and Load BLASTX Results #####

&copyFilesFromComputeCluster($mgr,"TgondiiGT1Contigs-nr","similarity");

&copyFilesFromComputeCluster($mgr,"TgondiiME49Contigs-nr","similarity");

&copyFilesFromComputeCluster($mgr,"TgondiiVEGContigs-nr","similarity");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumChromosomes-nr","similarity");

$mgr->waitForCluster("TgondiiApicoplastChromosome blast similarity to nr", "waitTgondiiApicoplastChromosome-nr");

&copyFilesFromComputeCluster($mgr,"TgondiiApicoplastChromosome-nr","similarity");

&renameFile($mgr,"nr.fsa","nr_shortDefs.fsa","seqfiles");

&renameFile($mgr,"nr","nr.fsa","seqfiles");

&moveDownloadFile($mgr,"taxonomy/gi_taxid_prot.dmp.gz","misc");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/TgondiiGT1Contigs-nr/master/mainresult/");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/TgondiiME49Contigs-nr/master/mainresult/");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/TgondiiVEGContigs-nr/master/mainresult/");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/TgondiiApicoplastChromosome-nr/master/mainresult/");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/NeosporaCaninumChromosomes-nr/master/mainresult/");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Toxoplasma","gi_taxid_prot.dmp","TgondiiGT1Contigs-nr","blastSimilarity.unfiltered.out.gz");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Toxoplasma","gi_taxid_prot.dmp","TgondiiME49Contigs-nr","blastSimilarity.unfiltered.out.gz");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Toxoplasma","gi_taxid_prot.dmp","TgondiiVEGContigs-nr","blastSimilarity.unfiltered.out.gz");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Toxoplasma","gi_taxid_prot.dmp","TgondiiApicoplastChromosome-nr","blastSimilarity.unfiltered.out.gz");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Neospora","gi_taxid_prot.dmp","NeosporaCaninumChromosomes-nr","blastSimilarity.unfiltered.out.gz");

&extractIdsFromBlastResult($mgr,"TgondiiGT1Contigs-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiME49Contigs-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiVEGContigs-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiApicoplastChromosome-nr","subject");

&extractIdsFromBlastResult($mgr,"NeosporaCaninumChromosomes-nr","subject");

&loadNRDBSubset($mgr,"TgondiiGT1Contigs-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiME49Contigs-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiVEGContigs-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiApicoplastChromosome-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"NeosporaCaninumChromosomes-nr","blastSimIds.out","NRDB","2008-07-01");

&loadProteinBlast($mgr, "TgondiiGT1Contigs-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii GT1 contigs from Genbank","2008-07-23","NRDB","2008-07-01");

&loadProteinBlast($mgr, "TgondiiME49Contigs-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii ME49 contigs from Genbank","2008-07-23","NRDB","2008-07-01");

&loadProteinBlast($mgr, "TgondiiVEGContigs-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii VEG contigs from Genbank","2008-07-23","NRDB","2008-07-01");

&loadProteinBlast($mgr, "TgondiiApicoplastChromosome-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","Roos Lab T. gondii apicoplast","2008-08-04","NRDB","2008-07-01");

&loadProteinBlast($mgr, "NeosporaCaninumChromosomes-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","Neospora caninum annotations from Sanger","2008-08-05","NRDB","2008-07-01");


#####################################
##### BLASTP #####
#####################################

$blastParams = "-cpus=2 -topcomboN=1 V=100 B=20 -hspmax=1000000 -gi E=1e-3 -wordmask=seg -hspsepQmax=4000 -span1";

&documentBlast($mgr, 'BLASTP', "Protein sequences", "NRDB", $blastParams);

&createSimilarityDir($mgr,"TgondiiGT1AnnotatedProteins","nr","gi\\|(\\d+)\\|", $blastParams, "blastp");

&createSimilarityDir($mgr,"TgondiiME49AnnotatedProteins","nr","gi\\|(\\d+)\\|", $blastParams, "blastp");

&createSimilarityDir($mgr,"TgondiiVEGAnnotatedProteins","nr","gi\\|(\\d+)\\|", $blastParams, "blastp");

&createSimilarityDir($mgr,"TgondiiApicoplastAnnotatedProteins","nr","gi\\|(\\d+)\\|",$blastParams,"blastp");

&createSimilarityDir($mgr,"NeosporaCaninumAnnotatedProteins","nr","gi\\|(\\d+)\\|",$blastParams,"blastp");

&copyFilesToComputeCluster($mgr,"TgondiiGT1AnnotatedProteins-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiME49AnnotatedProteins-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiVEGAnnotatedProteins-nr","similarity");

&copyFilesToComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins-nr","similarity");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins-nr","similarity");

##### extract sequences for BLASTP #####

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiGT1","T.gondii GT1 contigs from Genbank","2008-07-23",507601);

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiME49","T.gondii ME49 contigs from Genbank","2008-07-23",508771);

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiVEG","T.gondii VEG contigs from Genbank","2008-07-23",432359);

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiApicoplast","Roos Lab T. gondii apicoplast","2008-08-04",383379);

&extractAnnotatedProteinsBySpecies($mgr, "NeosporaCaninum","Neospora caninum annotations from Sanger","2008-08-05",29176);

##### set up for BLASTP of proteins against nr #####

&copyFilesToComputeCluster($mgr,"TgondiiGT1AnnotatedProteins.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiME49AnnotatedProteins.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiVEGAnnotatedProteins.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins.fsa","seqfiles");

##### run BLASTP #####

&startProteinBlastOnComputeCluster($mgr,"TgondiiGT1AnnotatedProteins","nr","apidb");

&startProteinBlastOnComputeCluster($mgr,"TgondiiME49AnnotatedProteins","nr","apidb");

&startProteinBlastOnComputeCluster($mgr,"TgondiiVEGAnnotatedProteins","nr","apidb");

&startProteinBlastOnComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins","nr","apidb");

&startProteinBlastOnComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins","nr","apidb");

##### Load BLASTP Results #####

&copyFilesFromComputeCluster($mgr,"TgondiiGT1AnnotatedProteins-nr","similarity");

&copyFilesFromComputeCluster($mgr,"TgondiiME49AnnotatedProteins-nr","similarity");

&copyFilesFromComputeCluster($mgr,"TgondiiVEGAnnotatedProteins-nr","similarity");

&copyFilesFromComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins-nr","similarity");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins-nr","similarity");

&extractIdsFromBlastResult($mgr,"TgondiiGT1AnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiME49AnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiVEGAnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiME49PseudoAnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiVEGPseudoAnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"TgondiiApicoplastAnnotatedProteins-nr","subject");

&extractIdsFromBlastResult($mgr,"NeosporaCaninumAnnotatedProteins-nr","subject");

&loadNRDBSubset($mgr,"TgondiiGT1AnnotatedProteins-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiME49AnnotatedProteins-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiVEGAnnotatedProteins-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"TgondiiApicoplastAnnotatedProteins-nr","blastSimIds.out","NRDB","2008-07-01");

&loadNRDBSubset($mgr,"NeosporaCaninumAnnotatedProteins-nr","blastSimIds.out","NRDB","2008-07-01");

&loadProteinBlast($mgr, "TgondiiGT1AnnotatedProteins-nr","DoTS::TranslatedAASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii GT1 contigs from Genbank","2008-07-23","NRDB","2008-07-01","--subjectsLimit 50");

&loadProteinBlast($mgr, "TgondiiME49AnnotatedProteins-nr","DoTS::TranslatedAASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii ME49 contigs from Genbank","2008-07-23","NRDB","2008-07-01","--subjectsLimit 50");

&loadProteinBlast($mgr, "TgondiiVEGAnnotatedProteins-nr","DoTS::TranslatedAASequence", "DoTS::ExternalAASequence","source_id","source_id","T.gondii VEG contigs from Genbank","2008-07-23","NRDB","2008-07-01","--subjectsLimit 50");

&loadProteinBlast($mgr,"TgondiiApicoplastAnnotatedProteins-nr","DoTS::TranslatedAASequence", "DoTS::ExternalAASequence","source_id","source_id","Roos Lab T. gondii apicoplast","2008-08-04","NRDB","2008-07-01","--subjectsLimit 50");

&loadProteinBlast($mgr,"NeosporaCaninumAnnotatedProteins-nr","DoTS::TranslatedAASequence", "DoTS::ExternalAASequence","source_id","source_id","Neospora caninum annotations from Sanger","2008-08-05","NRDB","2008-07-01","--subjectsLimit 50");
#############################################################
##### Calculate Protein Wt and Isoelectric point #####
############################################################


&insertAASeqMWMinMax($mgr,"DoTS.TranslatedAASequence","T.gondii GT1 contigs from Genbank","2008-07-23");

&insertAASeqMWMinMax($mgr,"DoTS.TranslatedAASequence","T.gondii ME49 contigs from Genbank","2008-07-23");

&insertAASeqMWMinMax($mgr,"DoTS.TranslatedAASequence","T.gondii VEG contigs from Genbank","2008-07-23");

&insertAASeqMWMinMax($mgr,"DoTS.TranslatedAASequence","Roos Lab T. gondii apicoplast","2008-08-04");

&insertAASeqMWMinMax($mgr,"DoTS.TranslatedAASequence","Neospora caninum annotations from Sanger","2008-08-05");

#&documentAAip($mgr);

&insertAAiP($mgr,"DoTS.TranslatedAASequence","T.gondii GT1 contigs from Genbank","2008-07-23"); 

&insertAAiP($mgr,"DoTS.TranslatedAASequence","T.gondii ME49 contigs from Genbank","2008-07-23"); 

&insertAAiP($mgr,"DoTS.TranslatedAASequence","T.gondii VEG contigs from Genbank","2008-07-23"); 

&insertAAiP($mgr,"DoTS.TranslatedAASequence","Roos Lab T. gondii apicoplast","2008-08-04");

&insertAAiP($mgr,"DoTS.TranslatedAASequence","Neospora caninum annotations from Sanger","2008-08-05");

######################################################
####### TMHMM steps #######
#####################################################

&createTmhmmDir($mgr);

&documentTMHMM($mgr, "2.0a");

&runTMHmm($mgr,"TgondiiGT1");

&runTMHmm($mgr,"TgondiiME49");

&runTMHmm($mgr,"TgondiiVEG");

&runTMHmm($mgr,"TgondiiApicoplast");

&runTMHmm($mgr,"NeosporaCaninum");

&loadTMHmmData($mgr,"TgondiiGT1","T.gondii GT1 contigs from Genbank","2008-07-23");

&loadTMHmmData($mgr,"TgondiiME49","T.gondii ME49 contigs from Genbank","2008-07-23");

&loadTMHmmData($mgr,"TgondiiVEG","T.gondii VEG contigs from Genbank","2008-07-23");

&loadTMHmmData($mgr,"TgondiiApicoplast","Roos Lab T. gondii apicoplast","2008-08-04");

&loadTMHmmData($mgr,"NeosporaCaninum","Neospora caninum annotations from Sanger","2008-08-05");

############################################
######## Psipred ########
############################################

&documentPsipred($mgr,"2.4");

&createPsipredDirWithFormattedDb($mgr,"nr.fsa","seqfiles");

&fixProteinIdsForPsipred($mgr,"TgondiiGT1AnnotatedProteins.fsa","seqfiles");

&fixProteinIdsForPsipred($mgr,"TgondiiME49AnnotatedProteins.fsa","seqfiles");

&fixProteinIdsForPsipred($mgr,"TgondiiVEGAnnotatedProteins.fsa","seqfiles");

&fixProteinIdsForPsipred($mgr,"TgondiiApicoplastAnnotatedProteins.fsa","seqfiles");

&fixProteinIdsForPsipred($mgr,"NeosporaCaninumAnnotatedProteins.fsa","seqfiles");

&createPsipredSubdir($mgr,"TgondiiGT1AnnotatedProteinsPsipred.fsa","nr.fsa");

&createPsipredSubdir($mgr,"TgondiiME49AnnotatedProteinsPsipred.fsa","nr.fsa");

&createPsipredSubdir($mgr,"TgondiiVEGAnnotatedProteinsPsipred.fsa","nr.fsa");

&createPsipredSubdir($mgr,"TgondiiApicoplastAnnotatedProteinsPsipred.fsa","nr.fsa");

&createPsipredSubdir($mgr,"NeosporaCaninumAnnotatedProteinsPsipred.fsa","nr.fsa");

&copyFilesToComputeCluster($mgr, "psipred");

&copyFilesToComputeCluster($mgr,"TgondiiGT1AnnotatedProteinsPsipred.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiME49AnnotatedProteinsPsipred.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiVEGAnnotatedProteinsPsipred.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteinsPsipred.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumAnnotatedProteinsPsipred.fsa","seqfiles");

&startPsipredOnComputeCluster($mgr,"TgondiiGT1AnnotatedProteinsPsipred.fsa","nr.fsa","apidb");

&startPsipredOnComputeCluster($mgr,"TgondiiME49AnnotatedProteinsPsipred.fsa","nr.fsa","apidb");

&startPsipredOnComputeCluster($mgr,"TgondiiVEGAnnotatedProteinsPsipred.fsa","nr.fsa","apidb");

&startPsipredOnComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteinsPsipred.fsa","nr.fsa","apidb");

&startPsipredOnComputeCluster($mgr,"NeosporaCaninumAnnotatedProteinsPsipred.fsa","nr.fsa","apidb");

$mgr->waitForCluster("TgondiiAnnotatedProteinsPsipred vs nr.fsaFilt psipred", "TgondiiAnnotatedProteinsPsipred.fsa-nr.fsaFilt");

$mgr->waitForCluster("TgondiiApicoplastAnnotatedProteinsPsipred vs nr.fsaFilt psipred", "TgondiiApicoplastAnnotatedProteinsPsipred.fsa-nr.fsaFilt");

&copyFilesFromComputeCluster($mgr, "TgondiiGT1AnnotatedProteinsPsipred.fsa-nr.fsaFilt", "psipred");

&copyFilesFromComputeCluster($mgr, "TgondiiME49AnnotatedProteinsPsipred.fsa-nr.fsaFilt", "psipred");

&copyFilesFromComputeCluster($mgr, "TgondiiVEGAnnotatedProteinsPsipred.fsa-nr.fsaFilt", "psipred");

&copyFilesFromComputeCluster($mgr, "TgondiiApicoplastAnnotatedProteinsPsipred.fsa-nr.fsaFilt", "psipred");

&copyFilesFromComputeCluster($mgr, "NeosporaCaninumAnnotatedProteinsPsipred.fsa-nr.fsaFilt", "psipred");

&fixPsipredFileNames($mgr, "psipred/TgondiiGT1AnnotatedProteinsPsipred.fsa-nr.fsaFilt");

&fixPsipredFileNames($mgr, "psipred/TgondiiME49AnnotatedProteinsPsipred.fsa-nr.fsaFilt");

&fixPsipredFileNames($mgr, "psipred/TgondiiVEGAnnotatedProteinsPsipred.fsa-nr.fsaFilt");

&fixPsipredFileNames($mgr, "psipred/TgondiiApicoplastAnnotatedProteinsPsipred.fsa-nr.fsaFilt");

&fixPsipredFileNames($mgr, "psipred/NeosporaCaninumAnnotatedProteinsPsipred.fsa-nr.fsaFilt");


### !!!!NEED TO UPDATE THE START AND END DATES BEFORE WE RUN THIS STEP!!!!! ###
&makeAlgInv($mgr,"Psipred","Psipred method for protein secondary structure prediction","2.5","2008-08-19","2008-08-19","Secondary Structure prediction for all Tgondii ME49 annotated proteins","TgondiiME49");

&makeAlgInv($mgr,"Psipred","Psipred method for protein secondary structure prediction","2.5","2008-08-19","2008-08-19","Secondary Structure prediction for all Tgondii GT1 annotated proteins","TgondiiGT1");

&makeAlgInv($mgr,"Psipred","Psipred method for protein secondary structure prediction","2.5","2008-08-19","2008-08-19","Secondary Structure prediction for all Tgondii VEG annotated proteins","TgondiiVEG");

&makeAlgInv($mgr,"Psipred","Psipred method for protein secondary structure prediction","2.5","2008-08-19","2008-08-19","Secondary Structure prediction for all TgondiiApicoplast annotated proteins","TgondiiApicoplast");

&makeAlgInv($mgr,"Psipred","Psipred method for protein secondary structure prediction","2.5","2008-08-19","2008-08-19","Secondary Structure prediction for all NeosporaCaninum annotated proteins","NeosporaCaninum")

&loadSecondaryStructures($mgr,"Psipred","2.5","2008-08-19","2008-08-19","TgondiiGT1AnnotatedProteinsPsipred.fsa-nr.fsaFilt",1,"Secondary Structure prediction for all Tgondii GT1 annotated proteins");

&loadSecondaryStructures($mgr,"Psipred","2.5","2008-08-19","2008-08-19","TgondiiME49AnnotatedProteinsPsipred.fsa-nr.fsaFilt",1,"Secondary Structure prediction for all Tgondii ME49 annotated proteins");

&loadSecondaryStructures($mgr,"Psipred","2.5","2008-08-19","2008-08-19","TgondiiVEGAnnotatedProteinsPsipred.fsa-nr.fsaFilt",1,"Secondary Structure prediction for all Tgondii VEG annotated proteins");

&loadSecondaryStructures($mgr,"Psipred","2.5","2008-08-19","2008-08-19","TgondiiApicoplastAnnotatedProteinsPsipred.fsa-nr.fsaFilt",1,"Secondary Structure prediction for all TgondiiApicoplast annotated proteins");

&loadSecondaryStructures($mgr,"Psipred","2.5","2008-08-19","2008-08-19","NeosporaCaninumAnnotatedProteinsPsipred.fsa-nr.fsaFilt",1,"Secondary Structure prediction for all NeosporaCaninum annotated proteins");


#####################################################
####### signalP steps #######
####################################################

&createSignalPDir($mgr);

my $signalPParams = "-t euk -f short -m nn+hmm -q -trunc 70";

&documentSignalP($mgr, "3.0", $signalPParams);

&runSignalP($mgr,"TgondiiGT1", $signalPParams);

&runSignalP($mgr,"TgondiiME49", $signalPParams);

&runSignalP($mgr,"TgondiiVEG", $signalPParams);

&runSignalP($mgr,"TgondiiApicoplast", $signalPParams);

&runSignalP($mgr,"NeosporaCaninum", $signalPParams);

&loadSignalPData($mgr,"TgondiiGT1","T.gondii GT1 contigs from Genbank","2008-07-23");

&loadSignalPData($mgr,"TgondiiME49","T.gondii ME49 contigs from Genbank","2008-07-23");

&loadSignalPData($mgr,"TgondiiVEG","T.gondii VEG contigs from Genbank","2008-07-23");

&loadSignalPData($mgr,"TgondiiApicoplast","Roos Lab T. gondii apicoplast","2008-08-04");

&loadSignalPData($mgr,"NeosporaCaninum","Neospora caninum annotations from Sanger","2008-08-05");


##############################################
###### InterPro ######
#############################################

&createIprscanDir($mgr, "TgondiiGT1AnnotatedProteins.fsa");

&createIprscanDir($mgr, "TgondiiME49AnnotatedProteins.fsa");

&createIprscanDir($mgr, "TgondiiVEGAnnotatedProteins.fsa");

&createIprscanDir($mgr, "TgondiiApicoplastAnnotatedProteins.fsa");

&createIprscanDir($mgr, "NeosporaCaninumAnnotatedProteins.fsa");

&copyFilesToComputeCluster($mgr,"iprscan");

&startIprScanOnComputeCluster($mgr,"TgondiiGT1AnnotatedProteins.fsa","apidb", 1);

&startIprScanOnComputeCluster($mgr,"TgondiiME49AnnotatedProteins.fsa","apidb", 1);

&startIprScanOnComputeCluster($mgr,"TgondiiVEGAnnotatedProteins.fsa","apidb", 1);

&startIprScanOnComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins.fsa","apidb", 1);

&startIprScanOnComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins.fsa","apidb", 1);
##### Load InterPro #####

&copyFilesFromComputeCluster($mgr,"TgondiiGT1AnnotatedProteins.fsa","iprscan");

&copyFilesFromComputeCluster($mgr,"TgondiiME49AnnotatedProteins.fsa","iprscan");

&copyFilesFromComputeCluster($mgr,"TgondiiVEGAnnotatedProteins.fsa","iprscan");

&copyFilesFromComputeCluster($mgr,"TgondiiApicoplastAnnotatedProteins.fsa","iprscan");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumAnnotatedProteins.fsa","iprscan");

my $insertInterproConfig = "$projectDir/$release/resources_pipeline/primary/downloads/InterproscanData/iprscan17.0/iprscan/data/insertInterpro-config.xml";

my $interpro_version = "17.0";

&loadIprscanResults($mgr,"TgondiiGT1AnnotatedProteins.fsa", "INTERPRO", $interpro_version, $insertInterproConfig);

&loadIprscanResults($mgr,"TgondiiME49AnnotatedProteins.fsa", "INTERPRO", $interpro_version, $insertInterproConfig);

&loadIprscanResults($mgr,"TgondiiVEGAnnotatedProteins.fsa", "INTERPRO", $interpro_version, $insertInterproConfig);

&loadIprscanResults($mgr,"TgondiiApicoplastAnnotatedProteins.fsa", "INTERPRO", $interpro_version, $insertInterproConfig);

&loadIprscanResults($mgr,"NeosporaCaninumAnnotatedProteins.fsa", "INTERPRO", $interpro_version, $insertInterproConfig);

#####################################################
##### tandem repeat steps #####
####################################################

my $repeatFinderArgs = "2 7 7 80 20 50 500";

&documentTandemRepeatFinder($mgr,"3.21",$repeatFinderArgs);

&findTandemRepeats($mgr,"TgondiiGT1Contigs.fsa","seqfiles",$repeatFinderArgs);

&findTandemRepeats($mgr,"TgondiiME49Contigs.fsa","seqfiles",$repeatFinderArgs);

&findTandemRepeats($mgr,"TgondiiVEGContigs.fsa","seqfiles",$repeatFinderArgs);

&findTandemRepeats($mgr,"TgondiiApicoplastChromosome.fsa","seqfiles",$repeatFinderArgs);

&findTandemRepeats($mgr,"NeosporaCaninumChromosomes.fsa","seqfiles",$repeatFinderArgs);

&loadTandemRepeats($mgr,"TgondiiGT1Contigs.fsa",$repeatFinderArgs,"T.gondii GT1 contigs from Genbank","2008-07-23");

&loadTandemRepeats($mgr,"TgondiiME49Contigs.fsa",$repeatFinderArgs,"T.gondii ME49 contigs from Genbank","2008-07-23");

&loadTandemRepeats($mgr,"TgondiiVEGContigs.fsa",$repeatFinderArgs,"T.gondii VEG contigs from Genbank","2008-07-23");

&loadTandemRepeats($mgr,"TgondiiApicoplastChromosome.fsa",$repeatFinderArgs,"Roos Lab T. gondii apicoplast","2008-08-04");

&loadTandemRepeats($mgr,"NeosporaCaninumChromosomes.fsa",$repeatFinderArgs,"Neospora caninum annotations from Sanger","2008-08-05");

####################################################
##### low complexity steps #####
#####################################################

&documentLowComplexity($mgr, 'seg', 'Protein', 'x');

&filterSequences($mgr,"TgondiiGT1AnnotatedProteins.fsa","filter","seg","-x");

&filterSequences($mgr,"TgondiiME49AnnotatedProteins.fsa","filter","seg","-x");

&filterSequences($mgr,"TgondiiVEGAnnotatedProteins.fsa","filter","seg","-x");

&filterSequences($mgr,"TgondiiApicoplastAnnotatedProteins.fsa","filter","seg","-x");

&filterSequences($mgr,"NeosporaCaninumAnnotatedProteins.fsa","filter","seg","-x");

&documentLowComplexity($mgr, 'dust', 'Genomic', 'N');

&filterSequences($mgr,"TgondiiGT1Contigs.fsa","filter","dust");

&filterSequences($mgr,"TgondiiME49Contigs.fsa","filter","dust");

&filterSequences($mgr,"TgondiiVEGContigs.fsa","filter","dust");

&filterSequences($mgr,"TgondiiApicoplastChromosome.fsa","filter","dust");

&filterSequences($mgr,"NeosporaCaninumChromosomes.fsa","filter","dust");

&loadLowComplexitySequences($mgr,"TgondiiGT1AnnotatedProteins.fsa.seg","T.gondii GT1 contigs from Genbank","2008-07-23","protein","x");

&loadLowComplexitySequences($mgr,"TgondiiME49AnnotatedProteins.fsa.seg","T.gondii ME49 contigs from Genbank","2008-07-23","protein","x");

&loadLowComplexitySequences($mgr,"TgondiiVEGAnnotatedProteins.fsa.seg","T.gondii VEG contigs from Genbank","2008-07-23","protein","x");

&loadLowComplexitySequences($mgr,"TgondiiApicoplastAnnotatedProteins.fsa.seg","Roos Lab T. gondii apicoplast","2008-08-04","protein","x");

&loadLowComplexitySequences($mgr,"NeosporaCaninumAnnotatedProteins.fsa.seg","Neospora caninum annotations from Sanger","2008-08-05","protein","x");

&loadLowComplexitySequences($mgr,"TgondiiGT1Contigs.fsa.dust","T.gondii GT1 contigs from Genbank","2008-07-23","dna","N","--LowComplexityName 'dust'");

&loadLowComplexitySequences($mgr,"TgondiiME49Contigs.fsa.dust","T.gondii ME49 contigs from Genbank","2008-07-23","dna","N","--LowComplexityName 'dust'");

&loadLowComplexitySequences($mgr,"TgondiiVEGContigs.fsa.dust","T.gondii VEG contigs from Genbank","2008-07-23","dna","N","--LowComplexityName 'dust'");

&loadLowComplexitySequences($mgr,"TgondiiApicoplastChromosome.fsa.dust","Roos Lab T. gondii apicoplast","2008-08-04","dna","N","--LowComplexityName 'dust'");

&loadLowComplexitySequences($mgr,"NeosporaCaninumChromosomes.fsa.dust","Neospora caninum annotations from Sanger","2008-08-05","dna","N","--LowComplexityName 'dust'");

#########################################
###### ORFs ######
#########################################

&makeOrfFile($mgr, "TgondiiGT1Contigs.fsa", 50);

&makeOrfFile($mgr, "TgondiiME49Contigs.fsa", 50);

&makeOrfFile($mgr, "TgondiiVEGContigs.fsa", 50);

&makeOrfFile($mgr, "TgondiiApicoplastChromosome.fsa", 50);

&makeOrfFile($mgr, "NeosporaCaninumChromosomes.fsa", 50);

&loadOrfFile($mgr, "TgondiiGT1Contigs_orf50.gff","T.gondii GT1 contigs from Genbank","2008-07-23", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Toxoplasma gondii GT1");

&loadOrfFile($mgr, "TgondiiME49Contigs_orf50.gff","T.gondii ME49 contigs from Genbank","2008-07-23", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Toxoplasma gondii ME49");

&loadOrfFile($mgr, "TgondiiVEGContigs_orf50.gff","T.gondii VEG contigs from Genbank","2008-07-23", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Toxoplasma gondii VEG");

&loadOrfFile($mgr, "TgondiiApicoplastChromosome_orf50.gff","Roos Lab T. gondii apicoplast","2008-08-04", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Toxoplasma gondii RH");

&loadOrfFile($mgr, "NeosporaCaninumChromosomes_orf50.gff","Neospora caninum annotations from Sanger","2008-08-05", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Neospora caninum");


#########################################
##### ESTs #####
#########################################

&documentBLATAlignment($mgr,"v. 31","-minIntron 500,-minScore 30,-minIdentity 90");

&makeTranscriptSeqs($mgr,"Toxoplasma",5810,1);

&makeTranscriptSeqs($mgr,"Toxoplasma Predicted",5810,1,"select e.na_sequence_id 
           from dots.ExternalNASequence e, sres.sequenceontology s,
                sres.externalDatabase d, sres.externalDatabaseRelease r
           where e.taxon_id in(14109)
           and e.external_database_release_id = r.external_database_release_id
           and r.external_database_id = d.external_database_id
           and r.version = '2006-11-02'
           and d.name = 'WatanabeTgRH_PredictedTranscripts'
           and s.term_name = 'transcript'
           and e.sequence_ontology_id = s.sequence_ontology_id
           and e.na_sequence_id not in
           (select a.na_sequence_id from dots.AssemblySequence a)");

&makeTranscriptSeqs($mgr,"NeosporaCaninum",29176,1);

&extractTranscriptSeqs($mgr,"TgondiiESTSeqs",5811,1);

&extractTranscriptSeqs($mgr,"NeosporaCaninumESTSeqs",29176,1);

&extractIndividualNaSeq ($mgr,"T.gondii GT1 contigs from Genbank","2008-07-23","TgondiiGT1","genome","ExternalNASequence","source_id");

&extractIndividualNaSeq ($mgr,"T.gondii ME49 contigs from Genbank","2008-07-23","TgondiiME49","genome","ExternalNASequence","source_id");

&extractIndividualNaSeq ($mgr,"T.gondii VEG contigs from Genbank","2008-07-23","TgondiiVEG","genome","ExternalNASequence","source_id");

&extractIndividualNaSeq ($mgr,"Neospora caninum annotations from Sanger","2008-08-05","NeosporaCaninum","genome","ExternalNASequence","source_id");

&copyFilesToComputeCluster($mgr,"TgondiiGT1Genome","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiME49Genome","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiVEGGenome","seqfiles");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumGenome","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiESTSeqs.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"NeosporaCaninumESTSeqs.fsa","seqfiles");

&createGenomeDirForGfClient($mgr,"TgondiiESTSeqs", "TgondiiGT1Genome",16000,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiESTSeqs", "TgondiiME49Genome",16000,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiESTSeqs", "TgondiiVEGGenome",16000,4,1);

&createGenomeDirForGfClient($mgr,"NeosporaCaninumESTSeqs", "NeosporaCaninumGenome",16000,4,1);

&copyFilesToComputeCluster($mgr,"genome");

&createRepeatMaskDir_new($mgr,"TgondiiESTSeqs",4);

&createRepeatMaskDir_new($mgr,"NeosporaCaninumESTSeqs",4);

&copyFilesToComputeCluster($mgr,"repeatmask");

#delete the &runRepeatMask step in $GUS_HOME/bin/runGenomeAlignWithGfClient
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiESTSeqs', 'apidb');

&startRepeatMaskOnComputeCluster($mgr, 'NeosporaCaninumESTSeqs', 'apidb');

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiESTSeqs","TgondiiGT1Genome","apidb",4);

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiESTSeqs","TgondiiME49Genome","apidb",4);

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiESTSeqs","TgondiiVEGGenome","apidb",4);

&startGfClientWORepMaskOnComputeCluster($mgr,"NeosporaCaninumESTSeqs","NeosporaCaninumGenome","apidb",4);

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiGT1Genome","genome");


&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiME49Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiVEGGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiGT1NOAnnotationGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiME49NOAnnotationGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs-TgondiiVEGNOAnnotationGenome","genome");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumESTSeqs-NeosporaCaninumGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiESTSeqs","repeatmask");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumESTSeqs","repeatmask");

##script fills the BlatAlignmentQuality table ###########
&UpdateGusTableWithXml($mgr,"$ENV{PROJECT_HOME}/ApiCommonData/Load/config/blatalignmentquality.xml","BlatAlignmentQuality");

##we use the NCBI taxid for target genome as the ncbiTaxId (strain id), and queryNCBITaxid for query sequences (parent id).

&loadContigAlignments($mgr, 507601, "TgondiiESTSeqs","TgondiiGT1Genome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load", "","","",5811);

&loadContigAlignments($mgr, 508771, "TgondiiESTSeqs","TgondiiME49Genome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","","","",5811);

&loadContigAlignments($mgr, 432359, "TgondiiESTSeqs","TgondiiVEGGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","","","",5811);

&loadContigAlignments($mgr, 507601, "TgondiiESTSeqs","TgondiiGT1NOAnnotationGenome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load", "","","",5811);

&loadContigAlignments($mgr, 508771, "TgondiiESTSeqs","TgondiiME49NOAnnotationGenome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","","","",5811);

&loadContigAlignments($mgr, 432359, "TgondiiESTSeqs","TgondiiVEGNOAnnotationGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","","","",5811);

&loadContigAlignments($mgr, 29176, "NeosporaCaninumESTSeqs","NeosporaCaninumGenome","","","Neospora caninum annotations from Sanger","2008-08-05","ExternalNASequence",">(\\d+)","load", "","","",29176);

&loadContigAlignments($mgr, 507601, "TgondiiESTSeqs","TgondiiGT1Genome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 508771, "TgondiiESTSeqs","TgondiiME49Genome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 432359, "TgondiiESTSeqs","TgondiiVEGGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 507601, "TgondiiESTSeqs","TgondiiGT1NOAnnotationGenome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 508771, "TgondiiESTSeqs","TgondiiME49NOAnnotationGenome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 432359, "TgondiiESTSeqs","TgondiiVEGNOAnnotationGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","","",100,5811);

&loadContigAlignments($mgr, 29176, "NeosporaCaninumESTSeqs","NeosporaCaninumGenome","","","Neospora caninum annotations from Sanger","2008-08-05","ExternalNASequence",">(\\d+)","setbest","","",100,29176);



#####################################################
######## DoTS assemblies ########
###################################################

################# Tgondii ####################
##We use parent_id as the query taxon_id
&clusterMultiEstSourcesByAlign($mgr, "ESTs", "TgondiiME49", "T.gondii ME49 contigs from Genbank","2008-07-23", 5811, "ExternalNASequence",16000);

##Get all the ESTs which are not aligned to ME49 and put them in one cluster and assemble them.
#Parent_id as the taxid, strain_id (ME49) as the targetTaxId
&getNotAlignedEstAndAddOneCluster($mgr,"TgondiiME49",5811,1,508771,"/repeatmask/TgondiiESTSeqs/master/mainresult","/cluster/TgondiiME49ESTs");

&splitCluster($mgr, "TgondiiME49", "ESTs");

##use the parent taxid
&assembleTranscripts($mgr, "TgondiiME49", "", "", "ESTs", 5811);

##use the parent taxid
&extractAssemblies($mgr, "Tgondii", "Assemblies", 5811);

&copyFilesToComputeCluster($mgr, "TgondiiAssemblies.fsa","seqfiles");

&createGenomeDirForGfClient($mgr,"TgondiiAssemblies", "TgondiiGT1Genome",16000 ,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiAssemblies", "TgondiiME49Genome",16000 ,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiAssemblies", "TgondiiVEGGenome",16000 ,4,1);

&copyFilesToComputeCluster($mgr, "TgondiiAssemblies-TgondiiGT1Genome","genome");

&copyFilesToComputeCluster($mgr, "TgondiiAssemblies-TgondiiME49Genome","genome");

&copyFilesToComputeCluster($mgr, "TgondiiAssemblies-TgondiiVEGGenome","genome");

&createRepeatMaskDir_new($mgr,"TgondiiAssemblies",4);

&copyFilesToComputeCluster($mgr, "TgondiiAssemblies","repeatmask");

#delete the &runRepeatMask step in $GUS_HOME/bin/runGenomeAlignWithGfClient
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiAssemblies', 'apidb');

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiAssemblies","TgondiiGT1Genome","apidb",4);

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiAssemblies","TgondiiME49Genome","apidb",4);

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiAssemblies","TgondiiVEGGenome","apidb",4);

&copyFilesFromComputeCluster($mgr,"TgondiiAssemblies-TgondiiGT1Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiAssemblies-TgondiiME49Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiAssemblies-TgondiiVEGGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiAssemblies","repeatmask");

##we use the NCBI taxid for target genome as the ncbiTaxId (strain id), and queryNCBITaxid for query sequences (parent id).

&loadContigAlignments($mgr, 507601, "TgondiiAssemblies","TgondiiGT1Genome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load", "Assembly","",100,5811);

&loadContigAlignments($mgr, 508771, "TgondiiAssemblies","TgondiiME49Genome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","Assembly","",100,5811);

&loadContigAlignments($mgr, 432359, "TgondiiAssemblies","TgondiiVEGGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","Assembly","",100,5811);

&loadContigAlignments($mgr, 507601, "TgondiiAssemblies","TgondiiGT1Genome","","","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","Assembly","",100,5811);

&loadContigAlignments($mgr, 508771, "TgondiiAssemblies","TgondiiME49Genome","","","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","Assembly","",100,5811);

&loadContigAlignments($mgr, 432359, "TgondiiAssemblies","TgondiiVEGGenome","","","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","Assembly","",100,5811);

&updateAssemblySourceId($mgr,"Tgondii",5811);

########NeosporaCaninum ########

&clusterMultiEstSourcesByAlign($mgr, "ESTs", "NeosporaCaninum", "Neospora caninum annotations from Sanger","2008-08-05", 29176, "ExternalNASequence",16000);

&splitCluster($mgr, "NeosporaCaninum", "ESTs");

&assembleTranscripts($mgr, "NeosporaCaninum", "", "", "ESTs", 29176);

&extractAssemblies($mgr, "NeosporaCaninum", "Assemblies", 29176);

&copyFilesToComputeCluster($mgr, "NeosporaCaninumAssemblies.fsa","seqfiles");

&createGenomeDirForGfClient($mgr,"NeosporaCaninumAssemblies", "NeosporaCaninumGenome",16000 ,4,1);

&copyFilesToComputeCluster($mgr, "NeosporaCaninumAssemblies-NeosporaCaninumGenome","genome");

&createRepeatMaskDir_new($mgr,"NeosporaCaninumAssemblies",4);

&copyFilesToComputeCluster($mgr, "NeosporaCaninumAssemblies","repeatmask");

&startGenomeAlignOnComputeCluster($mgr,"NeosporaCaninumAssemblies","NeosporaCaninumGenome","apidb",4);

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumAssemblies-NeosporaCaninumGenome","genome");

&copyFilesFromComputeCluster($mgr,"NeosporaCaninumAssemblies","repeatmask");

&loadContigAlignments($mgr, 29176, "NeosporaCaninumAssemblies","NeosporaCaninumGenome","","","Neospora caninum annotations from Sanger","2008-08-05","ExternalNASequence",">(\\d+)","load", "Assembly","",100,29176);

&loadContigAlignments($mgr, 29176, "NeosporaCaninumAssemblies","NeosporaCaninumGenome","","","Neospora caninum annotations from Sanger","2008-08-05","ExternalNASequence",">(\\d+)","setbest","Assembly","",100,29176);

&updateAssemblySourceId($mgr,"Ncaninum",29176);

##################################################################
####### run MUMMER for SNPs and load results #######
##################################################################

&copy($mgr,"$projectDir/$release/resources_pipeline/primary/downloads/ME49_SNPs_fixed/Tg10x_31-StanfordSNPs.final.gff","$projectDir/$release/analysis_pipeline/primary/data/snp","$projectDir/$release/analysis_pipeline/primary/data/snp");

&copy($mgr,"$projectDir/$release/resources_pipeline/primary/downloads/GeneticMarkers_Sibley_fixed/Tg10x_31-SibleySNPs.fixed.gff","$projectDir/$release/analysis_pipeline/primary/data/snp");

&copy($mgr,"$projectDir/$release/resources_pipeline/primary/downloads/AmitAlignmentSnps/nucmerSnps.gff","$projectDir/$release/analysis_pipeline/primary/data/snp");

&snpGffToFasta($mgr,"Tg10x_31-StanfordSNPs.final.gff","ME49","gff2");

&snpGffToFasta($mgr,"Tg10x_31-SibleySNPs.fixed.gff","ME49","gff2");

&snpGffToFasta($mgr,"nucmerSnps.gff","ME49","gff2");

&runMummer($mgr,"TgondiiME49Supercontigs.fsa","Tg10x_31-StanfordSNPs.final");

&runMummer($mgr,"TgondiiME49Supercontigs.fsa","Tg10x_31-SibleySNPs.fixed");

&runMummer($mgr,"TgondiiME49Supercontigs.fsa","nucmerSnps");

&snpMummerToGFF($mgr,"TgondiiME49Supercontigs_Tg10x_31-StanfordSNPs.finalMummer","Tg10x_31-StanfordSNPs.final.gff","ME49","gff2");

&snpMummerToGFF($mgr,"TgondiiME49Supercontigs_Tg10x_31-SibleySNPs.fixedMummer","Tg10x_31-SibleySNPs.fixed.gff","ME49","gff2");

&snpMummerToGFF($mgr,"TgondiiME49Supercontigs_nucmerSnpsMummer","nucmerSnps.gff","ME49","gff2");

&loadMummerSnpResults($mgr,"John Boothroyd lab at Stanford","2004-08","T.gondii ME49 contigs from Genbank","2008-07-23","T.gondii ME49 contigs from Genbank","2008-07-23","DoTS::ExternalNASequence","Toxoplasma gondii","ME49","TgondiiME49Supercontigs_Tg10x_31-StanfordSNPs.finalMummer.gff");

&loadMummerSnpResults($mgr,"Genetic Markers - David Sibley","1","T.gondii ME49 contigs from Genbank","2008-07-23","T.gondii ME49 contigs from Genbank","2008-07-23","DoTS::ExternalNASequence","Toxoplasma gondii","ME49","TgondiiME49Supercontigs_Tg10x_31-SibleySNPs.fixedMummer.gff");

&loadMummerSnpResults($mgr,"Genomic Sequence SNPs","2006-10-10","T.gondii ME49 contigs from Genbank","2008-07-23","T.gondii ME49 contigs from Genbank","2008-07-23","DoTS::ExternalNASequence","Toxoplasma gondii","ME49","TgondiiME49Supercontigs_nucmerSnpsMummer.gff");

&copy($mgr,"$projectDir/$release/resources_pipeline/primary/downloads/Lindstrom454Snps/Lindstrom454Snps.gff","$projectDir/$release/analysis_pipeline/primary/data/snp","$projectDir/$release/analysis_pipeline/primary/data/snp");

&dumpNaSequence($mgr,"$projectDir/$release/analysis_pipeline/primary/data/seqfiles","TgondiiME49ContigsNew","","","T.gondii ME49 contigs from Genbank","2008-07-23");

&snpGffToFasta($mgr,"Lindstrom454Snps.gff","Me49","gff2");

&runMummer($mgr,"TgondiiME49Contigs.fsa","Lindstrom454Snps");

&snpMummerToGFF($mgr,"TgondiiME49Contigs_Lindstrom454SnpsMummer","Lindstrom454Snps.gff","Me49","gff2");

#&loadMummerSnpResults($mgr,"Lindstrom 454 SNPs","2009-11-06","T.gondii ME49 contigs from Genbank","2008-07-23","T.gondii ME49 contigs from Genbank","2008-07-23","DoTS::ExternalNASequence","Toxoplasma gondii","ME49","TgondiiME49Contigs_Lindstrom454SnpsMummer.gff");

################################################
##### SAGE tag steps #####
#################################################

$mgr->{sageTagArrays}=({Tgondii=>[{name=>"T. gondii 3p SAGE tags from M. White lab",ver=>1},{name=>"T. gondii 5p SAGE tags from M. White lab",ver=>1}]});

&extractSageTags($mgr,"Tgondii");

$mgr->{genomeNaSequences}=({Tgondii=>[{name=>"T.gondii ME49 contigs from Genbank",ver=>"2008-07-23"}]});

&extractGenomeNaSequences($mgr, "Tgondii", "ExternalNASequence", "supercontig", 508771);

&mapSageTagsToNaSequences($mgr,"Tgondii");

&loadSageTagMap($mgr,"Tgondii");

&createSageTagNormFiles ($mgr,"T. gondii 3p SAGE tag frequencies", 290062);

&insertNormSageTagFreqs ($mgr,"T. gondii 3p SAGE tag frequencies");

#&createSageTagNormFiles ($mgr,"T. gondii 5p SAGE tag frequencies", 290062);

#&insertNormSageTagFreqs ($mgr,"T. gondii 5p SAGE tag frequencies");


##########################################################################
################## BAC and Cosmid Ends ###################################
#########################################################################

&extractNaSeq($mgr,"TgME49B7 Sanger BAC Ends","2001-09-19",'Tgondii',"BACEnds","ExternalNASequence","na_sequence_id");

&extractNaSeq($mgr,"Tg TIGR Cosmid Ends","2006-12-14",'Tgondii',"cosmidEnds","ExternalNASequence","na_sequence_id");

&copyFilesToComputeCluster($mgr,"TgondiiBACEnds.fsa","seqfiles");

&copyFilesToComputeCluster($mgr,"TgondiiCosmidEnds.fsa","seqfiles");

&createGenomeDirForGfClient($mgr,"TgondiiBACEnds", "TgondiiME49Genome",100,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiBACEnds", "TgondiiGT1Genome",100,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiBACEnds", "TgondiiVEGGenome",100,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiCosmidEnds", "TgondiiME49Genome",100,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiCosmidEnds", "TgondiiGT1Genome",100,4,1);

&createGenomeDirForGfClient($mgr,"TgondiiCosmidEnds", "TgondiiVEGGenome",100,4,1);

&copyFilesToComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiME49Genome","genome");

&copyFilesToComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiGT1Genome","genome");

&copyFilesToComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiVEGGenome","genome");

&copyFilesToComputeCluster($mgr,"TgondiiBACEnds-TgondiiME49Genome","genome");

&copyFilesToComputeCluster($mgr,"TgondiiBACEnds-TgondiiGT1Genome","genome");

&copyFilesToComputeCluster($mgr,"TgondiiBACEnds-TgondiiVEGGenome","genome");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiBACEnds","TgondiiME49Genome","apidb");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiBACEnds","TgondiiGT1Genome","apidb");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiBACEnds","TgondiiVEGGenome","apidb");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiCosmidEnds","TgondiiME49Genome","apidb");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiCosmidEnds","TgondiiGT1Genome","apidb");

&startGfClientWORepMaskOnComputeCluster($mgr,"TgondiiCosmidEnds","TgondiiVEGGenome","apidb");

$mgr->waitForCluster("TgondiiCosmidEnds BLAT alignment to TgondiiGenome", "waitTgondiiCosmidEnds-TgondiiGenome");

$mgr->waitForCluster("TgondiiBACEnds BLAT alignment to TgondiiGenome", "waitTgondiiBACEnds-TgondiiGenome");

&copyFilesFromComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiME49Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiVEGGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiCosmidEnds-TgondiiGT1Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiBACEnds-TgondiiME49Genome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiBACEnds-TgondiiVEGGenome","genome");

&copyFilesFromComputeCluster($mgr,"TgondiiBACEnds-TgondiiGT1Genome","genome");

&loadContigAlignments($mgr, 508771, "TgondiiBACEnds","TgondiiME49Genome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiBACEnds.fsa","",508771);

&loadContigAlignments($mgr, 432359, "TgondiiBACEnds","TgondiiVEGGenome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiBACEnds.fsa","",508771);

&loadContigAlignments($mgr, 507601, "TgondiiBACEnds","TgondiiGT1Genome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiBACEnds.fsa","",508771);

&loadContigAlignments($mgr, 508771, "TgondiiCosmidEnds","TgondiiME49Genome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiCosmidEnds.fsa","",383379);

&loadContigAlignments($mgr, 432359, "TgondiiCosmidEnds","TgondiiVEGGenome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiCosmidEnds.fsa","",383379);

&loadContigAlignments($mgr, 507601, "TgondiiCosmidEnds","TgondiiGT1Genome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","load","ExternalNASequence","TgondiiCosmidEnds.fsa","",383379);

&loadContigAlignments($mgr, 508771, "TgondiiBACEnds","TgondiiME49Genome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiBACEnds.fsa","100",508771);

&loadContigAlignments($mgr, 432359, "TgondiiBACEnds","TgondiiVEGGenome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiBACEnds.fsa","100",508771);

&loadContigAlignments($mgr, 507601, "TgondiiBACEnds","TgondiiGT1Genome","TgME49B7 Sanger BAC Ends","2001-09-19","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiBACEnds.fsa","100",508771);

&loadContigAlignments($mgr, 508771, "TgondiiCosmidEnds","TgondiiME49Genome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiCosmidEnds.fsa","100",383379);

&loadContigAlignments($mgr, 432359, "TgondiiCosmidEnds","TgondiiVEGGenome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiCosmidEnds.fsa","100",383379);

&loadContigAlignments($mgr, 507601, "TgondiiCosmidEnds","TgondiiGT1Genome","Tg TIGR Cosmid Ends","2006-12-14","T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence",">(\\d+)","setbest","ExternalNASequence","TgondiiCosmidEnds.fsa","100",383379);


###############################################################################################
##################################### IEDB Epitopes ################################
### Depends on Epitopes and the protein BLAST files made by the analysis pipeline###
################################################################################################

&makeAnnotatedProteinDownloadFileForncbiBlast($mgr, "TgondiiGT1", "TgondiiGT1AnnotatedProteins", "T.gondii GT1 contigs from Genbank","2008-07-23","ExternalNASequence","TgondiiGT1_Genbank");

&makeAnnotatedProteinDownloadFileForncbiBlast($mgr, "TgondiiME49", "TgondiiME49AnnotatedProteins", "T.gondii ME49 contigs from Genbank","2008-07-23","ExternalNASequence","TgondiiME49_Genbank");

&makeAnnotatedProteinDownloadFileForncbiBlast($mgr, "TgondiiVEG", "TgondiiVEGAnnotatedProteins", "T.gondii VEG contigs from Genbank","2008-07-23","ExternalNASequence","TgondiiVEG_Genbank");

&makeAnnotatedProteinDownloadFileForncbiBlast($mgr, "TgondiiApicoplast", "TgondiiApicoplastAnnotatedProteins", "Roos Lab T. gondii apicoplast","2008-08-04","ExternalNASequence","TgondiiApicoplast_Genbank");

&copyDirectory($mgr,"$projectDir/$release/resources_pipeline/primary/downloads/IEDB_Epitopes_fixed","$projectDir/$release/analysis_pipeline/primary/data/iedb/input","$projectDir/$release/analysis_pipeline/primary/data/iedb");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/Tgondii.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/IEDBExportME.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/Tgondii.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/IEDBExportGT.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/Tgondii.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/IEDBExportVE.txt","$projectDir/$release/analysis_pipeline/primary/data/iedb/input");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/Tgondii.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/IEDBExportVE.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/Tgondii.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/IEDBExportME.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta");

&copy($mgr,"$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/Tgondii.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta/IEDBExportGT.fsa","$projectDir/$release/analysis_pipeline/primary/data/iedb/input/fasta");


&formatncbiBlastFile($mgr,"TgondiiGT1AnnotatedProteins_ToxoDB-5.2.fasta","TgondiiGT1","TgondiiGT1_proteins","T");

&formatncbiBlastFile($mgr,"TgondiiME49AnnotatedProteins_ToxoDB-5.2.fasta","TgondiiME49","TgondiiME49_proteins","T");

&formatncbiBlastFile($mgr,"TgondiiVEGAnnotatedProteins_ToxoDB-5.2.fasta","TgondiiVEG","TgondiiVEG_proteins","T");

&formatncbiBlastFile($mgr,"TgondiiApicoplastAnnotatedProteins_ToxoDB-5.2.fasta","TgondiiApicoplast","TgondiiApicoplast_proteins","T");

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiGT1","T.gondii GT1 contigs from Genbank","2008-07-23",507601);

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiME49","T.gondii ME49 contigs from Genbank","2008-07-23",508771);

&extractAnnotatedProteinsBySpecies($mgr, "TgondiiVEG","T.gondii VEG contigs from Genbank","2008-07-23",432359);

&createEpitopeMapFiles($mgr, "input", "$projectDir/$release/analysis_pipeline/primary/data/blastSite", "$projectDir/$release/analysis_pipeline/primary/data/seqfiles");

&loadEpitopes($mgr, "$projectDir/$release/analysis_pipeline/primary/data/iedb/results/GT", "TgondiiGT1", "Links to IEDB epitopes|05-28-2009", "T.gondii GT1 contigs from Genbank|2008-07-23", "out");

&loadEpitopes($mgr, "$projectDir/$release/analysis_pipeline/primary/data/iedb/results/ME", "TgondiiME49", "Links to IEDB epitopes|05-28-2009", "T.gondii ME49 contigs from Genbank|2008-07-23", "out");

&loadEpitopes($mgr, "$projectDir/$release/analysis_pipeline/primary/data/iedb/results/VE", "TgondiiVEG", "Links to IEDB epitopes|05-28-2009", "T.gondii VEG contigs from Genbank|2008-07-23", "out");



#################################################
### gives AASequences a taxon id ###
##################################################
&updateTaxonIdField($mgr,"gi_taxid_prot.dmp","^(\\d+)","--ncbiTaxIdRegex \'^\\d+\\s(\\d+)\'","select source_id, aa_sequence_id from dots.externalaasequence","NRDB|2008-07-01","DoTS::ExternalAASequence");

##############################################################################
### This will calc the ACTG content for all seqs in ExternalNASequence ###
#############################################################################
&calculateACGT($mgr);

#&transformSimilarityCoordinates($mgr,"Ian Paulsen T. gondii scaffolds|2003-08-13","Chromosome Map - David Sibley|2005-08-01","query");

#&transformSimilarityCoordinates($mgr,"Ian Paulsen T. gondii scaffolds|2003-08-13","Chromosome Map - David Sibley|2005-08-01","subject");


####################################################################
##########ChIp-chip##################################################
#########from toxoDb/4.4/analysis_pipeline/hwang/toxoAnalysis#########
######################################################################

my $dataDir = $mgr->{dataDir};

my @properties = (["projectDir", "", "path to the project's directory tree"]);

my $propertySet  = CBIL::Util::PropertySet->new($propertiesFile, \@properties, 1);

my $projectDir = $propertySet->getProp('projectDir');

#&mapTagsToNaSequences($mgr, "$dataDir/seqfiles/TgondiiME49Contigs.fsa", "$projectDir/manualDelivery/ChIP_chip_einstein/chip_nr.fas", "ToxoDB4.4");

# called peaks
&mapTagsToNaSequences($mgr, "$dataDir/seqfiles/TgondiiME49Contigs.fsa", "$projectDir/manualDelivery/ChIP_chip_einstein/einstein_called_peaks/ChIP_called_peaks_probe.fas", "ToxoDB4.4_ChIP_called_peak");


#&loadExpressionFeature($mgr, "mapToxoDB4.4TagsToNaSequences.mapping", "ChIP Chip Einstein\|2008-08", "ArrayElementFeature", "ToxoDB4.4");

#&loadExpressionFeature($mgr, "mapToxoDB4.4_ChIP_called_peakTagsToNaSequences.mapping", "ChIP Chip Einstein Peaks|2008-08", "ArrayElementFeature", "ToxoDB4.4Peaks");


#&InsertSimpleRadAnalysisFromConfig($mgr, "$projectDir/manualDelivery/ChIP_chip_einstein/working_dir/analysis", "$projectDir/manualDelivery/ChIP_chip_einstein/working_dir/analysis/config.txt", "DataTransformationResult", "ArrayElementFeature", "ToxoDB4.4 ChIP-chip Einstein Analysis");



################from toxoDb/5.1/analysis_pipeline/jbrestel/toxoAnalysis#############

&mapTagsToNaSequences($mgr, "$dataDir/seqfiles/TgondiiME49Contigs.fsa", "$projectDir/manualDelivery/ChIP-chip/Hakimi.Ali/AcH4_DRUGA_vs_DMSO/working_dir/allRaw.fasta", "Hakimi_ChIP_RAW");
&mapTagsToNaSequences($mgr, "$dataDir/seqfiles/TgondiiME49Contigs.fsa", "$projectDir/manualDelivery/ChIP-chip/Hakimi.Ali/AcH4_DRUGA_vs_DMSO/working_dir/allPeaks.fasta", "Hakimi_ChIP_PEAKS");


&loadExpressionFeature($mgr, "mapHakimi_ChIP_RAWTagsToNaSequences.mapping", "ChIP Chip Hakimi\|2009-03", "ArrayElementFeature", "ToxoDB_ChIP_RAW");
&loadExpressionFeature($mgr, "mapHakimi_ChIP_PEAKSTagsToNaSequences.mapping", "ChIP Chip Hakimi Peaks\|2009-03", "ArrayElementFeature", "ToxoDB_ChIP_Peaks");

&InsertSimpleRadAnalysisFromConfig($mgr, "$projectDir/manualDelivery/ChIP-chip/Hakimi.Ali/AcH4_DRUGA_vs_DMSO/working_dir/", "$projectDir/manualDelivery/ChIP-chip/Hakimi.Ali/AcH4_DRUGA_vs_DMSO/working_dir/config.txt", "DataTransformationResult", "ArrayElementFeature", "ToxoDB5.1 ChIP-chip Hakimi Analysis", 1);


#&InsertSimpleRadAnalysisFromConfig($mgr, "/files/cbil/data/cbil/toxoDb/manualDelivery/ChIP-chip/Einstein_centromere/working_dir", "/files/cbil/data/cbil/toxoDb/manualDelivery/ChIP-chip/Einstein_centromere/working_dir/config.txt", "DataTransformationResult", "ArrayElementFeature", "ChIP-chipEinsteinAnalysis");

################################################################
##########  Map Isolates to Genome  ############################
################################################################

my $blastParams = "V=1 B=1 hspsepQmax=50000 hspsepSmax=50000 -span1 -topcomboN=1 E=0.1 -wordmask=seg";

&createSimilarityDir($mgr,"ToxoGenbankIsolates", "TgondiiGT1Contigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoGenbankIsolates", "TgondiiME49Contigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoGenbankIsolates", "TgondiiVEGContigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoGenbankIsolates", "TgondiiApicoplastChromosome","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoGenbankIsolates", "NeosporaCaninumChromosomes","(\\S+)", $blastParams, "blastn");

&extractNaSeq($mgr,"Toxoplasma isolates From Genbank","2009-05-04",'ToxoGenbank',"Isolates","ExternalNASequence","source_id");

&copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates.fsa","seqfiles");

 &copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiGT1Contigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiME49Contigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiVEGContigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiApicoplastChromosome","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoGenbankIsolates-NeosporaCaninumChromosomes","similarity");

 &startProteinBlastOnComputeCluster($mgr,"ToxoGenbankIsolates","TgondiiGT1Contigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoGenbankIsolates","TgondiiME49Contigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoGenbankIsolates","TgondiiVEGContigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoGenbankIsolates","TgondiiApicoplastChromosome","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoGenbankIsolates","NeosporaCaninumChromosomes","apidb");

 &copyFilesFromComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiGT1Contigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiME49Contigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiVEGContigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoGenbankIsolates-TgondiiApicoplastChromosome","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoGenbankIsolates-NeosporaCaninumChromosomes","similarity");


&loadProteinBlast($mgr, "ToxoGenbankIsolates-TgondiiGT1Contigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From Genbank","2009-05-04",'T.gondii GT1 contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoGenbankIsolates-TgondiiME49Contigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From Genbank","2009-05-04",'T.gondii ME49 contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoGenbankIsolates-TgondiiVEGContigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From Genbank","2009-05-04",'T.gondii VEG contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoGenbankIsolates-TgondiiApicoplastChromosome","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From Genbank","2009-05-04",'Roos Lab T. gondii apicoplast','2008-08-04', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoGenbankIsolates-NeosporaCaninumChromosomes","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From Genbank","2009-05-04",'Neospora caninum annotations from Sanger','2008-08-05', " --subjectsLimit 50 --hspsLimit 10 ");


&createSimilarityDir($mgr,"ToxoSibleyIsolates", "TgondiiGT1Contigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoSibleyIsolates", "TgondiiME49Contigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoSibleyIsolates", "TgondiiVEGContigs","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoSibleyIsolates", "TgondiiApicoplastChromosome","(\\S+)", $blastParams, "blastn");
&createSimilarityDir($mgr,"ToxoSibleyIsolates", "NeosporaCaninumChromosomes","(\\S+)", $blastParams, "blastn");

&extractNaSeq($mgr,"Toxoplasma isolates From David Sibley","2009-05-04",'ToxoSibley',"Isolates","ExternalNASequence","source_id");

&copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates.fsa","seqfiles");

 &copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiGT1Contigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiME49Contigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiVEGContigs","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiApicoplastChromosome","similarity");
 &copyFilesToComputeCluster($mgr,"ToxoSibleyIsolates-NeosporaCaninumChromosomes","similarity");

&startProteinBlastOnComputeCluster($mgr,"ToxoSibleyIsolates","TgondiiGT1Contigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoSibleyIsolates","TgondiiME49Contigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoSibleyIsolates","TgondiiVEGContigs","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoSibleyIsolates","TgondiiApicoplastChromosome","apidb");
 &startProteinBlastOnComputeCluster($mgr,"ToxoSibleyIsolates","NeosporaCaninumChromosomes","apidb");

 &copyFilesFromComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiGT1Contigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiME49Contigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiVEGContigs","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoSibleyIsolates-TgondiiApicoplastChromosome","similarity");
 &copyFilesFromComputeCluster($mgr,"ToxoSibleyIsolates-NeosporaCaninumChromosomes","similarity");


&loadProteinBlast($mgr, "ToxoSibleyIsolates-TgondiiGT1Contigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From David Sibley","2009-05-04",'T.gondii GT1 contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoSibleyIsolates-TgondiiME49Contigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From David Sibley","2009-05-04",'T.gondii ME49 contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoSibleyIsolates-TgondiiVEGContigs","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From David Sibley","2009-05-04",'T.gondii VEG contigs from Genbank','2008-07-23', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoSibleyIsolates-TgondiiApicoplastChromosome","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From David Sibley","2009-05-04",'Roos Lab T. gondii apicoplast','2008-08-04', " --subjectsLimit 50 --hspsLimit 10 ");
&loadProteinBlast($mgr, "ToxoSibleyIsolates-NeosporaCaninumChromosomes","DoTS::ExternalNASequence", "DoTS::ExternalNASequence","source_id","source_id","Toxoplasma isolates From David Sibley","2009-05-04",'Neospora caninum annotations from Sanger','2008-08-05', " --subjectsLimit 50 --hspsLimit 10 ");

###################################################
#######454 sequences#############################
##################################################
$blastParams = "-cpus=4 -topcomboN=1 W=4 T=18 V=100 B=1000000 -hspmax=1000000 -gi E=1e-3 -wordmask=seg+xnu -hspsepQmax=4000 -span1";

my $repeatFinderArgs = "2 7 7 80 20 50 500";

&createSimilarityDir($mgr,"Tgondii454Contigs","nr","gi\\|(\\d+)\\|","$blastParams Y=41929350","blastx");

&copyFilesToComputeCluster($mgr,"Tgondii454Contigs-nr","similarity");

&extractNaSeq($mgr,"Toxoplasma 454 sequences from Lindstrom","2009-05-04",'Tgondii454',"contigs","ExternalNASequence","source_id");

&copyFilesToComputeCluster($mgr,"Tgondii454Contigs.fsa","seqfiles");

&startProteinBlastOnComputeCluster($mgr,"Tgondii454Contigs","nr","apidb","4");

&copyFilesFromComputeCluster($mgr,"Tgondii454Contigs-nr","similarity");

&renameFile($mgr,"blastSimilarity.out.gz","blastSimilarity.unfiltered.out.gz","similarity/Tgondii454Contigs-nr/master/mainresult/");

&filterBLASTResults($mgr,"Eukaryota Apicomplexa Toxoplasma","gi_taxid_prot.dmp","Tgondii454Contigs-nr","blastSimilarity.unfiltered.out.gz");

&extractIdsFromBlastResult($mgr,"Tgondii454Contigs-nr","subject");

&loadNRDBSubset($mgr,"Tgondii454Contigs-nr","blastSimIds.out","NRDB","2008-07-01");

&loadProteinBlast($mgr, "Tgondii454Contigs-nr","DoTS::ExternalNASequence", "DoTS::ExternalAASequence","source_id","source_id","Toxoplasma 454 sequences from Lindstrom","2009-05-04","NRDB","2008-07-01");

&makeOrfFile($mgr, "Tgondii454Contigs.fsa", 50);

&loadOrfFile($mgr, "Tgondii454Contigs_orf50.gff","Toxoplasma 454 sequences from Lindstrom","2009-05-04", "$ENV{GUS_HOME}/lib/xml/isf/orf2gus.xml", "2.2","ExternalNASequence","Toxoplasma gondii");

&filterSequences($mgr,"Tgondii454Contigs.fsa","filter","dust");

&loadLowComplexitySequences($mgr,"Tgondii454Contigs.fsa.dust","Toxoplasma 454 sequences from Lindstrom","2009-05-04","dna","N","--LowComplexityName 'dust'");

#&findTandemRepeats($mgr,"Tgondii454Contigs.fsa","seqfiles",$repeatFinderArgs);

&loadTandemRepeats($mgr,"Tgondii454Contigs.fsa",$repeatFinderArgs,"Toxoplasma 454 sequences from Lindstrom","2009-05-04");



################################
##     Isolate Vocabulary     ##
################################

# Insert Ontology Terms
#&isolateVocabulary($mgr, "/files/cbil/data/cbil/toxoDb/manualDelivery/isolate_ontology/isolateVocabulary.txt");

# Update Database
#&isolateVocabularyUpdate($mgr, "isolation_source", "/files/cbil/data/cbil/toxoDb/manualDelivery/isolate_ontology/isolationSource.xml");
#&isolateVocabularyUpdate($mgr, "specific_host", "/files/cbil/data/cbil/toxoDb/manualDelivery/isolate_ontology/specificHost.xml");
#&isolateVocabularyUpdate($mgr, "geographic_location", "/files/cbil/data/cbil/toxoDb/manualDelivery/isolate_ontology/geographicLocation.xml");
#&isolateVocabularyUpdate($mgr, "product", "/files/cbil/data/cbil/toxoDb/manualDelivery/isolate_ontology/product.xml");


################################################################################
# Mercator
################################################################################

################################################################################
#########Species Mercator ###################################################
#########from toxoDb/4.4/analysis_pipeline/vishalkn/toxoSpeciesMercator#####
###############################################################################

# RepeatMasker steps
# NOTES #####################
# Don't get the fasta from the download site... use dumpSequence.pl
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_species/seqfiles","TgondiiGT1Genomic_Chr_toxoDB-4.4","T.gondii GT1 contigs from Genbank","2008-07-23","Tgondii GT1 Chromosome Map","2008-08-28");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_species/seqfiles","TgondiiME49Genomic_Chr_toxoDB-4.4","T.gondii ME49 contigs from Genbank","2008-07-23","Chromosome Map - David Sibley","2008-08-28");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_species/seqfiles","TgondiiVEGGenomic_Chr_toxoDB-4.4","T.gondii VEG contigs from Genbank","2008-07-23","Tgondii VEG Chromosome Map","2008-08-28");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_species/seqfiles","NeosporaGenomic_Chr_toxoDB-4.4","Neospora caninum annotations from Sanger","2008-08-05");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_species/seqfiles","TgondiiRHGenomic_Chr_toxoDB-4.4","T. gondii RH strain chromosomes","2");


# Should be fine... but maybe
#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&copyFilesToComputeCluster($mgr,'mercator');
#&copyFilesToComputeCluster($mgr, 'TgondiiGT1Genomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'TgondiiME49Genomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'TgondiiVEGGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PknowlesiGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PvivaxGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PyoeliiGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');

#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&createRepeatMaskDir_new($mgr, 'TgondiiGT1Genomic_Chr_toxoDB-4.4', 4,'-xsmall', 150,'mercator/Toxoplasma_species');
&createRepeatMaskDir_new($mgr, 'TgondiiME49Genomic_Chr_toxoDB-4.4', 4,'-xsmall', 150,'mercator/Toxoplasma_species');
&createRepeatMaskDir_new($mgr, 'TgondiiVEGGenomic_Chr_toxoDB-4.4', 4, '-xsmall', 150,'mercator/Toxoplasma_species');
&createRepeatMaskDir_new($mgr, 'TgondiiRHGenomic_Chr_toxoDB-4.4', 4, '-xsmall', 150,'mercator/Toxoplasma_species');
&createRepeatMaskDir_new($mgr, 'NeosporaGenomic_Chr_toxoDB-4.4', 4, '-xsmall', 150,'mercator/Toxoplasma_species');


#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&copyFilesToComputeCluster($mgr, 'repeatmask','mercator/Toxoplasma_species');

&startRepeatMaskOnComputeCluster($mgr, 'TgondiiGT1Genomic_Chr_toxoDB-4.4', 'apidb','mercator/Toxoplasma_species');
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiME49Genomic_Chr_toxoDB-4.4', 'apidb','mercator/Toxoplasma_species');
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiVEGGenomic_Chr_toxoDB-4.4', 'apidb','mercator/Toxoplasma_species');
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiRHGenomic_Chr_toxoDB-4.4', 'apidb','mercator/Toxoplasma_species');
&startRepeatMaskOnComputeCluster($mgr, 'NeosporaGenomic_Chr_toxoDB-4.4', 'apidb','mercator/Toxoplasma_species');


$mgr->waitForCluster("Repeat Mask TgondiiGT1Genomic_Chr_toxoDB-4.4", "TgondiiGT1Genomic_Chr_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask TgondiiME49Genomic_Chr_toxoDB-4.4", "TgondiiME49Genomic_Chr_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask TgondiiVEGGenomic_Chr_toxoDB-4.4", "TgondiiVEGGenomic_Chr_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask TgondiiRHGenomic_Chr_toxoDB-4.4", "TgondiiRHGenomic_Chr_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask NeosporaGenomic_Chr_toxoDB-4.4", "NeosporaGenomic_Chr_toxoDB-4.4");


&copyFilesFromComputeCluster($mgr, 'TgondiiME49Genomic_Chr_toxoDB-4.4', 'mercator/Toxoplasma_species/repeatmask');
&copyFilesFromComputeCluster($mgr, 'TgondiiVEGGenomic_Chr_toxoDB-4.4', 'mercator/Toxoplasma_species/repeatmask');
&copyFilesFromComputeCluster($mgr, 'TgondiiGT1Genomic_Chr_toxoDB-4.4', 'mercator/Toxoplasma_species/repeatmask');
&copyFilesFromComputeCluster($mgr, 'TgondiiRHGenomic_Chr_toxoDB-4.4', 'mercator/Toxoplasma_species/repeatmask');
&copyFilesFromComputeCluster($mgr, 'NeosporaGenomic_Chr_toxoDB-4.4', 'mercator/Toxoplasma_species/repeatmask');


&copy($mgr,"$dataDir/mercator/Toxoplasma_species/repeatmask/TgondiiME49Genomic_Chr_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_species/mercator/fasta/tgondii_me49_chr.fasta.in", "$dataDir/mercator/Toxoplasma_species/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/repeatmask/TgondiiGT1Genomic_Chr_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_species/mercator/fasta/tgondii_gt1_chr.fasta.in", "$dataDir/mercator/Toxoplasma_species/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/repeatmask/TgondiiVEGGenomic_Chr_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_species/mercator/fasta/tgondii_veg_chr.fasta.in", "$dataDir/mercator/Toxoplasma_species/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/repeatmask/TgondiiRHGenomic_Chr_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_species/mercator/fasta/tgondii_rh_chr.fasta.in", "$dataDir/mercator/Toxoplasma_species/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/repeatmask/NeosporaGenomic_Chr_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_species/mercator/fasta/neospora_chr.fasta.in", "$dataDir/mercator/Toxoplasma_species/mercator/fasta");

&modifyFile($mgr, "tgondii_gt1_chr.fasta.in", "tgondii_gt1_chr.fasta", "$dataDir/mercator/Toxoplasma_species/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "tgondii_me49_chr.fasta.in", "tgondii_me49_chr.fasta", "$dataDir/mercator/Toxoplasma_species/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "tgondii_veg_chr.fasta.in", "tgondii_veg_chr.fasta", "$dataDir/mercator/Toxoplasma_species/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "tgondii_rh_chr.fasta.in", "tgondii_rh_chr.fasta", "$dataDir/mercator/Toxoplasma_species/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "neospora_chr.fasta.in", "neospora_chr.fasta", "$dataDir/mercator/Toxoplasma_species/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');


&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/Tgondii_GT1_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/tgondii_gt1_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/Tgondii_ME49_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/tgondii_me49_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/Tgondii_VEG_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/tgondii_veg_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/Tgondii_RH_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/tgondii_rh_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/Neospora_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/neospora_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");

#&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/ToxoplasmaGhanaianGenomic_Chr_toxoDB-4.4_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/Toxoplasma_ghanaian_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
#&copy($mgr,"$dataDir/mercator/Toxoplasma_species/training_dir/ToxoplasmaITGenomic_Chr_toxoDB-4.4_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/gff/Toxoplasma_it_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");


&grepMercatorGff($mgr, "tgondii_gt1_chr.gff", "tgondii_gt1_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&grepMercatorGff($mgr, "tgondii_me49_chr.gff", "tgondii_me49_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&grepMercatorGff($mgr, "tgondii_veg_chr.gff", "tgondii_veg_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&grepMercatorGff($mgr, "tgondii_rh_chr.gff", "tgondii_rh_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&grepMercatorGff($mgr, "neospora_chr.gff", "neospora_chr.gff.in", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
#&grepMercatorGff($mgr, "Toxoplasma_ghanaian_chr.gff.in", "Toxoplasma_ghanaian_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
#&grepMercatorGff($mgr, "Toxoplasma_it_chr.gff.in", "Toxoplasma_it_chr.gff", "$dataDir/mercator/Toxoplasma_species/mercator/gff");
&fixMercatorOffsetsInGFF($mgr,"tgondii_me49_chr.fasta","tgondii_me49_chr.gff.in","tgondii_me49_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/","^>(\S+)","^apidb\|(\S+)");
&fixMercatorOffsetsInGFF($mgr,"tgondii_gt1_chr.fasta","tgondii_gt1_chr.gff.in","tgondii_gt1_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/","^>(\S+)","^apidb\|(\S+)");
&fixMercatorOffsetsInGFF($mgr,"tgondii_veg_chr.fasta","tgondii_veg_chr.gff.in","tgondii_veg_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/","^>(\S+)","^apidb\|(\S+)");
&fixMercatorOffsetsInGFF($mgr,"tgondii_rh_chr.fasta","tgondii_rh_chr.gff.in","tgondii_rh_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/","^>(\S+)","^apidb\|(\S+)");
&fixMercatorOffsetsInGFF($mgr,"neospora_chr.fasta","neospora_chr.gff.in","neospora_chr.gff","$dataDir/mercator/Toxoplasma_species/mercator/","^>(\S+)","^apidb\|(\S+)");

&runMercatorMavid($mgr, "$dataDir/mercator/Toxoplasma_species/mercator", "mercatorMavid-5StrainSpeciesGenomes");

&createExtDbAndDbRls($mgr, 'TgondiiGT1-Neospora synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiME49-Neospora synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiVEG-Neospora synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiGT1-TgondiiME49 synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiVEG-TgondiiME49 synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiGT1-TgondiiVEG synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiME49-TgondiiRH synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiGT1-TgondiiRH synteny from Mercator', '2008-09-10', '');
&createExtDbAndDbRls($mgr, 'TgondiiVEG-TgondiiRH synteny from Mercator', '2008-09-10', '');


&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_gt1_chr-tgondii_me49_chr.align",  "DoTS.NASequence", "DoTS.NASequence",  "Chromosome Map - David Sibley|2008-08-28,T.gondii ME49 contigs from Genbank|2008-07-23","Tgondii GT1 Chromosome Map|2008-08-28,T.gondii GT1 contigs from Genbank|2008-07-23", "TgondiiGT1-TgondiiME49 synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_me49_chr.agp","Toxoplasma");
&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_veg_chr-tgondii_me49_chr.align",  "DoTS.NASequence", "DoTS.NASequence", "Chromosome Map - David Sibley|2008-08-28,T.gondii ME49 contigs from Genbank|2008-07-23","Tgondii VEG Chromosome Map|2008-08-28,T.gondii VEG contigs from Genbank|2008-07-23",  "TgondiiVEG-TgondiiME49 synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_me49_chr.agp","Toxoplasma");
&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_gt1_chr-tgondii_veg_chr.align",  "DoTS.NASequence", "DoTS.NASequence", "Tgondii VEG Chromosome Map|2008-08-28,T.gondii VEG contigs from Genbank|2008-07-23", "Tgondii GT1 Chromosome Map|2008-08-28,T.gondii GT1 contigs from Genbank|2008-07-23", "TgondiiGT1-TgondiiVEG synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_veg_chr.agp","Toxoplasma");
&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_me49_chr-tgondii_rh_chr.align",  "DoTS.NASequence", "DoTS.NASequence", "T. gondii RH strain chromosomes|2,Roos Lab T. gondii apicoplast|2008-08-04",  "Chromosome Map - David Sibley|2005-08-01,T.gondii ME49 contigs from Genbank|2008-07-23","TgondiiME49-TgondiiRH synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_rh_chr.agp","Toxoplasma");
&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_gt1_chr-tgondii_rh_chr.align",  "DoTS.NASequence", "DoTS.NASequence", "T. gondii RH strain chromosomes|2,Roos Lab T. gondii apicoplast|2008-08-04",  "Tgondii GT1 Chromosome Map|2008-08-28,T.gondii GT1 contigs from Genbank|2008-07-23","TgondiiGT1-TgondiiRH synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_rh_chr.agp","Toxoplasma");
&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/Toxoplasma_species/mercator/tgondii_veg_chr-tgondii_rh_chr.align",  "DoTS.NASequence", "DoTS.NASequence", "T. gondii RH strain chromosomes|2,Roos Lab T. gondii apicoplast|2008-08-04",  "Tgondii VEG Chromosome Map|2008-08-28,T.gondii VEG contigs from Genbank|2008-07-23","TgondiiVEG-TgondiiRH synteny from Mercator|2008-09-10","$dataDir/mercator/Toxoplasma_species/mercator/mercator-output/tgondii_rh_chr.agp","Toxoplasma");


########################################################################################
####################Strains Mercator#################################################
#########from toxoDb/4.4/analysis_pipeline/vishalkn/toxoStrainsMercator#####
######################################################################################

# RepeatMasker steps


# NOTES #####################
# Don't get the fasta from the download site... use dumpSequence.pl
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_strains/seqfiles","TgondiiGT1Genomic_toxoDB-4.4","T.gondii GT1 contigs from Genbank","2008-07-23");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_strains/seqfiles","TgondiiME49Genomic_toxoDB-4.4","T.gondii ME49 contigs from Genbank","2008-07-23");
&dumpNaSequence($mgr,"$dataDir/mercator/Toxoplasma_strains/seqfiles","TgondiiVEGGenomic_toxoDB-4.4","T.gondii VEG contigs from Genbank","2008-07-23");


# Should be fine... but maybe
#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&copyFilesToComputeCluster($mgr,'mercator');
#&copyFilesToComputeCluster($mgr, 'TgondiiGT1Genomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'TgondiiME49Genomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'TgondiiVEGGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PknowlesiGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PvivaxGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');
#&copyFilesToComputeCluster($mgr, 'PyoeliiGenomic_toxoDB-4.4.fsa', 'mercator/seqfiles');

#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&createRepeatMaskDir_new($mgr, 'TgondiiGT1Genomic_toxoDB-4.4', 4,'-xsmall', 150,'mercator/Toxoplasma_strains');
&createRepeatMaskDir_new($mgr, 'TgondiiME49Genomic_toxoDB-4.4', 4,'-xsmall', 150,'mercator/Toxoplasma_strains');
&createRepeatMaskDir_new($mgr, 'TgondiiVEGGenomic_toxoDB-4.4', 4, '-xsmall', 150,'mercator/Toxoplasma_strains');


#**** These steps use the same repeatmask dir used in the main pipeline which causes a conflict!! ****
&copyFilesToComputeCluster($mgr, 'repeatmask','mercator/Toxoplasma_strains');

&startRepeatMaskOnComputeCluster($mgr, 'TgondiiGT1Genomic_toxoDB-4.4', 'apidb','mercator/Toxoplasma_strains');
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiME49Genomic_toxoDB-4.4', 'apidb','mercator/Toxoplasma_strains');
&startRepeatMaskOnComputeCluster($mgr, 'TgondiiVEGGenomic_toxoDB-4.4', 'apidb','mercator/Toxoplasma_strains');


$mgr->waitForCluster("Repeat Mask TgondiiGT1Genomic_toxoDB-4.4", "TgondiiGT1Genomic_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask TgondiiME49Genomic_toxoDB-4.4", "TgondiiME49Genomic_toxoDB-4.4");
$mgr->waitForCluster("Repeat Mask TgondiiVEGGenomic_toxoDB-4.4", "TgondiiVEGGenomic_toxoDB-4.4");


&copyFilesFromComputeCluster($mgr, 'TgondiiME49Genomic_toxoDB-4.4', 'mercator/Toxoplasma_strains/repeatmask');
&copyFilesFromComputeCluster($mgr, 'TgondiiVEGGenomic_toxoDB-4.4', 'mercator/Toxoplasma_strains/repeatmask');
&copyFilesFromComputeCluster($mgr, 'TgondiiGT1Genomic_toxoDB-4.4', 'mercator/Toxoplasma_strains/repeatmask');


&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/repeatmask/TgondiiME49Genomic_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_strains/mercator/fasta/tgondii_me49.fasta.in", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/repeatmask/TgondiiGT1Genomic_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_strains/mercator/fasta/tgondii_gt1.fasta.in", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta");
&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/repeatmask/TgondiiVEGGenomic_toxoDB-4.4/master/mainresult/blocked.seq","$dataDir/mercator/Toxoplasma_strains/mercator/fasta/tgondii_veg.fasta.in", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta");

&modifyFile($mgr, "tgondii_gt1.fasta.in", "tgondii_gt1.fasta", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "tgondii_me49.fasta.in", "tgondii_me49.fasta", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');
&modifyFile($mgr, "tgondii_veg.fasta.in", "tgondii_veg.fasta", "$dataDir/mercator/Toxoplasma_strains/mercator/fasta", '\>[\w\d-\.]+\|([\w\d_\.]+)\|.*/>$1');


&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/training_dir/Tgondii_GT1.gff","$dataDir/mercator/Toxoplasma_strains/mercator/gff/tgondii_gt1.gff.in", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/training_dir/Tgondii_ME49.gff","$dataDir/mercator/Toxoplasma_strains/mercator/gff/tgondii_me49.gff.in", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/training_dir/Tgondii_VEG.gff","$dataDir/mercator/Toxoplasma_strains/mercator/gff/tgondii_veg.gff.in", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
#&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/training_dir/ToxoplasmaGhanaianGenomic_toxoDB-4.4.gff","$dataDir/mercator/Toxoplasma_strains/mercator/gff/Toxoplasma_ghanaian.gff.in", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
#&copy($mgr,"$dataDir/mercator/Toxoplasma_strains/training_dir/ToxoplasmaITGenomic_toxoDB-4.4.gff","$dataDir/mercator/Toxoplasma_strains/mercator/gff/Toxoplasma_it.gff.in", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");


&grepMercatorGff($mgr, "tgondii_gt1.gff.in", "tgondii_gt1.gff", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
&grepMercatorGff($mgr, "tgondii_me49.gff.in", "tgondii_me49.gff", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
&grepMercatorGff($mgr, "tgondii_veg.gff.in", "tgondii_veg.gff", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
#&grepMercatorGff($mgr, "Toxoplasma_ghanaian.gff.in", "Toxoplasma_ghanaian.gff", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");
#&grepMercatorGff($mgr, "Toxoplasma_it.gff.in", "Toxoplasma_it.gff", "$dataDir/mercator/Toxoplasma_strains/mercator/gff");


&runMercatorMavid($mgr, "$dataDir/mercator/Toxoplasma_strains/mercator", "mercatorMavid-3StrainGenomes");

#&createExtDbAndDbRls($mgr, 'berghei-falciparum synteny from Mercator', '2007-09-28', '');
#&createExtDbAndDbRls($mgr, 'chabaudi-falciparum synteny from Mercator', '2007-09-28', '');
#&createExtDbAndDbRls($mgr, 'knowlesi-falciparum synteny from Mercator', '2007-09-28', '');
#&createExtDbAndDbRls($mgr, 'vivax-falciparum synteny from Mercator', '2007-09-28', '');
#&createExtDbAndDbRls($mgr, 'yoelii-falciparum synteny from Mercator', '2007-09-28', '');

#&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/p_berghei-p_falciparum.align", "DoTS.ExternalNASequence", "DoTS.ExternalNASequence", "Sanger P. falciparum chromosomes|2007-06-28", "P. berghei genome|2006-02-27", "berghei-falciparum synteny from Mercator|2007-09-28");
#&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/p_chabaudi-p_falciparum.align", "DoTS.ExternalNASequence", "DoTS.ExternalNASequence", "Sanger P. falciparum chromosomes|2007-06-28", "P. chabaudi genome|2006-02-27", "chabaudi-falciparum synteny from Mercator|2007-09-28");
#&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/p_knowlesi-p_falciparum.align", "DoTS.ExternalNASequence", "DoTS.ExternalNASequence", "Sanger P. falciparum chromosomes|2007-06-28", "Sanger P. knowlesi chromosomes|2007-02-22", "knowlesi-falciparum synteny from Mercator|2007-09-28");
#&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/p_vivax-p_falciparum.align", "DoTS.ExternalNASequence", "DoTS.ExternalNASequence", "Sanger P. falciparum chromosomes|2007-06-28", "Jane Carlton P. vivax chromosomes|2005-09-01", "vivax-falciparum synteny from Mercator|2007-09-28");
#&insertMercatorSyntenySpans($mgr, "$dataDir/mercator/p_yoelii-p_falciparum.align", "DoTS.ExternalNASequence", "DoTS.ExternalNASequence", "Sanger P. falciparum chromosomes|2007-06-28", "Jane Carlton P. yoelii chromosomes|2002-09-10", "yoelii-falciparum synteny from Mercator|2007-09-28");


##########################################################################
####### make download files########
#########################################################################

&makeESTDownloadFileFromAllSources($mgr,"Tgondii", 5811, 1, "ToxoDB");

&makeESTDownloadFileFromAllSources($mgr,"NeosporaCaninum", 29176, 1, "ToxoDB");

#ESTs for all Tgondii assembled against ME49
&makeDoTSAssemblyDownloadFile ($mgr, 'Tgondii', 'assemblies',5811, 'ToxoDB');

&makeDoTSAssemblyDownloadFile ($mgr, 'NeosporaCaninum', 'assemblies',29176, 'ToxoDB');

&makeDerivedCdsDownloadFileTransformed($mgr, "Tgondii", "TgondiiGT1AnnotatedCDS","T.gondii GT1 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeDerivedCdsDownloadFileTransformed($mgr, "Tgondii", "TgondiiME49AnnotatedCDS","T.gondii ME49 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeDerivedCdsDownloadFileTransformed($mgr, "Tgondii", "TgondiiVEGAnnotatedCDS","T.gondii VEG contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeDerivedCdsDownloadFileTransformed($mgr, "Tgondii", "TgondiiApicoplastAnnotatedCDS","Roos Lab T. gondii apicoplast","2008-08-04","gb","ToxoDB",0);

&makeDerivedCdsDownloadFileTransformed($mgr, "NeosporaCaninum", "NeosporaCaninumAnnotatedCDS","Neospora caninum annotations from Sanger","2008-08-05","psu","ToxoDB",0);

&makeTranscriptDownloadFileTransformed($mgr, "Tgondii", "TgondiiGT1AnnotatedTranscripts","T.gondii GT1 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeTranscriptDownloadFileTransformed($mgr, "Tgondii", "TgondiiME49AnnotatedTranscripts","T.gondii ME49 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeTranscriptDownloadFileTransformed($mgr, "Tgondii", "TgondiiVEGAnnotatedTranscripts","T.gondii VEG contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeTranscriptDownloadFileTransformed($mgr, "Tgondii", "TgondiiApicoplastAnnotatedTranscripts","Roos Lab T. gondii apicoplast","2008-08-04","gb","ToxoDB",0);

&makeTranscriptDownloadFileTransformed($mgr, "NeosporaCaninum", "NeosporaCaninumAnnotatedTranscripts","Neospora caninum annotations from Sanger","2008-08-05","psu","ToxoDB",0);

&makeAnnotatedProteinDownloadFileTransformed($mgr, "Tgondii", "TgondiiGT1AnnotatedProteins","T.gondii GT1 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeAnnotatedProteinDownloadFileTransformed($mgr, "Tgondii", "TgondiiME49AnnotatedProteins","T.gondii ME49 contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeAnnotatedProteinDownloadFileTransformed($mgr, "Tgondii", "TgondiiVEGAnnotatedProteins","T.gondii VEG contigs from Genbank","2008-07-23","gb","ToxoDB",0);

&makeAnnotatedProteinDownloadFileTransformed($mgr, "Tgondii", "TgondiiApicoplastAnnotatedProteins","Roos Lab T. gondii apicoplast","2008-08-04","gb","ToxoDB",0);

&makeAnnotatedProteinDownloadFileTransformed($mgr, "NeosporaCaninum", "NeosporaCaninumAnnotatedProteins","Neospora caninum annotations from Sanger","2008-08-05","psu","ToxoDB",0);

&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiGT1Orfs","T.gondii GT1 contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiME49Orfs","T.gondii ME49 contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiVEGOrfs","T.gondii VEG contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiApicoplastOrfs","Roos Lab T. gondii apicoplast","2008-08-04",50,"ToxoDB");

&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "NeosporaCaninum", "NeosporaCaninumOrfs","Neospora caninum annotations from Sanger","2008-08-05",50,"ToxoDB");

&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiGT1OrfsNAs","T.gondii GT1 contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiME49OrfsNAs","T.gondii ME49 contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiVEGOrfsNAs","T.gondii VEG contigs from Genbank","2008-07-23",50,"ToxoDB");

&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "TgondiiApicoplastOrfsNAs","Roos Lab T. gondii apicoplast","2008-08-04",50,"ToxoDB");

&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "NeosporaCaninum", "NeosporaCaninumOrfsNAs","Neospora caninum annotations from Sanger","2008-08-05",50,"ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "Tgondii", "TgondiiGT1Genomic","T.gondii GT1 contigs from Genbank,Tgondii GT1 Chromosome Map","2008-07-23,2008-08-28","gb","ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "Tgondii", "TgondiiME49Genomic","T.gondii ME49 contigs from Genbank,Chromosome Map - David Sibley","2008-07-23,2008-08-28","gb","ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "Tgondii", "TgondiiVEGGenomic","T.gondii VEG contigs from Genbank,Tgondii VEG Chromosome Map","2008-07-23,2008-08-28","gb","ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "Tgondii", "TgondiiRHGenomic","T. gondii RH strain chromosomes","2","psu","ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "Tgondii", "TgondiiApicoplastGenomic","Roos Lab T. gondii apicoplast","2008-08-04","gb","ToxoDB");

&makeMixedGenomicDownloadFile($mgr, "NeosporaCaninum", "NeosporaCaninumGenomic","Neospora caninum annotations from Sanger","2008-08-05","psu","ToxoDB");

&makeInterproDownloadFile ($mgr, 'Tgondii', "GT1Interpro", "T.gondii GT1 contigs from Genbank","2008-07-23", "INTERPRO", "17.0", "ToxoDB");

&makeInterproDownloadFile ($mgr, 'Tgondii', "ME49Interpro", "T.gondii ME49 contigs from Genbank","2008-07-23", "INTERPRO", "17.0", "ToxoDB");

&makeInterproDownloadFile ($mgr, 'Tgondii', "VEGInterpro", "T.gondii VEG contigs from Genbank","2008-07-23", "INTERPRO", "17.0", "ToxoDB");

&makeInterproDownloadFile ($mgr, 'Tgondii', "ApicoplastInterpro", "Roos Lab T. gondii apicoplast","2008-08-04", "INTERPRO", "17.0", "ToxoDB");

&makeInterproDownloadFile ($mgr, 'NeosporaCaninum', "Interpro", "Neospora caninum annotations from Sanger","2008-08-05", "INTERPRO", "17.0", "ToxoDB");

&writeGeneAliasFile($mgr,"T.gondii GT1 contigs from Genbank","2008-07-23","ToxoDB",'Tgondii',"TgondiiGT1");

&writeGeneAliasFile($mgr,"T.gondii ME49 contigs from Genbank","2008-07-23","ToxoDB",'Tgondii',"TgondiiME49");

&writeGeneAliasFile($mgr,"T.gondii VEG contigs from Genbank","2008-07-23","ToxoDB",'Tgondii',"TgondiiVEG");

&writeGeneAliasFile($mgr,"Roos Lab T. gondii apicoplast","2008-08-04","ToxoDB",'Tgondii',"TgondiiApicoplast");

&writeGeneAliasFile($mgr,"Neospora caninum annotations from Sanger","2008-08-05","ToxoDB","NeosporaCaninum");

&concatFiles($mgr,"/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiGT1Orfs_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiME49Orfs_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiVEGOrfs_ToxoDB-4.4.fasta ","downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiOrfs_ToxoDB-4.4.fasta"); 

&concatFiles($mgr,"/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiGT1AnnotatedProteins_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiME49AnnotatedProteins_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiVEGAnnotatedProteins_ToxoDB-4.4.fasta ","downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiAnnotatedProteins_ToxoDB-4.4.fasta"); 

&concatFiles($mgr,"/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiGT1AnnotatedTranscripts_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiME49AnnotatedTranscripts_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiVEGAnnotatedTranscripts_ToxoDB-4.4.fasta ","downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiAnnotatedTranscripts_ToxoDB-4.4.fasta"); 

&concatFiles($mgr,"/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiGT1AnnotatedCDS_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiME49AnnotatedCDS_ToxoDB-4.4.fasta /files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiVEGAnnotatedCDS_ToxoDB-4.4.fasta ","downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiAnnotatedCDS_ToxoDB-4.4.fasta"); 

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiOrfs_ToxoDB-4.4.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiOrfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-4.4/Tgondii/TgondiiAnnotatedProteins_ToxoDB-4.4.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiAnnotatedProteins_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");
&makeIsolateDownloadFile($mgr, "", "ToxoSibleyIsolate", "Toxoplasma isolates From David Sibley","2009-05-04", "ExternalNASequence");
&makeIsolateDownloadFile($mgr, "", "ToxoGenbankIsolate", "Toxoplasma isolates From Genbank","2009-05-04", "ExternalNASequence");
&makeOrfDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "Tgondii454Orfs", "Toxoplasma 454 sequences from Lindstrom","2009-05-04", 50, "ToxoDB");
&makeOrfNaDownloadFileWithAbrevDeflineTransformed($mgr, "Tgondii", "Tgondii454OrfsNAs","Toxoplasma 454 sequences from Lindstrom","2009-05-04",50,"ToxoDB");
&makeMixedGenomicDownloadFile($mgr, "Tgondii", "Tgondii454Genomic","Toxoplasma 454 sequences from Lindstrom","2009-05-04","gb","ToxoDB");

##########################################################################
####### FormatBlastFiles ########
#########################################################################

&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiEST_ToxoDB-5.2.fasta","TgondiiEST","-n -t release-5.2/TgondiiEST");
&xdformatDownloadFileForBlastSite($mgr,"NeosporaCaninum","NeosporaCaninumEST_ToxoDB-5.2.fasta","NeosporaCaninumEST","-n -t release-5.2/NeosporaCaninumEST");


&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiAssemblies_ToxoDB-5.2.fasta","TgondiiAssemblies","-n -t release-5.2/TgondiiAssemblies");
&xdformatDownloadFileForBlastSite($mgr,"NeosporaCaninum","NeosporaCaninumAssemblies_ToxoDB-5.2.fasta","NeosporaCaninumAssemblies","-n -t release-5.2/NeosporaCaninumAssemblies");


&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiApicoplastAnnotatedTranscripts_ToxoDB-5.2.fasta",,"TgondiiApicoplastTranscripts","-n -t release-5.2/TgondiiApicoplastTranscripts");
&xdformatDownloadFileForBlastSite($mgr,"NeosporaCaninum","NeosporaCaninumAnnotatedTranscripts_ToxoDB-5.2.fasta",,"NeosporaCaninumTranscripts","-n -t release-5.2/NeosporaCaninumTranscripts");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiAnnotatedTranscripts_ToxoDB-5.2.fasta","TgondiiTranscripts","-n -t release-5.2/TgondiiTranscripts");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiGT1AnnotatedTranscripts_ToxoDB-5.2.fasta","TgondiiGT1Transcripts","-n -t release-5.2/TgondiiGT1Transcripts");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiME49AnnotatedTranscripts_ToxoDB-5.2.fasta","TgondiiME49Transcripts","-n -t release-5.2/TgondiiME49Transcripts");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiVEGAnnotatedTranscripts_ToxoDB-5.2.fasta","TgondiiVEGTranscripts","-n -t release-5.2/TgondiiVEGTranscripts");


&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiApicoplastAnnotatedProteins_ToxoDB-5.2.fasta","TgondiiApicoplastProteins","-p -C X -t release-5.2/TgondiiApicoplastProteins");
&xdformatDownloadFileForBlastSite($mgr,"NeosporaCaninum","NeosporaCaninumAnnotatedProteins_ToxoDB-5.2.fasta","NeosporaCaninumProteins","-p -C X -t release-5.2/NeosporaCaninumProteins");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiAnnotatedProteins_ToxoDB-5.2.fasta","TgondiiProteins","-p -C X -t release-5.2/TgondiiProteins");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiME49AnnotatedProteins_ToxoDB-5.2.fasta","TgondiiME49Proteins","-p -C X -t release-5.2/TgondiiME49Proteins");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiGT1AnnotatedProteins_ToxoDB-5.2.fasta","TgondiiGT1Proteins","-p -C X -t release-5.2/TgondiiGT1Proteins");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiVEGAnnotatedProteins_ToxoDB-5.2.fasta","TgondiiVEGProteins","-p -C X -t release-5.2/TgondiiVEGProteins");


&xdformatDownloadFileForBlastSite($mgr, "Tgondii","TgondiiGT1Orfs_ToxoDB-5.2.fasta","TgondiiGT1ORF","-p -C X -t release-5.2/TgondiiGT1ORF");
&xdformatDownloadFileForBlastSite($mgr, "Tgondii","TgondiiME49Orfs_ToxoDB-5.2.fasta","TgondiiME49ORF","-p -C X -t release-5.2/TgondiiME49ORF");
&xdformatDownloadFileForBlastSite($mgr, "Tgondii","TgondiiVEGOrfs_ToxoDB-5.2.fasta","TgondiiVEGORF","-p -C X -t release-5.2/TgondiiVEGORF");
&xdformatDownloadFileForBlastSite($mgr, "Tgondii","TgondiiApicoplastOrfs_ToxoDB-5.2.fasta","TgondiiApicoplastORF","-p -C X -t release-5.2/TgondiiApicoplastORF");
&xdformatDownloadFileForBlastSite($mgr, "NeosporaCaninum","NeosporaCaninumOrfs_ToxoDB-5.2.fasta","NeosporaCaninumORF","-p -C X -t release-5.2/NeosporaCaninumORF");
&xdformatDownloadFileForBlastSite($mgr, "Tgondii","TgondiiTgCkUg2Orfs_ToxoDB-5.2.fasta","TgondiiTgCkUg2ORF","-p -C X -t release-5.2/TgondiiTgCkUg2ORF");


&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiGenomic_ToxoDB-5.2.fasta","TgondiiGenomics","-n -t release-5.2/TgondiiGenomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiGT1Genomic_ToxoDB-5.2.fasta","TgondiiGT1Genomics","-n -t release-5.2/TgondiiGT1Genomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiME49Genomic_ToxoDB-5.2.fasta","TgondiiME49Genomics","-n -t release-5.2/TgondiiME49Genomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiVEGGenomic_ToxoDB-5.2.fasta","TgondiiVEGGenomics","-n -t release-5.2/TgondiiVEGGenomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiRHGenomic_ToxoDB-5.2.fasta","TgondiiRHGenomics","-n -t release-5.2/TgondiiRHGenomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiApicoplastGenomic_ToxoDB-5.2.fasta","TgondiiApicoplastGenomics","-n -t release-5.2/TgondiiApicoplastGenomics");
&xdformatDownloadFileForBlastSite($mgr,"NeosporaCaninum","NeosporaCaninumGenomic_ToxoDB-5.2.fasta","NeosporaCaninumGenomics","-n -t release-5.2/NeosporaCaninumGenomics");
&xdformatDownloadFileForBlastSite($mgr,"Tgondii","TgondiiTgCkUg2Genomic_ToxoDB-5.2.fasta","TgondiiTgCkUg2Genomics","-n -t release-5.2/TgondiiTgCkUg2Genomics");

&xdformatDownloadFileForBlastSite($mgr, "","ToxoDBIsolates.fasta","ToxoDBIsolates","-n -t release-5.2/ToxoDBIsolates");

#################################################
##########Codon Usage######################
################################################

&makeCodonUsage($mgr, "Tgondii", "AnnotatedCDS", "TgondiiGT1" );

&makeCodonUsage($mgr, "Tgondii", "AnnotatedCDS","TgondiiME49");

&makeCodonUsage($mgr, "Tgondii", "AnnotatedCDS","TgondiiVEG");

&makeCodonUsage($mgr, "Tgondii", "AnnotatedCDS","TgondiiApicoplast",);

&makeCodonUsage($mgr, "NeosporaCaninum", "AnnotatedCDS");

#################################################
##########WebService Motif######################
################################################

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/Tgondii/TgondiiGT1Orfs_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiGT1Orfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/Tgondii/TgondiiME49Orfs_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiME49Orfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/Tgondii/TgondiiVEGOrfs_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiVEGOrfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/Tgondii/TgondiiApicoplastOrfs_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiApicoplastOrfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/NeosporaCaninum/NeosporaCaninumOrfs_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/NeosporaCaninumOrfs_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/Tgondii/TgondiiApicoplastAnnotatedProteins_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/TgondiiApicoplastAnnotatedProteins_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");

&copy($mgr, "/files/cbil/data/cbil/apiSiteFiles/downloadSite/ToxoDB/release-5.0/NeosporaCaninum/NeosporaCaninumAnnotatedProteins_ToxoDB-5.0.fasta",  "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif/NeosporaCaninumAnnotatedProteins_ToxoDB.fasta", "/files/cbil/data/cbil/apiSiteFiles/webServices/ToxoDB/release-5.0/motif");


#############################################################################################
############Make Brc files#############
############################################################################################

&makeBrcSeqXmlFile($mgr, "T.gondii ME49 contigs from Genbank,Chromosome Map - David Sibley", "2008-07-23,2008-08-28", "t_gondii_Me49.gff", "no", "JCVI|JCVI|JCVI", "t_gondii_me49.xml", "toxobld", "JCVI", "","T.gondii");

&makeBrcSeqXmlFile($mgr, "T.gondii GT1 contigs from Genbank,Tgondii GT1 Chromosome Map", "2008-07-23,2008-08-28", "t_gondii_gt1.gff", "no", "JCVI|JCVI|JCVI", "t_gondii_gt1.xml", "toxobld", "JCVI", "","T.gondii");

&makeBrcSeqXmlFile($mgr, "T.gondii VEG contigs from Genbank,Tgondii VEG Chromosome Map", "2008-07-23,2008-08-28", "t_gondii_veg.gff", "no", "JCVI|JCVI|JCVI", "t_gondii_veg.xml", "toxobld", "JCVI", "","T.gondii");

&makeBrcSeqXmlFile($mgr, "Roos Lab T. gondii apicoplast", "2008-08-04", "t_gondii_apicoplast.gff", "no", "Genbank|Genbank|Genbank", "t_gondii_apicoplast.xml", "toxobld", "Genbank", "","T.gondii");

&makeBrcSeqXmlFile($mgr, "Neospora caninum annotations from Sanger", "2008-08-05", "neospora_canium.gff", "no", "Sanger|Sanger|Sanger", "neospora_canium.xml", "toxobld", "Sanger", "","Neospora");

&makeBrcGOAssociationFile($mgr, "T.gondii ME49 contigs from Genbank", "2008-07-23","t_gondii_me49.tab" ,"ApiDB_ToxoDB");

&makeBrcGOAssociationFile($mgr, "T.gondii GT1 contigs from Genbank", "2008-07-23","t_gondii_gt1.tab" ,"ApiDB_ToxoDB");

&makeBrcGOAssociationFile($mgr, "T.gondii VEG contigs from Genbank", "2008-07-23","t_gondii_veg.tab" ,"ApiDB_ToxoDB");

&makeBrcGOAssociationFile($mgr, "Roos Lab T. gondii apicoplast", "2008-08-04","t_gondii_apicoplast.tab" ,"ApiDB_ToxoDB");

&makeBrcGOAssociationFile($mgr, "Neospora caninum annotations from Sanger", "2008-08-05","neospora_canium.tab" ,"ApiDB_ToxoDB");

##############################################################################################
####### Requires WDK, ApiCommonWebsite, and ToxoDBWebsite to be updated #######
#############################################################################################

&clearWdkCache($mgr, "ToxoDB");

&runGffDump($mgr, "TgondiiGT1","ToxoDB", "Toxoplasma gondii GT1");

&runGffDump($mgr, "TgondiiME49","ToxoDB", "Toxoplasma gondii ME49");

&runGffDump($mgr, "TgondiiVEG","ToxoDB", "Toxoplasma gondii VEG");

&runGffDump($mgr, "NeosporaCaninum","ToxoDB", "Neospora Caninum");

&runWdkRecordDump($mgr,"TgondiiGT1","ToxoDB", "Toxoplasma gondii GT1","gene,sequence");

&runWdkRecordDump($mgr,"TgondiiME49","ToxoDB", "Toxoplasma gondii ME49","gene,sequence");

&runWdkRecordDump($mgr,"TgondiiVEG","ToxoDB", "Toxoplasma gondii VEG","gene,sequence");

&runWdkRecordDump($mgr,"NeosporaCaninum","ToxoDB", "Neospora Caninum","gene,sequence");


##### extract flat files for keyword-search web service #####

&extractKeywordSearchFiles($mgr, "", "comments2", '@apidb.login_comment', "ToxoDB");

&extractCommentsFiles($mgr, "", "comments2", '@apidb.login_comment', "ToxoDB", "$ENV{GUS_HOME}/config/apicomm.gus.config");


$mgr->goodbye("Pipeline complete!\n");

