<workflowGraph name="splign">

    <param name="queryExtDbRlsSpec"/>
    <param name="subjectExtDbRlsSpec"/>
    <param name="parentDataDir"/>

    <constant name="dataDir">$$parentDataDir$$/splign</constant>
    <constant name="queryFastaFile">$$dataDir$$/query.fsa</constant>
    <constant name="subjectFastaFile">$$dataDir$$/subject.fsa</constant>
    <constant name="splignOutputFile">$$dataDir$$/splign.out</constant>

    <step name="makeDataDir" class="ApiCommonData::Load::WorkflowSteps::MakeDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="extractQuery" class="ApiCommonData::Steps::ExtractNaSeq">
      <paramValue name="extDbRlsSpec">$$queryExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNaSequence</paramValue>
      <paramValue name="defline">'lcl|'||source_id'</paramValue>
      <paramValue name="outputFile">$$queryFastaFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends step="makeDataDir"/>
    </step>

    <step name="extractSubject" class="ApiCommonData::Steps::ExtractNaSeq">
      <paramValue name="extDbRlsSpec">$$subjectExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNaSequence</paramValue>
      <paramValue name="defline">'lcl|'||source_id'</paramValue>
      <paramValue name="outputFile">$$subjectFastaFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends step="makeDataDir"/>
    </step>

    <step name="runSplign" class="ApiCommonData::Steps::RunSplign">
      <paramValue name="queryFile">$$queryFastaFile$$</paramValue>
      <paramValue name="subjectFile">$$subjectFastaFile$$</paramValue>
      <paramValue name="outputFile">$$splignOutputFile$$</paramValue>
      <paramValue name="outputDir">$$parentDataDir$$/splign</paramValue>
      <depends step="extractQuery"/>
      <depends step="extractSubject"/>
    </step>

    <step name="insertSplign" class="ApiCommonData::Steps::InsertSplign">
      <paramValue name="queryExtDbRlsSpec">$$queryExtDbRlsSpec$$</paramValue>
      <paramValue name="subjectExtDbRlsSpec">$$subjectExtDbRlsSpec$$</paramValue>
      <paramValue name="inputFile">$$splignOutputFile$$</paramValue>
      <paramValue name="queryTable">ExternalNaSequence</paramValue>
      <paramValue name="subjectTable">ExternalNaSequence</paramValue>
      <depends step="runSplign"/>
    </step>

</workflowGraph>
