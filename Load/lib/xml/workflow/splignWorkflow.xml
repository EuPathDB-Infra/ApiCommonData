<workflow name="splign">
  <params>
    <param name="queryExtDbRlsSpec"/>
    <param name="subjectExtDbRlsSpec"/>
    <param name="genomeName"/>
    <param name="queryFastaFile"/>

  </params>

  <constants>
    <constant name="querySeqType">tcLCL</constant>
    <constant name="subjectSeqType">genomeLCL</constant>
    <constant name="table">ExternalNaSequence</constant>
  </constants>


  <steps>
    <step name="extractQuery" class="ApiCommonData::Steps::ExtractNaSeqAltDefLine">
      <paramValue name="extDbRlsSpec">$queryExtDbRlsSpec</paramValue>
      <paramValue name="genomeName">$genomeName</paramValue>
      <paramValue name="seqType">$querySeqType</paramValue>
      <paramValue name="table">$table</paramValue>
      <paramValue name="defline">'lcl|'||source_id'</paramValue>
      <paramValue name="outputFile">$queryFastaFile</paramValue>
    </step>

    <step name="extractSubject" class="ApiCommonData::Steps::ExtractNaSeqAltDefLine">
      <paramValue name="extDbRlsSpec">$$$subjectExtDbRlsSpec</paramValue>
      <paramValue name="genomeName">$$$genomeName</paramValue>
      <paramValue name="seqType">@@@subjectSeqType</paramValue>
      <paramValue name="table">@@@table</paramValue>
      <paramValue name="defline">'lcl|'||source_id'</paramValue>
    </step>

    <step name="runSplign" class="ApiCommonData::Steps::RunSplign">
      <paramValue name="genomeName">$$$genomeName</paramValue>
      <paramValue name="querySeqType">@@@querySeqType</paramValue>
      <paramValue name="subjectSeqType">@@@subjectSeqType</paramValue>
      <paramValue name="queryFile">$queryFastaFile</paramValue>
      <paramValue name="subjectFile">???</paramValue>
      <depends step="extractQuery"/>
      <depends step="extractSubject"/>
    </step>

    <step name="insertSplign" class="ApiCommonData::Steps::InsertSplign">
      <paramValue name="genomeName">$$$genomeName</paramValue>
      <paramValue name="querySeqType">@@@querySeqType</paramValue>
      <paramValue name="subjectSeqType">@@@subjectSeqType</paramValue>
      <paramValue name="queryExtDbRlsSpec">$$$queryExtDbRlsSpec</paramValue>
      <paramValue name="subjectExtDbRlsSpec">$$$subjectExtDbRlsSpec</paramValue>
      <paramValue name="queryTable">@@@table</paramValue>
      <paramValue name="subjectTable">@@@table</paramValue>
      <depends step="runSplign"/>
    </step>

  </steps
