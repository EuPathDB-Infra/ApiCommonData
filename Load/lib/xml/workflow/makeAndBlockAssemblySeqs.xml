<workflowGraph name="makeAndBlockAssemblySeqs">

    <param name="parentDataDir"/>
    <param name="parentNcbiTaxonId"/>
    <param name="ncbiTaxonId"/>
    <param name="predictedTranscriptsSql"/>
    <param name="dataDir"/>

    <step name="makeDataDir" class="ApiCommonData::Load::WorkflowSteps::MakeDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="makeAssemblySeqs" class="ApiCommonData::Load::WorkflowSteps::MakeAssemblySeqs">
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="predictedTranscriptsSql">$$predictedTranscriptsSql$$</paramValue>
    </step>

   <step name="extractAssemblySeqs"
          stepClass="ApiCommonData::Load::Steps::ExtractAssemblySeqs">
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="useTaxonHierarchy">true</paramValue>
      <paramValue name="outputFile">$$dataDir$$/assemblySeqs.fsa</paramValue>
      <depends step="makeAssemblySeqs"/>
      <depends step="makeDataDir"/>
    </step>

    <step name="makeClusterTaskInputDir" class="ApiCommonData::Load::WorkflowSteps::MakeRepeatMaskTaskInputDir">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <depends step="extractAssemblySeqs"/>
    </step>

    <step name="mirrorToCluster" class="ApiCommonData::Load::WorkflowSteps::MirrorToCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends step="makeTaskInputDir"/>
      <depends step="makeClusterTaskInputDir"/>
    </step>

    <step name="startClusterTask" class="ApiCommonData::Load::WorkflowSteps::StartClusterTask">
      <paramValue name="taskDir">$$dataDir$$</paramValue>
      <paramValue name="queue">apidb</paramValue>
      <paramValue name="cmdName">runRepeatMask</paramValue>
      <paramValue name="cmdArgs">????</paramValue>
      <depends step="mirrorToCluster"/>
    </step>

    <step name="waitForClusterTask" waitForPilot="yes">
      <paramValue name="taskDir">$$dataDir$$</paramValue>
      <depends step="startClusterTask"/>
    </step>

    <step name="mirrorFromCluster" class="ApiCommonData::Load::Steps::CopyFilesFromComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/master</paramValue>
      <depends step="waitForClusterTask"/>
    </step>


</workflowGraph>
