<workflowGraph name="genomeAnalysis">

  <param name="parentDataDir"/>
  <param name="organismName"/>
  <param name="genomeExtDbRlsSpec"/>
  <param name="genomeVirtualSeqsExtDbRlsSpec"/>
  <param name="ncbiTaxonVersion"/>
  <param name="soVersion"/>
  <param name="ncbiTaxonId"/>
  <param name="parentNcbiTaxonId"/>
  <param name="usePredictedTranscripts"/>
  <param name="predictedTranscriptsExtDbRlsSpec"/>
  <param name="useVirtualSeqs"/>
  <param name="nrdbFile"/>
  <param name="nrdbShortDeflineFile"/>
  <param name="maxIntronSize"/>
  <param name="taxonHierarchyForBlastxFilter"/>
  <param name="nrdbExtDbRlsSpec"/>
  <param name="organismTwoLetterAbbrev"/>
  <param name="repeatMaskSpecies"/>
  <param name="maxIntronSize"/>
  <param name="organismFullName"/>
  <param name="genomeSize"/>
  <param name="runtRNAScan"/>


  <constant name="dataDir">$$parentDataDir$$/genome</constant>
  <constant name="genomicSeqsFile">$$dataDir$$/genomicSeqs.fsa</constant>
  <constant name="assemblySeqsDataDir">$$dataDir$$/makeAssemblySeqs</constant>
  <constant name="mapAssemblySeqsDataDir">$$dataDir$$/mapAssemblySeqs</constant>
  <constant name="assembliesDataDir">$$dataDir$$/makeAssemblies</constant>

  <step name="makeDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

  <step name="extractGenomicSeqs"
          stepClass="ApiCommonData::Load::WorkflowSteps::ExtractNaSeqs">
      <paramValue name="extDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">ExternalNASequence</paramValue>
      <paramValue name="alternateDefline"></paramValue>
      <paramValue name="outputFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="separateFastaFiles">false</paramValue>
      <paramValue name="outputDirForSeparateFiles"></paramValue>
      <depends name="makeDataDir"/> 
    </step>

   <step name="mirrorToCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorToComputeCluster" stepLoadTypes="cluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="extractGenomicSeqs"/>
    </step>


    <subgraph name="tRNAScan" xmlFile="trnaScanWorkflow.xml" includeIf="$$runtRNAScan$$">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="genomicSeqsFile">$$genomicSeqsFile$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="tRNAExtDbRlsSpec">$$organismName$$TRNAscan-SE|1.23</paramValue>
      <paramValue name="soVersion">$$soVersion$$</paramValue>
      <depends name="mirrorToCluster"/>
    </subgraph>

    <subgraph name="makeAndBlockAssemblySeqs" xmlFile="makeAndBlockAssemblySeqs.xml">
      <paramValue name="parentDataDir">$$dataDir$$</paramValue>
      <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
      <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="usePredictedTranscripts">$$usePredictedTranscripts$$</paramValue>
      <paramValue name="dataDir">$$assemblySeqsDataDir$$</paramValue>
      <paramValue name="repeatMaskSpecies">$$repeatMaskSpecies$$</paramValue>
      <paramValue name="predictedTranscriptsExtDbRlsSpec">$$predictedTranscriptsExtDbRlsSpec$$</paramValue>
      <depends name="extractGenomicSeqs"/>
    </subgraph>

</workflowGraph>
