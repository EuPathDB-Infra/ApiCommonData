<workflowGraph name="organismAnalysis">
  <param name="projectName"/>
  <param name="projectVersion"/>
  <param name="parentDataDir"/>
  <param name="organismName"/>
  <param name="organismFullName"/>
  <param name="organismTwoLetterAbbrev"/>
  <param name="genomeExtDbRlsSpec"/>
  <param name="genomeVirtualSeqsExtDbRlsSpec"/>
  <param name="genomeSource"/>
  <param name="interproVersion"/>
  <param name="iedbVersion"/>
  <param name="soVersion"/>
  <param name="dbESTVersion"/>
  <param name="ncbiTaxonVersion"/>
  <param name="ncbiTaxonId"/>
  <param name="parentNcbiTaxonId"/>
  <param name="predictedTranscriptsSql"/>
  <param name="pdbFile"/>
  <param name="nrdbFile"/>
  <param name="nrdbShortDeflineFile"/>  
  <param name="maxIntronSize"/>
  <param name="calculateTranslatedProteins"/>
  <param name="taxonHierarchyForBlastxFilter"/>
  <param name="runSplign"/>
  <param name="nrdbExtDbRlsSpec"/>  
  <param name="repeatMaskSpecies"/>
  <param name="maxIntronSize"/>

  <constant name="dataDir">$$parentDataDir$$/$$organismName$$</constant>
  <constant name="downloadSiteDataDir">downloadSite/$$projectName$$/$$projectVersion$$/$$organismName$$</constant>
  <constant name="webServicesDataDir">webServices/$$projectName$$/$$projectVersion$$</constant>

  <step name="makeDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeDataDir">
    <paramValue name="dataDir">$$dataDir$$</paramValue>
  </step>

   <step name="mirrorToCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

  <step name="makeDownloadSiteDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeApiSiteFilesDir">
    <paramValue name="apiSiteFilesDir">$$downloadSiteDataDir$$</paramValue>
  </step>

  <subgraph name="genomeAnalysis" xmlFile="genomeAnalysis.xml">
    <paramValue name="parentDataDir">$$dataDir$$</paramValue>
    <paramValue name="organismName">$$organismName$$</paramValue>
    <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
    <paramValue name="genomeVirtualSeqsExtDbRlsSpec">$$genomeVirtualSeqsExtDbRlsSpec$$</paramValue>
    <paramValue name="soVersion">$$soVersion$$</paramValue>
    <paramValue name="ncbiTaxonVersion">$$ncbiTaxonVersion$$</paramValue>
    <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>    
    <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
    <paramValue name="predictedTranscriptsSql"></paramValue>
    <paramValue name="nrdbFile">$$nrdbFile$$</paramValue>
    <paramValue name="nrdbShortDeflineFile">$$nrdbShortDeflineFile$$</paramValue>
    <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
    <paramValue name="taxonHierarchyForBlastxFilter">$$taxonHierarchyForBlastxFilter$$</paramValue>
    <paramValue name="runSplign">$$runSplign$$</paramValue>
    <paramValue name="nrdbExtDbRlsSpec">$$nrdbExtDbRlsSpec$$</paramValue>
    <paramValue name="organismTwoLetterAbbrev">$$organismTwoLetterAbbrev$$</paramValue>
    <paramValue name="repeatMaskSpecies">$$repeatMaskSpecies$$</paramValue>
    <paramValue name="maxIntronSize">$$maxIntronSize$$</paramValue>
    <depends name="mirrorToCluster"/>
  </subgraph>

  <subgraph name="proteomeAnalysis" xmlFile="proteomeAnalysis.xml">
    <paramValue name="parentDataDir">$$dataDir$$</paramValue>
    <paramValue name="organismTwoLetterAbbrev">$$organismTwoLetterAbbrev$$</paramValue>
    <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
    <paramValue name="iedbVersion">$$iedbVersion$$</paramValue>
    <paramValue name="soVersion">$$soVersion$$</paramValue>
    <paramValue name="interproVersion">$$interproVersion$$</paramValue>
    <paramValue name="nrdbExtDbRlsSpec">$$nrdbExtDbRlsSpec$$</paramValue>
    <paramValue name="nrdbFile">$$nrdbFile$$</paramValue>
    <paramValue name="nrdbShortDeflineFile">$$nrdbShortDeflineFile$$</paramValue>
    <paramValue name="pdbFile">$$pdbFile$$</paramValue>
    <paramValue name="calculateTranslatedProteins">$$calculateTranslatedProteins$$</paramValue>
    <paramValue name="ncbiTaxonId">$$ncbiTaxonId$$</paramValue>
    <depends name="mirrorToCluster"/>
  </subgraph>


  <subgraph name="makeAndFormatDownloadFiles" xmlFile="makeAndFormatDownloadFiles.xml">
    <paramValue name="downloadSiteDataDir">$$downloadSiteDataDir$$</paramValue>
    <paramValue name="organismName">$$organismName$$</paramValue>
    <paramValue name="ncbiTaxonId">$$organismTwoLetterAbbrev$$</paramValue>
    <paramValue name="parentNcbiTaxonId">$$parentNcbiTaxonId$$</paramValue>
    <paramValue name="interproVersion">$$interproVersion$$</paramValue>
    <paramValue name="genomeSource">$$genomeSource$$</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    <paramValue name="dbESTExtDbRlsSpec">dbEST:$$dbESTVersion$$</paramValue>
    <paramValue name="webServicesDataDir">$$webServicesDataDir$$</paramValue>
    <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
    <paramValue name="genomeVirtualSeqsExtDbRlsSpec">$$genomeVirtualSeqsExtDbRlsSpec$$</paramValue>
    <paramValue name="minOrfLength">50</paramValue>
    <depends name="proteomeAnalysis"/>
    <depends name="genomeAnalysis"/>
    <depends name="makeDownloadSiteDataDir"/>
  </subgraph>

  <subgraph name="makeGffFile" xmlFile="makeGffFile.xml">
    <paramValue name="downloadSiteDataDir">$$downloadSiteDataDir$$</paramValue>
    <paramValue name="organismName">$$organismName$$</paramValue>
    <paramValue name="organismFullName">$$organismFullName$$</paramValue>
    <paramValue name="projectName">$$projectName$$</paramValue>
    <paramValue name="projectVersion">$$projectVersion$$</paramValue>
    <depends name="proteomeAnalysis"/>
    <depends name="genomeAnalysis"/>
    <depends name="makeDownloadSiteDataDir"/>
  </subgraph>

  <step name="fullRecordDump" stepClass="ApiCommonData::Load::WorkflowSteps::RunfullRecordDump">
    <paramValue name="downloadSiteDataDir">$$downloadSiteDataDir$$</paramValue>
    <paramValue name="organismName">$$organismName$$</paramValue>
    <paramValue name="organismFullName">$$organismFullName$$</paramValue>
    <paramValue name="projectDB">$$projectName$$</paramValue>
    <paramValue name="recordType">gene,sequence</paramValue>
    <paramValue name="outputGeneFile">$$organismName$$Gene_$$projectName$$-$$projectVersion$$.txt</paramValue>
    <paramValue name="outputSeqFile">$$organismName$$Sequence_$$projectName$$-$$projectVersion$$.txt</paramValue>

    <depends name="proteomeAnalysis"/>
    <depends name="genomeAnalysis"/>
    <depends name="makeDownloadSiteDataDir"/>
  </step>
</workflowGraph>
