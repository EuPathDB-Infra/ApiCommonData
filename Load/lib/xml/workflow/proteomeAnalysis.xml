<workflowGraph name="standardGenomeAnalysis">
  <param name="genomeName"/>
  <param name="genomeExtDb"/>
  <param name="genomeExtDbRls"/>
  <param name="genomeTwoLetterAbbrev"/>
  <param name="interproVersion"/>
  <param name="iedbVersion"/>
  <param name="soVersion"/>
  <param name="tigrVersion"/>
  <param name="ncbiTaxonVersion"/>
  <param name="ncbiTaxonId"/>

  <!-- handles on external datasets -->
  <constant name="genomeExtDbRlsSpec">$$genomeExtDb$$:$$genomeExtDbRls$$</constant>
  <constant name="soExtDbRlsSpec">SequenceOntology:$$soVersion$$</constant>
  <constant name="tigrExtDbRlsSpec">tigr:$$tigrVersion$$</constant>
  <constant name="taxonomyExtDbRlsSpec">taxonomy:$$taxonomyVersion$$</constant>
  <constant name="nrdbFile">seqfiles/nr.fsa</constant>
  <constant name="nrdbExtDbRlsSpec">NRDB:$$nrdbVersion$$</constant>
  <constant name="nrdbShortDeflineFile">seqfiles/nrShortDefline.fsa</constant>
  <constant name="genomicSeqsFile">seqfiles/GenomicSeqs.fsa</constant>
  <constant name="genomeDataDir">data/$$genomeName$$</constant>
  <constant name="genomeTaskLogsDir">taskLogs/$$genomeName$$</constant>
  <constant name="proteinsFile">$$genomeDataDir$$/seqfiles/AnnotatedProteins.fsa</constant>

    <step name="calcTranslatedProteins"
          stepClass="ApiCommonData::Load::Steps::CalculateTranslatedProteinSequence">
      <include match="$$genomeTwoLetterAbbrev$$" list="Pf,Pb,Py,Pv,Tb,Lm,Li,Lb"/>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="soExtDbRlsSpec">$$soExtDbRlsSpec$$</paramValue>
    </step>

    <step name="molecularWeight"
          stepClass="ApiCommonData::Load::Steps::CalculateProteinMolWt">
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">DoTS.TranslatedAASequence</paramValue>
      <depends step="calcTranslatedProteins"/>
    </step>

    <step name="molecularWeightMinMax"
          stepClass="ApiCommonData::Load::Steps::InsertAASeqMWMinMax">
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">DoTS.TranslatedAASequence</paramValue>
      <depends step="calcTranslatedProteins"/>
    </step>

    <step name="isoelectricPoint"
          stepClass="ApiCommonData::Load::Steps::InsertAAiP">
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="table">DoTS.TranslatedAASequence</paramValue>
      <depends step="calcTranslatedProteins"/>
    </step>

    <step name="extractProteins"
          stepClass="ApiCommonData::Load::Steps::ExtractAnnotatedProteinsBySpecies">
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="ncbiTaxId">$$ncbiTaxonId$$</paramValue>
      <paramValue name="outputFile">$$proteinsFile$$</paramValue>
      <depends step="calcTranslatedProteins"/>
    </step>

    <step name="runTmhmm"
          stepClass="ApiCommonData::Load::Steps::RunTmhmm">
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <paramValue name="outputFile">tmhmm/$$genomeName$$Tmhmm.out</paramValue>
      <depends step="extractProteins"/>
    </step>

    <step name="insertTmhmm"
          stepClass="ApiCommonData::Load::Steps::InsertTmhmm">
      <paramValue name="inputFile">tmhmm/$$genomeName$$Tmhmm.out</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <depends step="runTmhmm"/>
    </step>

    <step name="runSignalP"
          stepClass="ApiCommonData::Load::Steps::RunSignalP">
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <paramValue name="outputFile">signalp/$$genomeName$$SignalP.out</paramValue>
      <paramValue name="options">-t euk -f short -m nn+hmm -q -trunc 70</paramValue>
      <depends step="extractProteins"/>
    </step>

    <step name="insertSignalP"
          stepClass="ApiCommonData::Load::Steps::InsertSignalP">
      <paramValue name="inputFile">signalp/$$genomeName$$SignalP.out</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <depends step="runSignalP"/>
    </step>

    <subgraph name="mapEpitopesToProteins" xmlFile="epitopesWorkflow.xml">
      <paramValue name="proteinsFile">$proteinsFile</paramValue>
      <paramValue name="genomeName">$genomeName</paramValue>
      <paramValue name="genomeDataDir">$$genomeDataDir$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="genomeTwoLetterAbbrev">$$genomeTwoLetterAbbrev$$</paramValue>
      <paramValue name="iedbExtDbRlsSpec">iedb:$$iedbVersion$$</paramValue>
      <depends step="extractProteins"/>
    </subgraph>

    <step name="mirrorProteinsToCluster" class="ApiCommonData::Load::WorkflowSteps::MirrorToCluster">
      <paramValue name="parentDir">seqfiles</paramValue>
      <paramValue name="fileOrDirToMirror">AnnotatedProteins.fsa</paramValue>
      <depends step="extractProteins"/>
    </step>

    <subgraph name="interpro" xmlFile="interproWorkflow.xml">
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <paramValue name="genomeDataDir">$$genomeDataDir$$</paramValue>
      <paramValue name="genomeTaskLogsDir">$$genomeTaskLogsDir$$</paramValue>
      <paramValue name="interproExtDbRlsSpec">interpro:$$interproVersion$$</paramValue>
      <paramValue name="interproVersion">$$interproVersion$$</paramValue>
    </subgraph>

    <subgraph name="splign" xmlFile="splignWorkflow.xml">
      <include match="$genomeName" list="$Pf,$Pb,$Py,$Pv"/>
      <paramValue name="genomeName">$$genomeName$$</paramValue>
      <paramValue name="queryExtDbRlsSpec">$$tigrExtDbRlsSpec$$</paramValue>
    </subgraph>


    <subgraph name="psipred" xmlFile="psipredWorkflow.xml">
      <paramValue name="genomeName">$$genomeName$$</paramValue>
      <paramValue name="nrdbFile">$$nrdbShortDeflineFile$$</paramValue>
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <depends step="extractProteins"/>
      <depends step="nrdb"/>
    </subgraph>

    <subgraph name="blastpProteinsNrdb" xmlFile="blastWorkflow.xml">
      <paramValue name="genomeName">$$genomeName$$</paramValue>
      <paramValue name="queryAbbrev">proteins</paramValue>
      <paramValue name="queryFile">$$proteinsFile$$</paramValue>
      <paramValue name="queryTable">Dots.ExternalAaSequence</paramValue>
      <paramValue name="queryExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
      <paramValue name="subjectAbbrev">nrdb</paramValue>
      <paramValue name="subjectFile">$$nrdbFile$$</paramValue>
      <paramValue name="subjectTable">Dots.ExternalAaSequence</paramValue>
      <paramValue name="subjectExtDbRlsSpec"></paramValue>
      <paramValue name="blastArgs">-cpus=2 -topcomboN=1 V=100 B=20 -hspmax=1000000 -gi E=1e-3 -wordmask=seg -hspsepQmax=4000 -span1</paramValue>
      <paramValue name="idRegex">gi\\|(\\d+)\\|</paramValue>
      <paramValue name="blastType">blastp</paramValue>
      <paramValue name="vendor">wu</paramValue>
      <paramValue name="loadSubjectSubset">true</paramValue>
      <depends step="extractProteins"/>
      <depends step="nrdb"/>
    </subgraph>


</workflow>
