<workflowGraph name="interproWorkflow">

    <param name="proteinsFile"/>
    <param name="parentDataDir"/>
    <param name="interproExtDbRlsSpec"/>
    <param name="interproVersion"/>

    <constant name="dataDir">$$parentDataDir$$/interpro</constant>

    <step name="makeDataDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeDataDir">
      <paramValue name="dataDir">$$dataDir$$</paramValue>
    </step>

    <step name="makeClusterTaskInputDir" stepClass="ApiCommonData::Load::WorkflowSteps::MakeInterproTaskInputDir">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <depends name="makeDataDir"/>
    </step>

    <step name="mirrorToCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorToComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$</paramValue>
      <depends name="makeClusterTaskInputDir"/>
    </step>

    <step name="runClusterTask" stepClass="ApiCommonData::Load::WorkflowSteps::RunAndMonitorClusterTask">
      <paramValue name="taskInputDir">$$dataDir$$/input</paramValue>
      <paramValue name="numNodes">NUM_NODES</paramValue>
      <paramValue name="processorsPerNode"></paramValue>
      <depends name="mirrorToCluster"/>
    </step>

    <step name="mirrorFromCluster" stepClass="ApiCommonData::Load::WorkflowSteps::MirrorFromComputeCluster">
      <paramValue name="fileOrDirToMirror">$$dataDir$$/master</paramValue>
      <paramValue name="outputDir">$$dataDir$$/master/mainresult/</paramValue>
      <paramValue name="outputFile"></paramValue>
      <depends name="runClusterTask"/>
    </step>

    <step name="insert" stepClass="ApiCommonData::Load::WorkflowSteps::InsertInterpro">
      <paramValue name="inputDir">$$dataDir$$/master/mainresult/</paramValue>
      <paramValue name="interproExtDbRlsSpec">$$interproExtDbRlsSpec$$</paramValue>
      <paramValue name="configFileRelativeToDownloadDir">InterproscanData/iprscan$$interproVersion$$/iprscan/data/insertInterpro-config.xml</paramValue>
      <depends name="mirrorFromCluster"/>
    </step>

</workflowGraph>
