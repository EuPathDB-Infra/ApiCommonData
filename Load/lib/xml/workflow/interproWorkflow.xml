<workflowGraph name="interpro">

    <param name="proteinsFile"/>
    <param name="organismDataDir"/>
    <param name="organismTaskLogsDir"/>
    <param name="interproExtDbRlsSpec"/>
    <param name="interproVersion"/>

    <step name="makeDataDir" class="ApiCommonData::Load::WorkflowSteps::MakeDir">
      <paramValue name="dataDir">$$organismDataDir$$/interpro</paramValue>
    </step>

    <step name="makeClusterTaskInputDir" class="ApiCommonData::Load::WorkflowSteps::MakeInterproTaskInputDir">
      <paramValue name="taskInputDir">$$organismDataDir$$/interpro/input</paramValue>
      <paramValue name="proteinsFile">$$proteinsFile$$</paramValue>
      <depends step="makeDataDir"/>
    </step>

    <step name="mirrorToCluster" class="ApiCommonData::Load::WorkflowSteps::MirrorToCluster">
      <paramValue name="parentDir">$$organismDataDir$$</paramValue>
      <paramValue name="fileOrDirToMirror">interpro</paramValue>
      <depends step="makeClusterTaskDir"/>
    </step>

    <step name="startClusterTask" class="ApiCommonData::Load::WorkflowSteps::StartClusterTask">
      <paramValue name="taskDir">$$organismDataDir$$/interpro</paramValue>
      <paramValue name="taskLogsDir">$$organismTaskLogsDir$$/interpro</paramValue>
      <paramValue name="queue">apidb</paramValue>
      <paramValue name="cmdName">runIprScan</paramValue>
      <paramValue name="cmdArgs">$$proteinsFile$$</paramValue>
      <depends step="mirrorToCluster"/>
    </step>

    <step name="waitForClusterTask" waitForPilot="yes">
      <paramValue name="descrip">interpro</paramValue>
      <depends step="startClusterTask"/>
    </step>

    <step name="mirrorFromCluster" class="ApiCommonData::Load::Steps::CopyFilesFromComputeCluster">
      <paramValue name="parentDir">$$organismDataDir$$/interpro</paramValue>
      <paramValue name="fileOrDirToMirror">master</paramValue>
      <depends step="waitForClusterTask"/>
    </step>

    <step name="insert" class="ApiCommonData::Load::WorkflowSteps::InsertInterpro">
      <paramValue name="">$$proteinsFile$$</paramValue>
      <paramValue name="interproExtDbRlsSpec">$$interproExtDbRlsSpec$$</paramValue>
      <paramValue name="configFileRelativeToDownloadDir">InterproscanData/iprscan$$interproVersion$$/iprscan/data/insertInterpro-config.xml</paramValue>
    </step>

</workflowGraph>
