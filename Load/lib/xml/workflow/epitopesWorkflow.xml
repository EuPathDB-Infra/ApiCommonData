<workflowGraph name="epitopes">

    <param name="proteinsFile"/>
    <param name="genomeDataDir"/>
    <param name="iedbExtDbRlsSpec"/>
    <param name="genomeExtDbRlsSpec"/>
    <param name="genomeName"/>
    <param name="genomeTwoLetterAbbrev"/>

    <constant name="proteinsFileSimpleDefline">$$genomeDataDir$$/iedb/blastDb/$$genomeName$$_proteins</constant>

    <step name="makeDataDir" class="ApiCommonData::Load::WorkflowSteps::MakeDir">
      <paramValue name="dataDir">$$genomeDataDir$$/iedb</paramValue>
    </step>

    <step name="makeBlastDir" class="ApiCommonData::Load::WorkflowSteps::MakeDir">
      <paramValue name="dataDir">$$genomeDataDir$$/iedb/blastDb</paramValue>
      <depends step="makeDataDir"/>
    </step>

    <step name="makeProteinsFileSimpleDefline" class="ApiCommonData::Load::WorkflowSteps::MakeProteinsFileSimpleDefline">
      <paramValue name="inputProteinsFile">$$proteinsFile$$</paramValue>
      <paramValue name="outputProteinsFile">$$proteinsFileSimpleDefline$$</paramValue>
      <depends step="makeDataDir"/>
    </step>

    <step name="formatNcbiBlastFile" class="ApiCommonData::Load::WorkflowSteps::FormatNcbiBlastFile">
      <paramValue name="inputFile">$$proteinsFileSimpleDefline$$</paramValue>
      <paramValue name="formatterArgs">T</paramValue>
      <depends step="makeProteinsFileSimpleDefline"/>
    </step>

    <step name="createEpitopeMapFile" class="ApiCommonData::Load::WorkflowSteps::CreateEpitopeMapFile">
      <paramValue name="inputDirRelativeToDownloadsDir">IEDB_fixed</paramValue>
      <paramValue name="blastDbDir">$$genomeDataDir$$/iedb/blastDb</paramValue>
      <paramValue name="genomeTwoLetterAbbrev">$$genomeTwoLetterAbbrev$$</paramValue>
      <paramValue name="proteinsFile">$$proteinsFileSimpleDefline$$</paramValue>
      <paramValue name="outputDir">$$genomeDataDir$$/iedb/results</paramValue>
      <depends step="makeClusterTaskDir"/>
    </step>

    <step name="insertEpitopeMapping" class="ApiCommonData::Load::WorkflowSteps::InsertEpitopeMapping">
      <paramValue name="inputDir">$$genomeDataDir$$/iedb/results</paramValue>
      <paramValue name="genomeName">$$genomeName$$</paramValue>
      <paramValue name="iedbExtDbRlsSpec">$$iedbExtDbRlsSpec$$</paramValue>
      <paramValue name="genomeExtDbRlsSpec">$$genomeExtDbRlsSpec$$</paramValue>
    </step>

</workflowGraph>
