<resources>

  <constant name="orgAbbrev" value="ncaninum"/>
  <constant name="project" value="ToxoDB"/>
  <constant name="ncbiTaxId" value="29176"/>

  <!-- OldName: N.caninum_chromosomes   OldVersion: 2009-10-06 -->

  <resource resource="$$orgAbbrev$$_GeneDB_GFF_genome_RSRC" version="@@$$orgAbbrev$$_GeneDB_GFF_genome_VER@@"
      plugin="GUS::Supported::Plugin::LoadFastaSequences"
      internalDescrip="">

    <prop name="soTerm">chromosome</prop>
    <prop name="regex">>(\S+)</prop>

    <manualGet fileOrDir="$$project$$/$$orgAbbrev$$/genome/GeneDB_GFF/%RESOURCE_VERSION%/final"/>

    <unpack>makeCustomFastaAndGffFromGff3 --input_dir @@dataDir@@/%RESOURCE_VERSION%/final --output_fasta @@dataDir@@/genome.fasta --output_gff @@dataDir@@/genome.gff3</unpack>

    <unpack>preprocessGFF3 --input_gff @@dataDir@@/genome.gff3 --output_gff @@dataDir@@/genome.gff</unpack>

    <pluginArgs>--externalDatabaseName %RESOURCE_NAME% --ncbiTaxId $$ncbiTaxId$$ --externalDatabaseVersion %RESOURCE_VER% --sequenceFile @@dataDir@@/genome.fasta --SOTermName '$$soTerm$$'  --regexSourceId  '$$regex$$' --tableName "DoTS::ExternalNASequence"</pluginArgs>
  </resource>


  <!-- OldName: N.caninum_Annotation   OldVersion: 2009-10-06 -->
  <resource resource="$$orgAbbrev$$_GeneDB_GFF_annotation_RSRC" version="@@$$orgAbbrev$$_GeneDB_GFF_annotation_VER@@"
      parentResource="$$orgAbbrev$$_GeneDB_GFF_genome_RSRC"
      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
      internalDescrip="">

    <prop name="soTerm">chromosome</prop>

    <manualGet fileOrDir="global/empty"/>

    <pluginArgs>--extDbName %PARENT_RESOURCE_NAME% --extDbRlsVer %PARENT_RESOURCE_VERSION% --mapFile @@gusHome@@/lib/xml/isf/geneDBGFF2Gus.xml --inputFileOrDir @@dataDir@@/../$$orgAbbrev$$_GeneDB_GFF_RSRC/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soCvsVersion @@SO_VER@@ --defaultOrganism $$ncbiTaxId$$  --seqSoTerm '$$soTerm$$' --validationLog @@dataDir@@/validation.log --bioperlTreeOutput @@dataDir@@/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence</pluginArgs>
  </resource>


  <!-- NOT PORTED -->
  <!-- OldName: updateChromosomeNumberFromMap   OldVersion: 2009-11-23 -->
  <resource resource="updateChromosomeNumberFromMap" version="@@updateChromosomeNumberFromMap_VER@@"
      plugin="ApiCommonData::Load::Plugin::LoadNothing"
      internalDescrip="update Chromosome Number From Mapping file">

    <manualGet fileOrDir="ToxoDB/ncaninum/genome/chromosomeNumberMap/1.0/final/neospChrs.txt"/>

    <unpack>updateChromosomeNumberFromMap.pl --map_file @@dataDir@@/neospChrs.txt --sequence_table ExternalNaSequence </unpack>

    <pluginArgs>--dbRefExternalDatabaseSpec "%RESOURCE_NAME%|%RESOURCE_VER%"</pluginArgs>
  </resource>


  <!-- OldName: dbEST_NC   OldVersion: 2009-09-25 -->

  <resource resource="$$orgAbbrev_dbEST_RSRC" version="@@orgAbbrev_dbEST_VER@@"
      plugin="GUS::Supported::Plugin::dbEST"
      internalDescrip="">
    <manualGet fileOrDir="global/empty"/>

    <unpack>getSubTaxa --ncbiTaxId $$ncbiTaxId$$ --outputFile @@dataDir@@/taxonIdFile</unpack>

    <unpack>createPropFile --file @@dataDir@@/dbestProp --propList "dbestLogin:@@dbestLogin@@,dbestPswd:@@dbestPswd@@"</unpack>

    <pluginArgs>--span 500 --taxonFile @@dataDir@@/taxonIdFile --extDbName %RESOURCE_NAME% --extDbRlsVer %%RESOURCE_VER% --soVer @@SO_VER@@ --dbestLoginFile @@dataDir@@/dbestProp --dbestConnect "dbi:Oracle:musbld" </pluginArgs>
  </resource>


  <!-- OldName: IEDB_Epitopes   OldVersion: 2009-06-09 -->

  <resource resource="$$orgAbbrev_IEDB_Epitopes_RSRC" version="@@$$orgAbbrev$$_IEDB_Epitopes_VER@@"
      plugin="GUS::Supported::Plugin::LoadFastaSequences">

    <manualGet fileOrDir="$$project$$/common/epitope/IEDB/%RESOURCE_VERSION%/final/$$orgAbbrev$$IEDBExport.txt"/>

    <unpack>mkdir -p @@dataDir@@/IEDB_Epitopes_fixed/fasta</unpack>

    <unpack>extractFromIEDB --inputFile @@dataDir@@/$$orgAbbrev$$IEDBExport.txt --outputFile @@dataDir@@/IEDB_Epitopes_fixed/IEDBExport.txt </unpack>

    <unpack>generateEpitopeFastaFile --inputFile @@dataDir@@/IEDB_Epitopes_fixed/IEDBExport.txt --outputFile @@dataDir@@/IEDB_Epitopes_fixed/fasta/IEDBExport.fsa </unpack>

    <getAndUnpackOutput dir="@@dataDir@@/IEDB_Epitopes_fixed"/>

    <getAndUnpackOutput file="@@dataDir@@/IEDB_Epitopes_fixed/IEDBExport.txt"/>

    <pluginArgs>--seqFileDir @@dataDir@@/IEDB_Epitopes_fixed/fasta --externalDatabaseName %RESOURCE_NAME% --externalDatabaseVersion %RESOURCE_VERSION% --soTermName "protein_binding_site" --regexSourceId ">(\d+)|" --tableName "DoTS::MotifAASequence" --logFrequency 100 --regexNcbiTaxId "\|.*\|(.*)" --regexName "\|(.*)\|.*"</pluginArgs>
  </resource>


  <!-- OldName: IEDB_Epitopes_DBxRefs   OldVersion: 2009-06-09 -->

  <resource resource="$$orgAbbrev$$_IEDB_Epitopes_DBxRefs_RSRC" version="@@$$orgAbbrev$$_IEDB_Epitopes_VER@@"
      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs">

    <manualGet fileOrDir="global/empty"/>

    <unpack>createEpitopeDbRefFile --inputDir @@dataDir@@/../$$orgAbbrev$$_IEDB_Epitopes_RSRC/IEDB_Epitopes_fixed --outputFile @@dataDir@@/dbRefs.txt</unpack>

    <pluginArgs>--DbRefMappingFile @@dataDir@@/dbRefs.txt --extDbName %RESOURCE_NAME% --extDbReleaseNumber %RESOURCE_VERSION% --columnSpec "primary_identifier, remark" --tableName "AASequenceDbRef"</pluginArgs>
  </resource>


  <!-- OldName: Neosporacaninum_Gene_Aliases   OldVersion: 01-27-2010 -->

  <resource resource="$$orgAbbrev$$_GeneDB_Gff_Gene_Aliases_RSRC" version="@@$$orgAbbrev$$_Gene_Aliases_VER@@"
      plugin="ApiCommonData::Load::Plugin::InsertNaFeatureNaGene"
      internalDescrip="">

    <manualGet fileOrDir="global/empty"/>

    <unpack>grep 'previous_systematic_id=' @@dataDir@@/../$$orgAbbrev$$_genedb_gff_genome_RSRC/genome.gff3 >  @@dataDir@@/previousIdLines</unpack>

    <unpack>perl -e '%hsh;while(<>){chomp; @arr=split(/\t/,$_); $arr[8]=~ /ID=(\w+)\:.+previous_systematic_id\=(\w+)/; $hsh{$1}=$2;} foreach $k(keys %hsh){print "$k\t$hsh{$k}\n";}' @@dataDir@@/previousIdLines > @@dataDir@@/new2oldIds.txt</unpack>

    <pluginArgs>--MappingFile @@dataDir@@/new2oldIds.txt</pluginArgs>
  </resource>


  <!-- OldName: ApiLoc_EupathDB_Dbrefs   OldVersion: 2010-03-29 -->

  <resource resource="$$orgAbbrev$$_apiLoc_DbxRefs" version="@@$$orgAbbrev$$_apiLoc_DbxRefs_VER@@"
      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
      internalDescrip="">

    <!-- organism name as found on the ApiLoc site -->
    <prop name="ApiLocOrganism" value="Neospora caninum"/>

    <manualGet fileOrDir="$$project$$/$$orgAbbrev$$/dbxref/ApiLoc_dbrefs/%RESOURCE_VERSION%/final/$$orgAbbrev$$.html"/>

    <unpack>makeDbxRefsFromApiLocHtml @@dataDir@@/$$orgAbbrev$$.html "$$ApiLocOrganism$$" > @@dataDir@@/dbxrefs.txt</unpack>

    <pluginArgs>--DbRefMappingFile @@dataDir@@/dbxrefs.txt --extDbName %RESOURCE_NAME% --extDbReleaseNumber %RESOURCE_VER% --columnSpec "remark" --tableName "DbRefNAFeature"</pluginArgs>
  </resource>


  <!-- OldName: Entrez_Gene_dbxref   OldVersion: 12-01-2009 -->
  <resource resource="$$orgAbbrev$$_Entrez_Gene_dbxref_RSRC" version="2010-10-13"
      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs">

    <manualGet fileOrDir="common/dbxref/Gene2Entrez/%RESOURCE_VERSION%/final/gene_info.gz"/>

    <unpack>ncbiGeneInfo2DbRefsFile @@dataDir@@/gene_info.gz $$ncbiTaxId$$ > entrez2gene.tab</unpack>

    <unpack>rm @@dataDir@@/gene_info.gz</unpack>

    <pluginArgs>--DbRefMappingFile @@dataDir@@/gene2entrez.tab --extDbName %RESOURCE_NAME% --extDbReleaseNumber %RESOURCE_VERSION% --columnSpec "primary_identifier,secondary_identifier,remark" --tableName "DbRefNAFeature"  --geneExternalDatabaseSpec '$$orgAbbrev$$_chromosomes_RSRC|@@$$orgAbbrev$$_chromosomes_VER@@' --idType 'alternate id'</pluginArgs>

  </resource>

 
  <!-- OldName: Uniprot_Gene_dbxref   OldVersion: 11-24-2009 -->

 <resource resource="$$orgAbbrev_Uniprot_Gene_dbxref_RSRC" version="@@$$orgAbbrev$$_Uniprot_Gene_dbxref_VER@@"
      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs">

    <manualGet fileOrDir="common/dbxref/Gene2Uniprot/%RESOURCE_VERSION%/final/idmapping_selected.tab.gz"/>

    <unpack>uniprotIdMap2DbRefsFile @@dataDir@@/idmapping_selected.tab.gz @@dataDir@@/../$$orgAbbrev$$_Entrez_Gene_dbxref_RSRC/entrez2gene.tab > @@dataDir@@/gene2uniprot.tab</unpack>

    <pluginArgs>--DbRefMappingFile @@dataDir@@/gene2uniprot.tab --extDbName %RESOURCE_NAME% --extDbReleaseNumber %RESOURCE_VERSION% --columnSpec "primary_identifier,secondary_identifier,remark" --tableName "DbRefNAFeature"  --geneExternalDatabaseSpec 'Ncaninum_chromosomes_RSRC|@@Ncaninum_chromosomes_VER@@' --idType 'alternate id'</pluginArgs>
  </resource>

</resources>
